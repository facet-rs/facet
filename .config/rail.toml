# cargo-rail configuration
# Generated by: cargo rail init
# Documentation: https://github.com/loadingalias/cargo-rail/docs/
#
# Commands:
#   cargo rail init           - Generate this config
#   cargo rail affected       - Show crates affected by changes
#   cargo rail test           - Run tests for affected crates
#   cargo rail unify          - Unify workspace dependencies
#   cargo rail split          - Split crate to standalone repo
#   cargo rail sync           - Sync monorepo <-> split repos
#   cargo rail release        - Publish releases
#
# Exit codes: 0 = success, 1 = changes needed (--check), 2 = error

# targets = []  # Platform targets for multi-target validation

[unify]
include_paths = true  # Handle path dependencies (default: true)
include_renamed = false  # Handle renamed dependencies (package = "...") (default: false)
pin_transitives = false  # Pin transitive-only deps (workspace-hack replacement, enable for hakari users) (default: false)
transitive_host = "root"  # Where to put pinned transitive dev-deps: "root" or path like "crates/foo"
exclude = []  # Dependencies to skip unification (safety hatch)
include = []  # Dependencies to force unification (safety hatch)
msrv = true  # Compute and write rust-version to workspace manifest (default: true)
msrv_source = "max"  # How to compute MSRV: deps, workspace, max (default: max)
strict_version_compat = true  # Treat version mismatches as errors (default: true)
exact_pin_handling = "warn"  # How to handle =x.y.z pins: skip, preserve, warn (default: warn)
major_version_conflict = "warn"  # How to handle major version conflicts: warn (skip), bump (force highest) (default: warn)
detect_unused = true  # Detect unused dependencies (default: true)
remove_unused = true  # Auto-remove unused deps when applying (default: true)
max_backups = 3  # Number of backup files to keep (default: 3)
prune_dead_features = true  # Remove features never enabled in resolved graph (default: true)
preserve_features = [
  "testfeat",
  "fuzz-tests",
]  # Features to preserve from pruning (glob patterns: "unstable-*")
detect_undeclared_features = true  # Detect features borrowed via Cargo unification (default: true)
fix_undeclared_features = true  # Auto-fix borrowed features by adding them to Cargo.toml (default: true)
skip_undeclared_patterns = [
  "default",
  "std",
  "alloc",
  "*_backend",
  "*_impl",
]  # Features to skip in undeclared detection


[release]
tag_prefix = "v"  # Prefix for all tags (used via {prefix} in tag_format)
tag_format = "{crate}-{prefix}{version}"  # Variables: {prefix}, {crate}, {version}
require_clean = true
publish_delay = 5
create_github_release = false
sign_tags = false
changelog_path = "CHANGELOG.md"
changelog_relative_to = "crate"  # "crate" or "workspace" (default: crate)
skip_changelog_for = []
require_changelog_entries = false


[change-detection]
# Files that trigger full workspace rebuild when changed
infrastructure = [
  ".github/**",
  "scripts/**",
  "justfile",
  "Justfile",
  "Makefile",
  "makefile",
  "GNUmakefile",
  "*.sh",
  "Taskfile.yml",
  "Taskfile.yaml",
  ".pre-commit-config.yaml",
  "deny.toml",
  "cliff.toml",
  "release.toml",
  "release-plz.toml",
]
# custom = {}  # Custom path categories (e.g., custom.verify = ["verify/**/*.rs"])


# Split/Sync: Use 'cargo rail split init <crate>' to configure individual crates
# Per-crate configuration uses [crates.<name>] sections:
#
# [crates.my-crate.split]
# remote = "git@github.com:org/my-crate.git"
# branch = "main"
# mode = "single"  # "single" or "combined"
# paths = [{ crate = "crates/my-crate" }]
#
# Split modes:
#   single   - One crate per split repo (default)
#   combined - Multiple crates share one split repo
#              Use workspace_mode = "workspace" to mirror monorepo structure
#
# [crates.my-crate.release]
# publish = true
