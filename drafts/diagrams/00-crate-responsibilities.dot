// Crate Responsibilities Overview
// Render: dot -Tsvg 00-crate-responsibilities.dot -o 00-crate-responsibilities.svg

digraph crate_responsibilities {
    label="Crate Responsibilities";
    labelloc="t";
    fontsize=20;
    fontname="Helvetica-Bold";

    node [shape=box, fontname="Helvetica", fontsize=11];
    edge [fontname="Helvetica", fontsize=10];

    rankdir=TB;
    nodesep=0.8;
    ranksep=1.0;

    subgraph cluster_legend {
        label="Legend";
        style=dashed;
        fontname="Helvetica";

        legend_runtime [label="runtime crate", style=filled, fillcolor="#e8f4e8"];
        legend_impl [label="impl library", style=filled, fillcolor="#f4f4e8"];
        legend_procmacro [label="proc-macro crate", style=filled, fillcolor="#e8e8f4"];
        legend_extension [label="extension crate", style=filled, fillcolor="#f4e8e8"];
    }

    // Core - runtime types
    core [label=<
<table border="0" cellspacing="0" cellpadding="6">
<tr><td align="left"><b>facet-core</b></td></tr>
<tr><td align="left">────────────────────────</td></tr>
<tr><td align="left"><font face="Monaco" point-size="10">Shape, Field, ExtensionAttr</font></td></tr>
<tr><td align="left"><font face="Monaco" point-size="10">FieldFlags, ShapeAttribute</font></td></tr>
<tr><td align="left"><font face="Monaco" point-size="10">Facet trait</font></td></tr>
</table>
    >, style=filled, fillcolor="#e8f4e8"];

    // Macros impl - library with macro logic (NOT a proc-macro crate)
    macros_impl [label=<
<table border="0" cellspacing="0" cellpadding="6">
<tr><td align="left"><b>facet-macros-impl</b> (library)</td></tr>
<tr><td align="left">────────────────────────</td></tr>
<tr><td align="left"><font face="Monaco" point-size="10">__make_parse_attr!</font> grammar compiler</td></tr>
<tr><td align="left"><font face="Monaco" point-size="10">__dispatch_attr!</font> variant router</td></tr>
<tr><td align="left"><font face="Monaco" point-size="10">__build_struct_fields!</font> field parser</td></tr>
<tr><td align="left"><font face="Monaco" point-size="10">__attr_error!</font> typo suggestions</td></tr>
<tr><td align="left"><font face="Monaco" point-size="10">__field_error!</font> field typo suggestions</td></tr>
</table>
    >, style=filled, fillcolor="#f4f4e8"];

    // Macros - proc-macro entry point
    macros [label=<
<table border="0" cellspacing="0" cellpadding="6">
<tr><td align="left"><b>facet-macros</b></td></tr>
<tr><td align="left">────────────────────────</td></tr>
<tr><td align="left"><font face="Monaco" point-size="10">#[derive(Facet)]</font></td></tr>
<tr><td align="left">Extracts ns::attr, generates</td></tr>
<tr><td align="left"><font face="Monaco" point-size="10">ns::__parse_attr!(...)</font> calls</td></tr>
</table>
    >, style=filled, fillcolor="#e8e8f4"];

    // Main facet crate
    facet [label=<
<table border="0" cellspacing="0" cellpadding="6">
<tr><td align="left"><b>facet</b></td></tr>
<tr><td align="left">────────────────────────</td></tr>
<tr><td align="left">Re-exports everything</td></tr>
<tr><td align="left"><font face="Monaco" point-size="10">define_attr_grammar!</font> public API</td></tr>
</table>
    >, style=filled, fillcolor="#e8f4e8"];

    // Extension crate example
    ext [label=<
<table border="0" cellspacing="0" cellpadding="6">
<tr><td align="left"><b>facet-kdl</b> (example extension)</td></tr>
<tr><td align="left">────────────────────────</td></tr>
<tr><td align="left">Calls <font face="Monaco" point-size="10">define_attr_grammar!</font></td></tr>
<tr><td align="left">Gets generated <font face="Monaco" point-size="10">__parse_attr!</font></td></tr>
<tr><td align="left">Gets generated <font face="Monaco" point-size="10">Attr</font> enum</td></tr>
</table>
    >, style=filled, fillcolor="#f4e8e8"];

    // Edges
    core -> macros_impl [style=invis];
    macros_impl -> macros [style=invis];
    macros -> facet [style=invis];
    facet -> ext [style=invis];
}
