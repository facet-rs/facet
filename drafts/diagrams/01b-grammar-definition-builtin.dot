// Grammar Definition Time (Built-in)
// Render: dot -Tsvg 01b-grammar-definition-builtin.dot -o 01b-grammar-definition-builtin.svg

digraph grammar_definition_builtin {
    label="Grammar Definition Time (Built-in Attributes)";
    labelloc="t";
    fontsize=20;
    fontname="Helvetica-Bold";

    node [shape=box, fontname="Monaco, Consolas, Courier", fontsize=11];
    edge [fontname="Helvetica", fontsize=10];

    rankdir=LR;
    nodesep=0.8;
    ranksep=1.2;

    // Facet crate input
    grammar [label=<
<table border="0" cellspacing="0" cellpadding="2">
<tr><td align="left" bgcolor="#e4ffe4"><b>Input: facet/src/lib.rs</b></td></tr>
<tr><td align="left"><font face="Monaco">::facet::<font color="#8250df">define_attributes!</font> {</font></td></tr>
<tr><td align="left"><font face="Monaco">    <font color="#cf222e">mod</font> <font color="#0550ae">builtin</font>;</font></td></tr>
<tr><td align="left"><font face="Monaco">    <font color="#6e7781">// Two enums: one per target</font></font></td></tr>
<tr><td align="left"><font face="Monaco">    <font color="#cf222e">pub enum</font> <font color="#0550ae">ContainerAttribute</font> {</font></td></tr>
<tr><td align="left"><font face="Monaco">        RenameAll(<font color="#0550ae">&amp;'static str</font>),</font></td></tr>
<tr><td align="left"><font face="Monaco">        Transparent,</font></td></tr>
<tr><td align="left"><font face="Monaco">        DenyUnknownFields,</font></td></tr>
<tr><td align="left"><font face="Monaco">        Default,</font></td></tr>
<tr><td align="left"><font face="Monaco">    }</font></td></tr>
<tr><td align="left"><font face="Monaco">    <font color="#cf222e">pub enum</font> <font color="#0550ae">FieldAttribute</font> {</font></td></tr>
<tr><td align="left"><font face="Monaco">        Skip,</font></td></tr>
<tr><td align="left"><font face="Monaco">        Rename(<font color="#0550ae">&amp;'static str</font>),</font></td></tr>
<tr><td align="left"><font face="Monaco">        Default,  <font color="#6e7781">// in both!</font></font></td></tr>
<tr><td align="left"><font face="Monaco">    }</font></td></tr>
<tr><td align="left"><font face="Monaco">}</font></td></tr>
</table>
    >, style=filled, fillcolor="#e8ffe8"];

    // Proc-macro processing
    make_parse [label=<
<table border="0" cellspacing="0" cellpadding="2">
<tr><td bgcolor="#e8e8f4"><b>facet-macros-impl</b></td></tr>
<tr><td><font face="Monaco">::facet::<font color="#8250df">__make_parse_attr!</font></font></td></tr>
<tr><td>(grammar compiler)</td></tr>
</table>
    >, style=filled, fillcolor="#e8e8f4"];

    // Generated output
    generated [label=<
<table border="0" cellspacing="0" cellpadding="2">
<tr><td align="left" bgcolor="#d4edda"><b>Generated in facet</b></td></tr>
<tr><td align="left" bgcolor="#e8f5e9"><b>1. Runtime types (in submodule)</b></td></tr>
<tr><td align="left"><font face="Monaco"><font color="#cf222e">pub mod</font> <font color="#0550ae">builtin</font> {</font></td></tr>
<tr><td align="left"><font face="Monaco">    <font color="#cf222e">pub enum</font> <font color="#0550ae">ContainerAttribute</font> { ... }</font></td></tr>
<tr><td align="left"><font face="Monaco">    <font color="#cf222e">pub enum</font> <font color="#0550ae">FieldAttribute</font> { ... }</font></td></tr>
<tr><td align="left"><font face="Monaco">}</font></td></tr>
<tr><td align="left" bgcolor="#fff3cd"><b>2. TWO COMPILED GRAMMARS</b></td></tr>
<tr><td align="left"><font face="Monaco"><font color="#cf222e">macro_rules!</font> <font color="#8250df">__parse_container_attr</font> {</font></td></tr>
<tr><td align="left"><font face="Monaco">    (<font color="#953800">$name</font>:ident $(<font color="#953800">$rest</font>:tt)*) =&gt; {</font></td></tr>
<tr><td align="left"><font face="Monaco">        ::facet::<font color="#8250df">__dispatch_attr!</font> {</font></td></tr>
<tr><td align="left"><font face="Monaco">            <font color="#6e7781">// no @ns - built-in attributes</font></font></td></tr>
<tr><td align="left"><font face="Monaco">            <font color="#8250df">@variants</font> { rename_all, transparent, ... }</font></td></tr>
<tr><td align="left"><font face="Monaco">            ...</font></td></tr>
<tr><td align="left"><font face="Monaco">        }</font></td></tr>
<tr><td align="left"><font face="Monaco">    };</font></td></tr>
<tr><td align="left"><font face="Monaco">}</font></td></tr>
<tr><td align="left"><font face="Monaco"><font color="#cf222e">macro_rules!</font> <font color="#8250df">__parse_field_attr</font> {</font></td></tr>
<tr><td align="left"><font face="Monaco">    (<font color="#953800">$name</font>:ident $(<font color="#953800">$rest</font>:tt)*) =&gt; {</font></td></tr>
<tr><td align="left"><font face="Monaco">        ::facet::<font color="#8250df">__dispatch_attr!</font> {</font></td></tr>
<tr><td align="left"><font face="Monaco">            <font color="#6e7781">// no @ns - built-in attributes</font></font></td></tr>
<tr><td align="left"><font face="Monaco">            <font color="#8250df">@variants</font> { skip, rename, default, ... }</font></td></tr>
<tr><td align="left"><font face="Monaco">            ...</font></td></tr>
<tr><td align="left"><font face="Monaco">        }</font></td></tr>
<tr><td align="left"><font face="Monaco">    };</font></td></tr>
<tr><td align="left"><font face="Monaco">}</font></td></tr>
</table>
    >, style=filled, fillcolor="#f0fff0"];

    // Edges
    grammar -> make_parse [label="compiles via", color="#4169e1", penwidth=2];
    make_parse -> generated [label="generates", color="#228b22", penwidth=2];
}
