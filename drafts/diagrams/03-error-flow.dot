// Error Flow (typo handling)
// Render: dot -Tsvg 03-error-flow.dot -o 03-error-flow.svg

digraph error_flow {
    label="Error Flow (typo handling)";
    labelloc="t";
    fontsize=20;
    fontname="Helvetica-Bold";

    node [shape=box, fontname="Monaco, Consolas, Courier", fontsize=11];
    edge [fontname="Helvetica", fontsize=10];

    rankdir=TB;

    typo [label=<
<table border="0" cellspacing="0" cellpadding="2">
<tr><td align="left" bgcolor="#fff8f0"><b>User code with typo</b></td></tr>
<tr><td align="left"><font face="Monaco">#[<font color="#8250df">facet</font>(orm::<font color="#dc3545">colum</font>(primary_key))]</font></td></tr>
<tr><td align="left"><font color="#dc3545">              ^^^^^ typo!</font></td></tr>
</table>
    >, style=filled, fillcolor="#fff8f0"];

    dispatch [label=<
<table border="0" cellspacing="0" cellpadding="2">
<tr><td bgcolor="#e8e8f4"><b>facet-macros-impl</b></td></tr>
<tr><td><font face="Monaco">::facet::<font color="#8250df">__dispatch_attr!</font></font></td></tr>
<tr><td>Looks up <font face="Monaco" color="#dc3545">'colum'</font> in @variants</td></tr>
<tr><td><b>Not found!</b></td></tr>
</table>
    >, style=filled, fillcolor="#e8e8f4"];

    attr_error [label=<
<table border="0" cellspacing="0" cellpadding="2">
<tr><td align="left" bgcolor="#fff3cd"><b>facet-macros-impl</b></td></tr>
<tr><td align="left"><font face="Monaco">::facet::<font color="#8250df">__attr_error!</font> {</font></td></tr>
<tr><td align="left"><font face="Monaco">    <font color="#8250df">@known_attrs</font> { skip, column, rename }</font></td></tr>
<tr><td align="left"><font face="Monaco">    <font color="#8250df">@got_name</font> { <font color="#dc3545">colum</font> }</font></td></tr>
<tr><td align="left"><font face="Monaco">    <font color="#8250df">@got_span</font> { ... }</font></td></tr>
<tr><td align="left"><font face="Monaco">}</font></td></tr>
</table>
    >, style=filled, fillcolor="#fff9e6"];

    strsim [label=<
<table border="0" cellspacing="0" cellpadding="2">
<tr><td bgcolor="#e8f5e9"><b>strsim crate</b></td></tr>
<tr><td><font face="Monaco">strsim::jaro_winkler(<font color="#0a3069">"colum"</font>, <font color="#0a3069">"column"</font>)</font></td></tr>
<tr><td>Returns <font face="Monaco">0.96</font> (high similarity)</td></tr>
<tr><td>Best match: <font face="Monaco" color="#228b22">"column"</font></td></tr>
</table>
    >, style=filled, fillcolor="#e8f5e9"];

    error_output [label=<
<table border="0" cellspacing="0" cellpadding="2">
<tr><td align="left" bgcolor="#f8d7da"><b>Compiler output</b></td></tr>
<tr><td align="left"><font face="Monaco" color="#dc3545">error: unknown attribute `colum`</font></td></tr>
<tr><td align="left"><font face="Monaco" color="#dc3545">       did you mean `column`?</font></td></tr>
<tr><td align="left"><font face="Monaco">  --&gt; src/lib.rs:3:13</font></td></tr>
<tr><td align="left"><font face="Monaco">   |</font></td></tr>
<tr><td align="left"><font face="Monaco">3  |     #[facet(orm::colum(...))]</font></td></tr>
<tr><td align="left"><font face="Monaco">   |                  <font color="#dc3545">^^^^^</font></font></td></tr>
</table>
    >, style=filled, fillcolor="#f8d7da"];

    // Edges
    typo -> dispatch [label="processed by", color="#666"];
    dispatch -> attr_error [label="variant not found", color="#dc3545", penwidth=2];
    attr_error -> strsim [label="find similar", color="#666"];
    strsim -> error_output [label="compile_error!\nwith original span", color="#dc3545", penwidth=2];
}
