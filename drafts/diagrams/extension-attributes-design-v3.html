<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Extension Attributes Design v3</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/tokyo-night-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/rust.min.js"></script>
  <style>
    :root {
      color-scheme: light dark;
      --bg: light-dark(#fff, #1a1a1a);
      --fg: light-dark(#222, #e8e8e8);
      --fg-muted: light-dark(#666, #999);
      --border: light-dark(#ddd, #444);
      --code-bg: light-dark(#f5f5f5, #2a2a2a);
      --accent: light-dark(#0066cc, #66b3ff);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Public Sans', system-ui, sans-serif;
      background: var(--bg);
      color: var(--fg);
      line-height: 1.6;
      margin: 0;
      padding: 3rem 2rem;
    }

    main {
      max-width: 920px;
      margin: 0 auto;
      padding: 2rem 3rem;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    h2 {
      font-size: 1.75rem;
      margin-top: 3rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--border);
    }

    h3 {
      font-size: 1.25rem;
      margin-top: 2rem;
    }

    p {
      margin: 1.25rem 0;
    }

    code {
      font-family: 'SF Mono', Monaco, Consolas, monospace;
      font-size: 0.9em;
      background: var(--code-bg);
      padding: 0.15em 0.4em;
      border-radius: 4px;
    }

    pre {
      border-radius: 8px;
      overflow-x: auto;
      margin: 1.5rem 0;
    }

    pre code {
      padding: 1.5rem !important;
      border-radius: 8px;
    }

    pre code.hljs {
      background: #1a1b26 !important; /* tokyo-night background */
    }

    a {
      color: var(--accent);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5rem 0;
    }

    th, td {
      text-align: left;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border);
    }

    th {
      background: var(--code-bg);
      font-weight: 600;
    }

    .diagram {
      padding: 1.5rem;
      background: var(--code-bg);
      border-radius: 8px;
      overflow-x: auto;
      /* Break out of the 920px container */
      width: 90vw;
      max-width: 1850px;
      margin: 2rem auto;
      position: relative;
      left: 50%;
      transform: translateX(-50%);
    }

    .diagram svg,
    .diagram object {
      display: block;
      max-width: 100%;
      height: auto;
      margin: 0 auto;
    }

    .diagram-caption {
      text-align: center;
      color: var(--fg-muted);
      font-size: 0.9rem;
      margin-top: 1rem;
    }

    hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 3rem 0;
    }

    .status-done { color: #22c55e; }
    .status-pending { color: #ef4444; }
  </style>
</head>
<body>
  <main>
    <h1>Extension Attributes Design v3</h1>
    <p><em>This document supersedes v1 and v2. It consolidates learnings from the proto-attr prototype into the final design for facet's attribute system.</em></p>

    <hr>

    <h2>Overview</h2>
    <p>Extension attributes allow crates like <code>facet-kdl</code>, <code>facet-args</code>, and <code>facet-yaml</code> to define custom attributes that users apply via <code>#[facet(ns::attr)]</code> syntax.</p>
    <p><strong>Key insight</strong>: Instead of hand-writing parsers in each extension crate, we compile a <strong>grammar DSL</strong> into type-safe parsing infrastructure.</p>

<pre><code class="language-rust">// Extension crate defines grammar once:
facet::define_attributes! {
    pub enum Attr {
        Child,
        Property,
        Column(Column),
    }

    pub struct Column {
        pub name: Option&lt;&apos;static str&gt;,
        pub primary_key: bool,
    }
}

// User writes attributes naturally:
#[derive(Facet)]
struct User {
    #[facet(orm::column(name = "user_id", primary_key))]
    id: i64,
}

// Typos get helpful errors:
// error: unknown attribute `colum`, did you mean `column`?</code></pre>

    <hr>

    <h2>Architecture</h2>

    <h3>Crate Responsibilities</h3>
    <p>Which crate does what:</p>
    <div class="diagram">
      <svg width="887pt" height="1010pt"
 viewBox="0.00 0.00 887.00 1010.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1006)">
<title>crate_responsibilities</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-1006 883,-1006 883,4 -4,4"/>
<text xml:space="preserve" text-anchor="middle" x="439.5" y="-979" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="20.00">Crate Responsibilities</text>
<g id="clust1" class="cluster">
<title>cluster_legend</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="8,-880.75 8,-961.75 531,-961.75 531,-880.75 8,-880.75"/>
<text xml:space="preserve" text-anchor="middle" x="269.5" y="-938.75" font-family="Helvetica,sans-Serif" font-size="20.00">Legend</text>
</g>
<g id="node1" class="node">
<title>legend_runtime</title>
<polygon fill="#e8f4e8" stroke="black" points="95.5,-924.75 16.5,-924.75 16.5,-888.75 95.5,-888.75 95.5,-924.75"/>
<text xml:space="preserve" text-anchor="middle" x="56" y="-902.3" font-family="Helvetica,sans-Serif" font-size="11.00">runtime crate</text>
</g>
<g id="node2" class="node">
<title>legend_impl</title>
<polygon fill="#f4f4e8" stroke="black" points="220.88,-924.75 153.12,-924.75 153.12,-888.75 220.88,-888.75 220.88,-924.75"/>
<text xml:space="preserve" text-anchor="middle" x="187" y="-902.3" font-family="Helvetica,sans-Serif" font-size="11.00">impl library</text>
</g>
<g id="node3" class="node">
<title>legend_procmacro</title>
<polygon fill="#e8e8f4" stroke="black" points="376.88,-924.75 279.12,-924.75 279.12,-888.75 376.88,-888.75 376.88,-924.75"/>
<text xml:space="preserve" text-anchor="middle" x="328" y="-902.3" font-family="Helvetica,sans-Serif" font-size="11.00">proc&#45;macro crate</text>
</g>
<g id="node4" class="node">
<title>legend_extension</title>
<polygon fill="#f4e8e8" stroke="black" points="523.38,-924.75 434.62,-924.75 434.62,-888.75 523.38,-888.75 523.38,-924.75"/>
<text xml:space="preserve" text-anchor="middle" x="479" y="-902.3" font-family="Helvetica,sans-Serif" font-size="11.00">extension crate</text>
</g>
<g id="node5" class="node">
<title>core</title>
<polygon fill="#e8f4e8" stroke="black" points="879,-973 581,-973 581,-840.5 879,-840.5 879,-973"/>
<text xml:space="preserve" text-anchor="start" x="595" y="-953.55" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="11.00">facet&#45;core</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-928.55" font-family="Helvetica,sans-Serif" font-size="11.00">────────────────────────</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-905.5" font-family="Monaco" font-size="10.00">Shape, Field, Attr</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-880" font-family="Monaco" font-size="10.00">FieldFlags, ShapeAttribute</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-854.5" font-family="Monaco" font-size="10.00">Facet trait</text>
</g>
<g id="node6" class="node">
<title>macros_impl</title>
<polygon fill="#f4f4e8" stroke="black" points="879,-768.5 581,-768.5 581,-585 879,-585 879,-768.5"/>
<text xml:space="preserve" text-anchor="start" x="595" y="-749.05" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="11.00">facet&#45;macros&#45;impl</text>
<text xml:space="preserve" text-anchor="start" x="689.5" y="-749.05" font-family="Helvetica,sans-Serif" font-size="11.00"> (library)</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-724.05" font-family="Helvetica,sans-Serif" font-size="11.00">────────────────────────</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-701.05" font-family="Monaco" font-size="10.00">__make_parse_attr!</text>
<text xml:space="preserve" text-anchor="start" x="703" y="-701.05" font-family="Helvetica,sans-Serif" font-size="11.00"> grammar compiler</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-675.55" font-family="Monaco" font-size="10.00">__dispatch_attr!</text>
<text xml:space="preserve" text-anchor="start" x="691" y="-675.55" font-family="Helvetica,sans-Serif" font-size="11.00"> variant router</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-650.05" font-family="Monaco" font-size="10.00">__build_struct_fields!</text>
<text xml:space="preserve" text-anchor="start" x="727" y="-650.05" font-family="Helvetica,sans-Serif" font-size="11.00"> field parser</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-624.55" font-family="Monaco" font-size="10.00">__attr_error!</text>
<text xml:space="preserve" text-anchor="start" x="673" y="-624.55" font-family="Helvetica,sans-Serif" font-size="11.00"> typo suggestions</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-599.05" font-family="Monaco" font-size="10.00">__field_error!</text>
<text xml:space="preserve" text-anchor="start" x="679" y="-599.05" font-family="Helvetica,sans-Serif" font-size="11.00"> field typo suggestions</text>
</g>
<g id="node7" class="node">
<title>macros</title>
<polygon fill="#e8e8f4" stroke="black" points="879,-513 581,-513 581,-382 879,-382 879,-513"/>
<text xml:space="preserve" text-anchor="start" x="595" y="-493.55" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="11.00">facet&#45;macros</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-468.55" font-family="Helvetica,sans-Serif" font-size="11.00">────────────────────────</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-445.5" font-family="Monaco" font-size="10.00">#[derive(Facet)]</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-419.05" font-family="Helvetica,sans-Serif" font-size="11.00">Extracts ns::attr, generates</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-396.05" font-family="Monaco" font-size="10.00">ns::__parse_attr!(...)</text>
<text xml:space="preserve" text-anchor="start" x="727" y="-396.05" font-family="Helvetica,sans-Serif" font-size="11.00"> calls</text>
</g>
<g id="node8" class="node">
<title>facet</title>
<polygon fill="#e8f4e8" stroke="black" points="879,-310 581,-310 581,-204.5 879,-204.5 879,-310"/>
<text xml:space="preserve" text-anchor="start" x="595" y="-290.55" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="11.00">facet</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-265.55" font-family="Helvetica,sans-Serif" font-size="11.00">────────────────────────</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-241.55" font-family="Helvetica,sans-Serif" font-size="11.00">Re&#45;exports everything</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-218.55" font-family="Monaco" font-size="10.00">define_attributes!</text>
<text xml:space="preserve" text-anchor="start" x="703" y="-218.55" font-family="Helvetica,sans-Serif" font-size="11.00"> public API</text>
</g>
<g id="node9" class="node">
<title>ext</title>
<polygon fill="#f4e8e8" stroke="black" points="879,-132.5 581,-132.5 581,0 879,0 879,-132.5"/>
<text xml:space="preserve" text-anchor="start" x="595" y="-113.05" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="11.00">facet&#45;kdl</text>
<text xml:space="preserve" text-anchor="start" x="640" y="-113.05" font-family="Helvetica,sans-Serif" font-size="11.00"> (example extension)</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-88.05" font-family="Helvetica,sans-Serif" font-size="11.00">────────────────────────</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-65.05" font-family="Helvetica,sans-Serif" font-size="11.00">Calls </text>
<text xml:space="preserve" text-anchor="start" x="622" y="-65.05" font-family="Monaco" font-size="10.00">define_attributes!</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-39.55" font-family="Helvetica,sans-Serif" font-size="11.00">Gets generated </text>
<text xml:space="preserve" text-anchor="start" x="672.25" y="-39.55" font-family="Monaco" font-size="10.00">__parse_attr!</text>
<text xml:space="preserve" text-anchor="start" x="595" y="-14.05" font-family="Helvetica,sans-Serif" font-size="11.00">Gets </text>
<text xml:space="preserve" text-anchor="start" x="620.5" y="-14.05" font-family="Monaco" font-size="10.00">mod attrs { Attribute }</text>
</g>
</g>
</svg>
      <p class="diagram-caption">Each crate has a specific role in the attribute system</p>
    </div>

    <h3>Dependency Graph</h3>
    <p>How crates depend on each other:</p>
    <div class="diagram">
      <svg width="725pt" height="637pt"
 viewBox="0.00 0.00 725.00 637.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 632.75)">
<title>dependency_graph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-632.75 720.75,-632.75 720.75,4 -4,4"/>
<text xml:space="preserve" text-anchor="middle" x="358.38" y="-605.75" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="20.00">Crate Dependency Graph</text>
<g id="clust1" class="cluster">
<title>cluster_legend</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="8,-8 8,-192.75 314,-192.75 314,-8 8,-8"/>
<text xml:space="preserve" text-anchor="middle" x="161" y="-14" font-family="Helvetica,sans-Serif" font-size="20.00">Legend</text>
</g>
<g id="node1" class="node">
<title>l1</title>
<polygon fill="none" stroke="black" points="77,-81 41,-81 41,-45 77,-45 77,-81"/>
<text xml:space="preserve" text-anchor="middle" x="59" y="-58.55" font-family="Helvetica,sans-Serif" font-size="11.00">A</text>
</g>
<g id="node2" class="node">
<title>l2</title>
<polygon fill="none" stroke="black" points="77,-184.75 41,-184.75 41,-148.75 77,-148.75 77,-184.75"/>
<text xml:space="preserve" text-anchor="middle" x="59" y="-162.3" font-family="Helvetica,sans-Serif" font-size="11.00">B</text>
</g>
<g id="edge1" class="edge">
<title>l1&#45;&gt;l2</title>
<path fill="none" stroke="#228b22" d="M56.54,-81.43C55.45,-90.02 54.29,-100.53 53.75,-110 53.24,-118.94 53.78,-128.67 54.68,-137.46"/>
<polygon fill="#228b22" stroke="#228b22" points="51.18,-137.69 55.87,-147.19 58.13,-136.84 51.18,-137.69"/>
<text xml:space="preserve" text-anchor="middle" x="86.38" y="-111.2" font-family="Helvetica,sans-Serif" font-size="9.00" fill="#228b22">A depends on B</text>
</g>
<g id="node3" class="node">
<title>l3</title>
<polygon fill="none" stroke="black" points="190,-81 154,-81 154,-45 190,-45 190,-81"/>
<text xml:space="preserve" text-anchor="middle" x="172" y="-58.55" font-family="Helvetica,sans-Serif" font-size="11.00">C</text>
</g>
<g id="node4" class="node">
<title>l4</title>
<polygon fill="none" stroke="black" points="190,-184.75 154,-184.75 154,-148.75 190,-148.75 190,-184.75"/>
<text xml:space="preserve" text-anchor="middle" x="172" y="-162.3" font-family="Helvetica,sans-Serif" font-size="11.00">D</text>
</g>
<g id="edge2" class="edge">
<title>l3&#45;&gt;l4</title>
<path fill="none" stroke="#4169e1" stroke-dasharray="5,2" d="M169.48,-81.06C168.13,-92.09 166.87,-106.75 167.5,-119.75 167.77,-125.37 168.24,-131.35 168.76,-137.09"/>
<polygon fill="#4169e1" stroke="#4169e1" points="165.25,-137.2 169.74,-146.8 172.22,-136.5 165.25,-137.2"/>
<text xml:space="preserve" text-anchor="middle" x="190.75" y="-111.2" font-family="Helvetica,sans-Serif" font-size="9.00" fill="#4169e1">proc&#45;macro</text>
</g>
<g id="node5" class="node">
<title>l5</title>
<polygon fill="none" stroke="black" points="285,-81 249,-81 249,-45 285,-45 285,-81"/>
<text xml:space="preserve" text-anchor="middle" x="267" y="-58.55" font-family="Helvetica,sans-Serif" font-size="11.00">E</text>
</g>
<g id="node6" class="node">
<title>l6</title>
<polygon fill="none" stroke="black" points="285,-184.75 249,-184.75 249,-148.75 285,-148.75 285,-184.75"/>
<text xml:space="preserve" text-anchor="middle" x="267" y="-162.3" font-family="Helvetica,sans-Serif" font-size="11.00">F</text>
</g>
<g id="edge3" class="edge">
<title>l5&#45;&gt;l6</title>
<path fill="none" stroke="#b8860b" stroke-dasharray="1,5" d="M267,-81.26C267,-96.54 267,-119.13 267,-137.11"/>
<polygon fill="#b8860b" stroke="#b8860b" points="263.5,-136.89 267,-146.89 270.5,-136.89 263.5,-136.89"/>
<text xml:space="preserve" text-anchor="middle" x="286.5" y="-111.2" font-family="Helvetica,sans-Serif" font-size="9.00" fill="#b8860b">build&#45;dep</text>
</g>
<g id="node7" class="node">
<title>core</title>
<polygon fill="none" stroke="black" points="562,-599.75 498,-599.75 498,-563.75 562,-563.75 562,-599.75"/>
<text xml:space="preserve" text-anchor="middle" x="530" y="-577.3" font-family="Helvetica,sans-Serif" font-size="11.00">facet&#45;core</text>
</g>
<g id="node8" class="node">
<title>macros_impl</title>
<polygon fill="none" stroke="black" points="661.75,-496 560.25,-496 560.25,-460 661.75,-460 661.75,-496"/>
<text xml:space="preserve" text-anchor="middle" x="611" y="-479.55" font-family="Helvetica,sans-Serif" font-size="11.00">facet&#45;macros&#45;impl</text>
<text xml:space="preserve" text-anchor="middle" x="611" y="-467.55" font-family="Helvetica,sans-Serif" font-size="11.00">(impl library)</text>
</g>
<g id="edge5" class="edge">
<title>macros_impl&#45;&gt;core</title>
<path fill="none" stroke="#4169e1" stroke-dasharray="5,2" d="M597.26,-496.26C584.58,-512.19 565.55,-536.09 550.97,-554.41"/>
<polygon fill="#4169e1" stroke="#4169e1" points="548.24,-552.22 544.75,-562.22 553.72,-556.58 548.24,-552.22"/>
<text xml:space="preserve" text-anchor="middle" x="586.8" y="-526.2" font-family="Helvetica,sans-Serif" font-size="9.00" fill="#4169e1">(types)</text>
</g>
<g id="node9" class="node">
<title>macros</title>
<polygon fill="none" stroke="black" points="644.12,-392.25 565.88,-392.25 565.88,-356.25 644.12,-356.25 644.12,-392.25"/>
<text xml:space="preserve" text-anchor="middle" x="605" y="-375.8" font-family="Helvetica,sans-Serif" font-size="11.00">facet&#45;macros</text>
<text xml:space="preserve" text-anchor="middle" x="605" y="-363.8" font-family="Helvetica,sans-Serif" font-size="11.00">(proc&#45;macro)</text>
</g>
<g id="edge6" class="edge">
<title>macros&#45;&gt;macros_impl</title>
<path fill="none" stroke="#4169e1" stroke-dasharray="5,2" d="M606.02,-392.51C606.92,-407.79 608.25,-430.38 609.31,-448.36"/>
<polygon fill="#4169e1" stroke="#4169e1" points="605.81,-448.37 609.89,-458.14 612.79,-447.96 605.81,-448.37"/>
<text xml:space="preserve" text-anchor="middle" x="620.93" y="-422.45" font-family="Helvetica,sans-Serif" font-size="9.00" fill="#4169e1">(logic)</text>
</g>
<g id="node10" class="node">
<title>facet</title>
<polygon fill="none" stroke="black" points="557,-288.5 503,-288.5 503,-252.5 557,-252.5 557,-288.5"/>
<text xml:space="preserve" text-anchor="middle" x="530" y="-266.05" font-family="Helvetica,sans-Serif" font-size="11.00">facet</text>
</g>
<g id="edge4" class="edge">
<title>facet&#45;&gt;core</title>
<path fill="none" stroke="#228b22" d="M530,-288.57C530,-339.14 530,-488.59 530,-551.9"/>
<polygon fill="#228b22" stroke="#228b22" points="526.5,-551.84 530,-561.84 533.5,-551.84 526.5,-551.84"/>
<text xml:space="preserve" text-anchor="middle" x="545.38" y="-422.45" font-family="Helvetica,sans-Serif" font-size="9.00" fill="#228b22">runtime</text>
</g>
<g id="edge7" class="edge">
<title>facet&#45;&gt;macros</title>
<path fill="none" stroke="#4169e1" stroke-dasharray="5,2" d="M542.72,-288.76C554.41,-304.62 571.92,-328.37 585.4,-346.65"/>
<polygon fill="#4169e1" stroke="#4169e1" points="582.57,-348.71 591.32,-354.69 588.2,-344.56 582.57,-348.71"/>
<text xml:space="preserve" text-anchor="middle" x="593" y="-318.7" font-family="Helvetica,sans-Serif" font-size="9.00" fill="#4169e1">proc&#45;macro</text>
</g>
<g id="node11" class="node">
<title>kdl</title>
<polygon fill="none" stroke="black" points="501.25,-184.75 444.75,-184.75 444.75,-148.75 501.25,-148.75 501.25,-184.75"/>
<text xml:space="preserve" text-anchor="middle" x="473" y="-162.3" font-family="Helvetica,sans-Serif" font-size="11.00">facet&#45;kdl</text>
</g>
<g id="edge8" class="edge">
<title>kdl&#45;&gt;facet</title>
<path fill="none" stroke="#228b22" d="M482.67,-185.01C491.43,-200.65 504.49,-223.96 514.67,-242.14"/>
<polygon fill="#228b22" stroke="#228b22" points="511.6,-243.82 519.54,-250.83 517.71,-240.4 511.6,-243.82"/>
<text xml:space="preserve" text-anchor="middle" x="518.58" y="-214.95" font-family="Helvetica,sans-Serif" font-size="9.00" fill="#228b22">runtime</text>
</g>
<g id="node12" class="node">
<title>args</title>
<polygon fill="none" stroke="black" points="608,-184.75 544,-184.75 544,-148.75 608,-148.75 608,-184.75"/>
<text xml:space="preserve" text-anchor="middle" x="576" y="-162.3" font-family="Helvetica,sans-Serif" font-size="11.00">facet&#45;args</text>
</g>
<g id="edge9" class="edge">
<title>args&#45;&gt;facet</title>
<path fill="none" stroke="#228b22" d="M568.2,-185.01C561.16,-200.58 550.68,-223.75 542.48,-241.89"/>
<polygon fill="#228b22" stroke="#228b22" points="539.4,-240.22 538.47,-250.78 545.77,-243.11 539.4,-240.22"/>
<text xml:space="preserve" text-anchor="middle" x="569.75" y="-214.95" font-family="Helvetica,sans-Serif" font-size="9.00" fill="#228b22">runtime</text>
</g>
<g id="node13" class="node">
<title>yaml</title>
<polygon fill="none" stroke="black" points="716.75,-184.75 651.25,-184.75 651.25,-148.75 716.75,-148.75 716.75,-184.75"/>
<text xml:space="preserve" text-anchor="middle" x="684" y="-162.3" font-family="Helvetica,sans-Serif" font-size="11.00">facet&#45;yaml</text>
</g>
<g id="edge10" class="edge">
<title>yaml&#45;&gt;facet</title>
<path fill="none" stroke="#228b22" d="M657.53,-185.24C632.22,-201.96 593.87,-227.3 565.83,-245.82"/>
<polygon fill="#228b22" stroke="#228b22" points="564.06,-242.8 557.65,-251.23 567.92,-248.64 564.06,-242.8"/>
<text xml:space="preserve" text-anchor="middle" x="626.99" y="-214.95" font-family="Helvetica,sans-Serif" font-size="9.00" fill="#228b22">runtime</text>
</g>
<g id="node14" class="node">
<title>user</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="505,-81 441,-81 441,-45 505,-45 505,-81"/>
<text xml:space="preserve" text-anchor="middle" x="473" y="-58.55" font-family="Helvetica,sans-Serif" font-size="11.00">user crate</text>
</g>
<g id="edge11" class="edge">
<title>user&#45;&gt;facet</title>
<path fill="none" stroke="#228b22" d="M448.45,-81.3C416.79,-105.83 368.46,-152.26 392.25,-192.75 413.62,-229.12 459.17,-249.51 492.05,-259.98"/>
<polygon fill="#228b22" stroke="#228b22" points="490.62,-263.21 501.21,-262.73 492.63,-256.51 490.62,-263.21"/>
<text xml:space="preserve" text-anchor="middle" x="407.62" y="-163.07" font-family="Helvetica,sans-Serif" font-size="9.00" fill="#228b22">runtime</text>
</g>
<g id="edge12" class="edge">
<title>user&#45;&gt;kdl</title>
<path fill="none" stroke="#228b22" d="M473,-81.26C473,-96.54 473,-119.13 473,-137.11"/>
<polygon fill="#228b22" stroke="#228b22" points="469.5,-136.89 473,-146.89 476.5,-136.89 469.5,-136.89"/>
<text xml:space="preserve" text-anchor="middle" x="488.38" y="-111.2" font-family="Helvetica,sans-Serif" font-size="9.00" fill="#228b22">runtime</text>
</g>
<g id="edge13" class="edge">
<title>user&#45;&gt;args</title>
<path fill="none" stroke="#228b22" d="M490.47,-81.26C506.9,-97.49 531.68,-121.97 550.35,-140.41"/>
<polygon fill="#228b22" stroke="#228b22" points="547.79,-142.8 557.36,-147.34 552.71,-137.82 547.79,-142.8"/>
<text xml:space="preserve" text-anchor="middle" x="542.96" y="-111.2" font-family="Helvetica,sans-Serif" font-size="9.00" fill="#228b22">runtime</text>
</g>
</g>
</svg>
      <p class="diagram-caption">Green = runtime dep, Blue dashed = proc-macro dep</p>
    </div>

    <h3>1a. Grammar Definition Time (Third-Party Crate)</h3>
    <p>What <code>::facet::define_attributes!</code> generates for extension crates like <code>facet-kdl</code>:</p>
    <div class="diagram">
      <svg width="1121pt" height="538pt"
 viewBox="0.00 0.00 1121.00 538.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 533.75)">
<title>grammar_definition_3rdparty</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-533.75 1116.5,-533.75 1116.5,4 -4,4"/>
<text xml:space="preserve" text-anchor="middle" x="556.25" y="-506.75" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="20.00">Grammar Definition Time (Third&#45;Party Crate)</text>
<g id="node1" class="node">
<title>grammar</title>
<polygon fill="#fff8f0" stroke="black" points="242.75,-391.25 0,-391.25 0,-109.5 242.75,-109.5 242.75,-391.25"/>
<polygon fill="#ffe4c4" stroke="none" points="8,-369 8,-387.25 234.75,-387.25 234.75,-369 8,-369"/>
<text xml:space="preserve" text-anchor="start" x="10" y="-375.8" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Input: facet&#45;kdl/src/lib.rs</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-357.55" font-family="Monaco" font-size="11.00">::facet::</text>
<text xml:space="preserve" text-anchor="start" x="70.75" y="-357.55" font-family="Monaco" font-size="11.00" fill="#8250df">define_attributes!</text>
<text xml:space="preserve" text-anchor="start" x="192.25" y="-357.55" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-339.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-339.3" font-family="Monaco" font-size="11.00" fill="#cf222e">mod</text>
<text xml:space="preserve" text-anchor="start" x="57.25" y="-339.3" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="64" y="-339.3" font-family="Monaco" font-size="11.00" fill="#0550ae">attrs</text>
<text xml:space="preserve" text-anchor="start" x="97.75" y="-339.3" font-family="Monaco" font-size="11.00">;</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-321.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-321.05" font-family="Monaco" font-size="11.00" fill="#6e7781">// Two enums: one per target</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-302.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-302.8" font-family="Monaco" font-size="11.00" fill="#cf222e">pub enum</text>
<text xml:space="preserve" text-anchor="start" x="91" y="-302.8" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="97.75" y="-302.8" font-family="Monaco" font-size="11.00" fill="#0550ae">ContainerAttribute</text>
<text xml:space="preserve" text-anchor="start" x="219.25" y="-302.8" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-284.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;NodeName(</text>
<text xml:space="preserve" text-anchor="start" x="124.75" y="-284.55" font-family="Monaco" font-size="11.00" fill="#0550ae">&amp;&#39;static str</text>
<text xml:space="preserve" text-anchor="start" x="205.75" y="-284.55" font-family="Monaco" font-size="11.00">),</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-265.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-248.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-248.05" font-family="Monaco" font-size="11.00" fill="#cf222e">pub enum</text>
<text xml:space="preserve" text-anchor="start" x="91" y="-248.05" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="97.75" y="-248.05" font-family="Monaco" font-size="11.00" fill="#0550ae">FieldAttribute</text>
<text xml:space="preserve" text-anchor="start" x="192.25" y="-248.05" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-228.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Child,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-210.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Children,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-193.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Property(</text>
<text xml:space="preserve" text-anchor="start" x="124.75" y="-193.3" font-family="Monaco" font-size="11.00" fill="#0550ae">&amp;&#39;static str</text>
<text xml:space="preserve" text-anchor="start" x="205.75" y="-193.3" font-family="Monaco" font-size="11.00">),</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-174.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Argument,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-155.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Arguments,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-137.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-119.3" font-family="Monaco" font-size="11.00">}</text>
</g>
<g id="node2" class="node">
<title>make_parse</title>
<polygon fill="#e8e8f4" stroke="black" points="585.75,-281.75 383.5,-281.75 383.5,-219 585.75,-219 585.75,-281.75"/>
<polygon fill="#e8e8f4" stroke="none" points="391.5,-259.5 391.5,-277.75 577.75,-277.75 577.75,-259.5 391.5,-259.5"/>
<text xml:space="preserve" text-anchor="start" x="427.25" y="-266.3" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">facet&#45;macros&#45;impl</text>
<text xml:space="preserve" text-anchor="start" x="393.5" y="-248.05" font-family="Monaco" font-size="11.00">::facet::</text>
<text xml:space="preserve" text-anchor="start" x="454.25" y="-248.05" font-family="Monaco" font-size="11.00" fill="#8250df">__make_parse_attr!</text>
<text xml:space="preserve" text-anchor="start" x="423.88" y="-228.8" font-family="Monaco, Consolas, Courier" font-size="11.00">(grammar compiler)</text>
</g>
<g id="edge1" class="edge">
<title>grammar&#45;&gt;make_parse</title>
<path fill="none" stroke="#4169e1" stroke-width="2" d="M243.17,-250.38C284.16,-250.38 329.8,-250.38 370.2,-250.38"/>
<polygon fill="#4169e1" stroke="#4169e1" stroke-width="2" points="370.09,-253.88 380.09,-250.38 370.09,-246.88 370.09,-253.88"/>
<text xml:space="preserve" text-anchor="middle" x="313.12" y="-252.12" font-family="Helvetica,sans-Serif" font-size="10.00">compiles via</text>
</g>
<g id="node3" class="node">
<title>generated</title>
<polygon fill="#f0fff0" stroke="black" points="1112.5,-500.75 714.5,-500.75 714.5,0 1112.5,0 1112.5,-500.75"/>
<polygon fill="#d4edda" stroke="none" points="722.5,-478.5 722.5,-496.75 1104.5,-496.75 1104.5,-478.5 722.5,-478.5"/>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-485.3" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Generated in facet&#45;kdl</text>
<polygon fill="#e8f5e9" stroke="none" points="722.5,-460.25 722.5,-478.5 1104.5,-478.5 1104.5,-460.25 722.5,-460.25"/>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-467.05" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">1. Runtime types (in submodule)</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-448.8" font-family="Monaco" font-size="11.00" fill="#cf222e">pub mod</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-448.8" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="778.5" y="-448.8" font-family="Monaco" font-size="11.00" fill="#0550ae">attrs</text>
<text xml:space="preserve" text-anchor="start" x="812.25" y="-448.8" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-430.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="751.5" y="-430.55" font-family="Monaco" font-size="11.00" fill="#cf222e">pub enum</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-430.55" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="812.25" y="-430.55" font-family="Monaco" font-size="11.00" fill="#0550ae">ContainerAttribute</text>
<text xml:space="preserve" text-anchor="start" x="933.75" y="-430.55" font-family="Monaco" font-size="11.00"> { NodeName(</text>
<text xml:space="preserve" text-anchor="start" x="1014.75" y="-430.55" font-family="Monaco" font-size="11.00" fill="#0550ae">...</text>
<text xml:space="preserve" text-anchor="start" x="1035" y="-430.55" font-family="Monaco" font-size="11.00">) }</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-412.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="751.5" y="-412.3" font-family="Monaco" font-size="11.00" fill="#cf222e">pub enum</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-412.3" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="812.25" y="-412.3" font-family="Monaco" font-size="11.00" fill="#0550ae">FieldAttribute</text>
<text xml:space="preserve" text-anchor="start" x="906.75" y="-412.3" font-family="Monaco" font-size="11.00"> { Child, Children, ... }</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-393.05" font-family="Monaco" font-size="11.00">}</text>
<polygon fill="#fff3cd" stroke="none" points="722.5,-369 722.5,-387.25 1104.5,-387.25 1104.5,-369 722.5,-369"/>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-375.8" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">2. TWO COMPILED GRAMMARS</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-357.55" font-family="Monaco" font-size="11.00" fill="#cf222e">macro_rules!</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-357.55" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="812.25" y="-357.55" font-family="Monaco" font-size="11.00" fill="#8250df">__parse_container_attr</text>
<text xml:space="preserve" text-anchor="start" x="960.75" y="-357.55" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-339.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;(</text>
<text xml:space="preserve" text-anchor="start" x="758.25" y="-339.3" font-family="Monaco" font-size="11.00" fill="#953800">$name</text>
<text xml:space="preserve" text-anchor="start" x="792" y="-339.3" font-family="Monaco" font-size="11.00">:ident $(</text>
<text xml:space="preserve" text-anchor="start" x="852.75" y="-339.3" font-family="Monaco" font-size="11.00" fill="#953800">$rest</text>
<text xml:space="preserve" text-anchor="start" x="886.5" y="-339.3" font-family="Monaco" font-size="11.00">:tt)*) =&gt; {</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-321.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;::facet::</text>
<text xml:space="preserve" text-anchor="start" x="839.25" y="-321.05" font-family="Monaco" font-size="11.00" fill="#8250df">__dispatch_attr!</text>
<text xml:space="preserve" text-anchor="start" x="947.25" y="-321.05" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-302.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-302.8" font-family="Monaco" font-size="11.00" fill="#8250df">@ns</text>
<text xml:space="preserve" text-anchor="start" x="825.75" y="-302.8" font-family="Monaco" font-size="11.00"> { </text>
<text xml:space="preserve" text-anchor="start" x="846" y="-302.8" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;kdl&quot;</text>
<text xml:space="preserve" text-anchor="start" x="879.75" y="-302.8" font-family="Monaco" font-size="11.00"> }</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-284.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-284.55" font-family="Monaco" font-size="11.00" fill="#8250df">@variants</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-284.55" font-family="Monaco" font-size="11.00"> { node_name: newtype, ... }</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-265.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;...</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-247.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-228.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;};</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-210.55" font-family="Monaco" font-size="11.00">}</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-193.3" font-family="Monaco" font-size="11.00" fill="#cf222e">macro_rules!</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-193.3" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="812.25" y="-193.3" font-family="Monaco" font-size="11.00" fill="#8250df">__parse_field_attr</text>
<text xml:space="preserve" text-anchor="start" x="933.75" y="-193.3" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-175.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;(</text>
<text xml:space="preserve" text-anchor="start" x="758.25" y="-175.05" font-family="Monaco" font-size="11.00" fill="#953800">$name</text>
<text xml:space="preserve" text-anchor="start" x="792" y="-175.05" font-family="Monaco" font-size="11.00">:ident $(</text>
<text xml:space="preserve" text-anchor="start" x="852.75" y="-175.05" font-family="Monaco" font-size="11.00" fill="#953800">$rest</text>
<text xml:space="preserve" text-anchor="start" x="886.5" y="-175.05" font-family="Monaco" font-size="11.00">:tt)*) =&gt; {</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-156.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;::facet::</text>
<text xml:space="preserve" text-anchor="start" x="839.25" y="-156.8" font-family="Monaco" font-size="11.00" fill="#8250df">__dispatch_attr!</text>
<text xml:space="preserve" text-anchor="start" x="947.25" y="-156.8" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-138.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-138.55" font-family="Monaco" font-size="11.00" fill="#8250df">@ns</text>
<text xml:space="preserve" text-anchor="start" x="825.75" y="-138.55" font-family="Monaco" font-size="11.00"> { </text>
<text xml:space="preserve" text-anchor="start" x="846" y="-138.55" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;kdl&quot;</text>
<text xml:space="preserve" text-anchor="start" x="879.75" y="-138.55" font-family="Monaco" font-size="11.00"> }</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-120.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-120.3" font-family="Monaco" font-size="11.00" fill="#8250df">@variants</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-120.3" font-family="Monaco" font-size="11.00"> { child, children, property, ... }</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-101.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;...</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-82.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-64.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;};</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-46.3" font-family="Monaco" font-size="11.00">}</text>
<polygon fill="#e8f5e9" stroke="none" points="722.5,-22.25 722.5,-40.5 1104.5,-40.5 1104.5,-22.25 722.5,-22.25"/>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-29.05" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">3. Re&#45;exports (macro hygiene)</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-10.8" font-family="Monaco" font-size="11.00" fill="#cf222e">pub use</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-10.8" font-family="Monaco" font-size="11.00"> ::facet::{</text>
<text xml:space="preserve" text-anchor="start" x="846" y="-10.8" font-family="Monaco" font-size="11.00" fill="#8250df">__dispatch_attr</text>
<text xml:space="preserve" text-anchor="start" x="947.25" y="-10.8" font-family="Monaco" font-size="11.00">, </text>
<text xml:space="preserve" text-anchor="start" x="960.75" y="-10.8" font-family="Monaco" font-size="11.00" fill="#8250df">__attr_error</text>
<text xml:space="preserve" text-anchor="start" x="1041.75" y="-10.8" font-family="Monaco" font-size="11.00">, ...};</text>
</g>
<g id="edge2" class="edge">
<title>make_parse&#45;&gt;generated</title>
<path fill="none" stroke="#228b22" stroke-width="2" d="M586.25,-250.38C621.02,-250.38 661.4,-250.38 701.65,-250.38"/>
<polygon fill="#228b22" stroke="#228b22" stroke-width="2" points="701.4,-253.88 711.4,-250.38 701.4,-246.88 701.4,-253.88"/>
<text xml:space="preserve" text-anchor="middle" x="650.12" y="-252.12" font-family="Helvetica,sans-Serif" font-size="10.00">generates</text>
</g>
</g>
</svg>
      <p class="diagram-caption">Third-party crates get a namespaced grammar (ns: "kdl")</p>
    </div>

    <h3>1b. Grammar Definition Time (Built-in Attributes)</h3>
    <p>What <code>::facet::define_attributes!</code> generates for facet's own built-in attributes:</p>
    <div class="diagram">
      <svg width="1107pt" height="501pt"
 viewBox="0.00 0.00 1107.00 501.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 497.25)">
<title>grammar_definition_builtin</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-497.25 1103,-497.25 1103,4 -4,4"/>
<text xml:space="preserve" text-anchor="middle" x="549.5" y="-470.25" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="20.00">Grammar Definition Time (Built&#45;in Attributes)</text>
<g id="node1" class="node">
<title>grammar</title>
<polygon fill="#e8ffe8" stroke="black" points="242.75,-382.13 0,-382.13 0,-82.13 242.75,-82.13 242.75,-382.13"/>
<polygon fill="#e4ffe4" stroke="none" points="8,-359.88 8,-378.13 234.75,-378.13 234.75,-359.88 8,-359.88"/>
<text xml:space="preserve" text-anchor="start" x="10" y="-366.68" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Input: facet/src/lib.rs</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-348.43" font-family="Monaco" font-size="11.00">::facet::</text>
<text xml:space="preserve" text-anchor="start" x="70.75" y="-348.43" font-family="Monaco" font-size="11.00" fill="#8250df">define_attributes!</text>
<text xml:space="preserve" text-anchor="start" x="192.25" y="-348.43" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-330.18" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-330.18" font-family="Monaco" font-size="11.00" fill="#cf222e">mod</text>
<text xml:space="preserve" text-anchor="start" x="57.25" y="-330.18" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="64" y="-330.18" font-family="Monaco" font-size="11.00" fill="#0550ae">builtin</text>
<text xml:space="preserve" text-anchor="start" x="111.25" y="-330.18" font-family="Monaco" font-size="11.00">;</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-311.93" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-311.93" font-family="Monaco" font-size="11.00" fill="#6e7781">// Two enums: one per target</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-293.68" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-293.68" font-family="Monaco" font-size="11.00" fill="#cf222e">pub enum</text>
<text xml:space="preserve" text-anchor="start" x="91" y="-293.68" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="97.75" y="-293.68" font-family="Monaco" font-size="11.00" fill="#0550ae">ContainerAttribute</text>
<text xml:space="preserve" text-anchor="start" x="219.25" y="-293.68" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-275.43" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;RenameAll(</text>
<text xml:space="preserve" text-anchor="start" x="131.5" y="-275.43" font-family="Monaco" font-size="11.00" fill="#0550ae">&amp;&#39;static str</text>
<text xml:space="preserve" text-anchor="start" x="212.5" y="-275.43" font-family="Monaco" font-size="11.00">),</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-256.18" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Transparent,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-237.93" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;DenyUnknownFields,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-219.68" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Default,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-201.43" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-184.18" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-184.18" font-family="Monaco" font-size="11.00" fill="#cf222e">pub enum</text>
<text xml:space="preserve" text-anchor="start" x="91" y="-184.18" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="97.75" y="-184.18" font-family="Monaco" font-size="11.00" fill="#0550ae">FieldAttribute</text>
<text xml:space="preserve" text-anchor="start" x="192.25" y="-184.18" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-164.93" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Skip,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-147.68" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Rename(</text>
<text xml:space="preserve" text-anchor="start" x="111.25" y="-147.68" font-family="Monaco" font-size="11.00" fill="#0550ae">&amp;&#39;static str</text>
<text xml:space="preserve" text-anchor="start" x="192.25" y="-147.68" font-family="Monaco" font-size="11.00">),</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-129.43" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Default, &#160;</text>
<text xml:space="preserve" text-anchor="start" x="131.5" y="-129.43" font-family="Monaco" font-size="11.00" fill="#6e7781">// in both!</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-110.18" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-91.93" font-family="Monaco" font-size="11.00">}</text>
</g>
<g id="node2" class="node">
<title>make_parse</title>
<polygon fill="#e8e8f4" stroke="black" points="585.75,-263.5 383.5,-263.5 383.5,-200.75 585.75,-200.75 585.75,-263.5"/>
<polygon fill="#e8e8f4" stroke="none" points="391.5,-241.25 391.5,-259.5 577.75,-259.5 577.75,-241.25 391.5,-241.25"/>
<text xml:space="preserve" text-anchor="start" x="427.25" y="-248.05" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">facet&#45;macros&#45;impl</text>
<text xml:space="preserve" text-anchor="start" x="393.5" y="-229.8" font-family="Monaco" font-size="11.00">::facet::</text>
<text xml:space="preserve" text-anchor="start" x="454.25" y="-229.8" font-family="Monaco" font-size="11.00" fill="#8250df">__make_parse_attr!</text>
<text xml:space="preserve" text-anchor="start" x="423.88" y="-210.55" font-family="Monaco, Consolas, Courier" font-size="11.00">(grammar compiler)</text>
</g>
<g id="edge1" class="edge">
<title>grammar&#45;&gt;make_parse</title>
<path fill="none" stroke="#4169e1" stroke-width="2" d="M243.17,-232.13C284.16,-232.13 329.8,-232.13 370.2,-232.13"/>
<polygon fill="#4169e1" stroke="#4169e1" stroke-width="2" points="370.09,-235.63 380.09,-232.13 370.09,-228.63 370.09,-235.63"/>
<text xml:space="preserve" text-anchor="middle" x="313.12" y="-233.88" font-family="Helvetica,sans-Serif" font-size="10.00">compiles via</text>
</g>
<g id="node3" class="node">
<title>generated</title>
<polygon fill="#f0fff0" stroke="black" points="1099,-464.25 714.5,-464.25 714.5,0 1099,0 1099,-464.25"/>
<polygon fill="#d4edda" stroke="none" points="722.5,-442 722.5,-460.25 1091,-460.25 1091,-442 722.5,-442"/>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-448.8" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Generated in facet</text>
<polygon fill="#e8f5e9" stroke="none" points="722.5,-423.75 722.5,-442 1091,-442 1091,-423.75 722.5,-423.75"/>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-430.55" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">1. Runtime types (in submodule)</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-412.3" font-family="Monaco" font-size="11.00" fill="#cf222e">pub mod</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-412.3" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="778.5" y="-412.3" font-family="Monaco" font-size="11.00" fill="#0550ae">builtin</text>
<text xml:space="preserve" text-anchor="start" x="825.75" y="-412.3" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-394.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="751.5" y="-394.05" font-family="Monaco" font-size="11.00" fill="#cf222e">pub enum</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-394.05" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="812.25" y="-394.05" font-family="Monaco" font-size="11.00" fill="#0550ae">ContainerAttribute</text>
<text xml:space="preserve" text-anchor="start" x="933.75" y="-394.05" font-family="Monaco" font-size="11.00"> { ... }</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-375.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="751.5" y="-375.8" font-family="Monaco" font-size="11.00" fill="#cf222e">pub enum</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-375.8" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="812.25" y="-375.8" font-family="Monaco" font-size="11.00" fill="#0550ae">FieldAttribute</text>
<text xml:space="preserve" text-anchor="start" x="906.75" y="-375.8" font-family="Monaco" font-size="11.00"> { ... }</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-356.55" font-family="Monaco" font-size="11.00">}</text>
<polygon fill="#fff3cd" stroke="none" points="722.5,-332.5 722.5,-350.75 1091,-350.75 1091,-332.5 722.5,-332.5"/>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-339.3" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">2. TWO COMPILED GRAMMARS</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-321.05" font-family="Monaco" font-size="11.00" fill="#cf222e">macro_rules!</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-321.05" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="812.25" y="-321.05" font-family="Monaco" font-size="11.00" fill="#8250df">__parse_container_attr</text>
<text xml:space="preserve" text-anchor="start" x="960.75" y="-321.05" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-302.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;(</text>
<text xml:space="preserve" text-anchor="start" x="758.25" y="-302.8" font-family="Monaco" font-size="11.00" fill="#953800">$name</text>
<text xml:space="preserve" text-anchor="start" x="792" y="-302.8" font-family="Monaco" font-size="11.00">:ident $(</text>
<text xml:space="preserve" text-anchor="start" x="852.75" y="-302.8" font-family="Monaco" font-size="11.00" fill="#953800">$rest</text>
<text xml:space="preserve" text-anchor="start" x="886.5" y="-302.8" font-family="Monaco" font-size="11.00">:tt)*) =&gt; {</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-284.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;::facet::</text>
<text xml:space="preserve" text-anchor="start" x="839.25" y="-284.55" font-family="Monaco" font-size="11.00" fill="#8250df">__dispatch_attr!</text>
<text xml:space="preserve" text-anchor="start" x="947.25" y="-284.55" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-266.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-266.3" font-family="Monaco" font-size="11.00" fill="#6e7781">// no @ns &#45; built&#45;in attributes</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-248.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-248.05" font-family="Monaco" font-size="11.00" fill="#8250df">@variants</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-248.05" font-family="Monaco" font-size="11.00"> { rename_all, transparent, ... }</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-228.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;...</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-210.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-192.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;};</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-174.05" font-family="Monaco" font-size="11.00">}</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-156.8" font-family="Monaco" font-size="11.00" fill="#cf222e">macro_rules!</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-156.8" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="812.25" y="-156.8" font-family="Monaco" font-size="11.00" fill="#8250df">__parse_field_attr</text>
<text xml:space="preserve" text-anchor="start" x="933.75" y="-156.8" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-138.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;(</text>
<text xml:space="preserve" text-anchor="start" x="758.25" y="-138.55" font-family="Monaco" font-size="11.00" fill="#953800">$name</text>
<text xml:space="preserve" text-anchor="start" x="792" y="-138.55" font-family="Monaco" font-size="11.00">:ident $(</text>
<text xml:space="preserve" text-anchor="start" x="852.75" y="-138.55" font-family="Monaco" font-size="11.00" fill="#953800">$rest</text>
<text xml:space="preserve" text-anchor="start" x="886.5" y="-138.55" font-family="Monaco" font-size="11.00">:tt)*) =&gt; {</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-120.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;::facet::</text>
<text xml:space="preserve" text-anchor="start" x="839.25" y="-120.3" font-family="Monaco" font-size="11.00" fill="#8250df">__dispatch_attr!</text>
<text xml:space="preserve" text-anchor="start" x="947.25" y="-120.3" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-102.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-102.05" font-family="Monaco" font-size="11.00" fill="#6e7781">// no @ns &#45; built&#45;in attributes</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-83.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-83.8" font-family="Monaco" font-size="11.00" fill="#8250df">@variants</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-83.8" font-family="Monaco" font-size="11.00"> { skip, rename, default, ... }</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-64.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;...</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-46.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-28.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;};</text>
<text xml:space="preserve" text-anchor="start" x="724.5" y="-9.8" font-family="Monaco" font-size="11.00">}</text>
</g>
<g id="edge2" class="edge">
<title>make_parse&#45;&gt;generated</title>
<path fill="none" stroke="#228b22" stroke-width="2" d="M585.99,-232.13C620.81,-232.13 661.23,-232.13 701.37,-232.13"/>
<polygon fill="#228b22" stroke="#228b22" stroke-width="2" points="701.36,-235.63 711.36,-232.13 701.36,-228.63 701.36,-235.63"/>
<text xml:space="preserve" text-anchor="middle" x="650.12" y="-233.88" font-family="Helvetica,sans-Serif" font-size="10.00">generates</text>
</g>
</g>
</svg>
      <p class="diagram-caption">Built-in attributes have no namespace - they're accessed directly</p>
    </div>

    <!-- Old diagram removed, replaced by 1a and 1b above -->
    <div style="display:none">
      <svg width="1350pt" height="483pt"
 viewBox="0.00 0.00 1350.00 483.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 479)">
<title>grammar_definition</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-479 1346,-479 1346,4 -4,4"/>
<text xml:space="preserve" text-anchor="middle" x="671" y="-452" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="20.00">Grammar Definition Time</text>
<g id="node1" class="node">
<title>grammar</title>
<polygon fill="#fff8f0" stroke="black" points="384.5,-400.38 0,-400.38 0,-45.62 384.5,-45.62 384.5,-400.38"/>
<polygon fill="#ffe4c4" stroke="none" points="8,-378.12 8,-396.38 376.5,-396.38 376.5,-378.12 8,-378.12"/>
<text xml:space="preserve" text-anchor="start" x="10" y="-384.93" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Input: facet&#45;kdl/src/lib.rs</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-366.68" font-family="Monaco" font-size="11.00">::facet::</text>
<text xml:space="preserve" text-anchor="start" x="70.75" y="-366.68" font-family="Monaco" font-size="11.00" fill="#8250df">define_attributes!</text>
<text xml:space="preserve" text-anchor="start" x="192.25" y="-366.68" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-348.43" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-348.43" font-family="Monaco" font-size="11.00" fill="#cf222e">mod</text>
<text xml:space="preserve" text-anchor="start" x="57.25" y="-348.43" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="64" y="-348.43" font-family="Monaco" font-size="11.00" fill="#0550ae">attrs</text>
<text xml:space="preserve" text-anchor="start" x="97.75" y="-348.43" font-family="Monaco" font-size="11.00">; &#160;</text>
<text xml:space="preserve" text-anchor="start" x="118" y="-348.43" font-family="Monaco" font-size="11.00" fill="#6e7781">// generated submodule</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-330.18" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-330.18" font-family="Monaco" font-size="11.00" fill="#cf222e">pub enum</text>
<text xml:space="preserve" text-anchor="start" x="91" y="-330.18" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="97.75" y="-330.18" font-family="Monaco" font-size="11.00" fill="#0550ae">Attribute</text>
<text xml:space="preserve" text-anchor="start" x="158.5" y="-330.18" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-311.93" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-311.93" font-family="Monaco" font-size="11.00" fill="#6e7781">// target = field | container | both (default)</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-293.68" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;#[</text>
<text xml:space="preserve" text-anchor="start" x="77.5" y="-293.68" font-family="Monaco" font-size="11.00" fill="#8250df">target</text>
<text xml:space="preserve" text-anchor="start" x="118" y="-293.68" font-family="Monaco" font-size="11.00">(both)]</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-275.43" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Child, &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="219.25" y="-275.43" font-family="Monaco" font-size="11.00" fill="#6e7781">// unit variant</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-257.18" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;#[</text>
<text xml:space="preserve" text-anchor="start" x="77.5" y="-257.18" font-family="Monaco" font-size="11.00" fill="#8250df">target</text>
<text xml:space="preserve" text-anchor="start" x="118" y="-257.18" font-family="Monaco" font-size="11.00">(field)]</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-238.93" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Rename(</text>
<text xml:space="preserve" text-anchor="start" x="111.25" y="-238.93" font-family="Monaco" font-size="11.00" fill="#0550ae">&amp;&#39;static str</text>
<text xml:space="preserve" text-anchor="start" x="192.25" y="-238.93" font-family="Monaco" font-size="11.00">), &#160;</text>
<text xml:space="preserve" text-anchor="start" x="219.25" y="-238.93" font-family="Monaco" font-size="11.00" fill="#6e7781">// newtype</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-220.68" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;#[</text>
<text xml:space="preserve" text-anchor="start" x="77.5" y="-220.68" font-family="Monaco" font-size="11.00" fill="#8250df">target</text>
<text xml:space="preserve" text-anchor="start" x="118" y="-220.68" font-family="Monaco" font-size="11.00">(field)]</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-202.43" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Column(</text>
<text xml:space="preserve" text-anchor="start" x="111.25" y="-202.43" font-family="Monaco" font-size="11.00" fill="#0550ae">Column</text>
<text xml:space="preserve" text-anchor="start" x="151.75" y="-202.43" font-family="Monaco" font-size="11.00">), &#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="219.25" y="-202.43" font-family="Monaco" font-size="11.00" fill="#6e7781">// struct</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-184.18" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;#[</text>
<text xml:space="preserve" text-anchor="start" x="77.5" y="-184.18" font-family="Monaco" font-size="11.00" fill="#8250df">target</text>
<text xml:space="preserve" text-anchor="start" x="118" y="-184.18" font-family="Monaco" font-size="11.00">(container)]</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-165.93" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Transparent, &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="219.25" y="-165.93" font-family="Monaco" font-size="11.00" fill="#6e7781">// container&#45;only</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-146.68" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-129.43" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-129.43" font-family="Monaco" font-size="11.00" fill="#cf222e">pub struct</text>
<text xml:space="preserve" text-anchor="start" x="104.5" y="-129.43" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="111.25" y="-129.43" font-family="Monaco" font-size="11.00" fill="#0550ae">Column</text>
<text xml:space="preserve" text-anchor="start" x="151.75" y="-129.43" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-111.17" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-111.17" font-family="Monaco" font-size="11.00" fill="#cf222e">pub</text>
<text xml:space="preserve" text-anchor="start" x="84.25" y="-111.17" font-family="Monaco" font-size="11.00"> primary_key: </text>
<text xml:space="preserve" text-anchor="start" x="178.75" y="-111.17" font-family="Monaco" font-size="11.00" fill="#0550ae">bool</text>
<text xml:space="preserve" text-anchor="start" x="205.75" y="-111.17" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-92.92" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-92.92" font-family="Monaco" font-size="11.00" fill="#cf222e">pub</text>
<text xml:space="preserve" text-anchor="start" x="84.25" y="-92.92" font-family="Monaco" font-size="11.00"> name: </text>
<text xml:space="preserve" text-anchor="start" x="131.5" y="-92.92" font-family="Monaco" font-size="11.00" fill="#0550ae">Option</text>
<text xml:space="preserve" text-anchor="start" x="172" y="-92.92" font-family="Monaco" font-size="11.00">&lt;</text>
<text xml:space="preserve" text-anchor="start" x="178.75" y="-92.92" font-family="Monaco" font-size="11.00" fill="#0550ae">&amp;&#39;static str</text>
<text xml:space="preserve" text-anchor="start" x="259.75" y="-92.92" font-family="Monaco" font-size="11.00">&gt;,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-73.67" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-55.42" font-family="Monaco" font-size="11.00">}</text>
</g>
<g id="node2" class="node">
<title>make_parse</title>
<polygon fill="#e8e8f4" stroke="black" points="727.5,-254.38 525.25,-254.38 525.25,-191.62 727.5,-191.62 727.5,-254.38"/>
<polygon fill="#e8e8f4" stroke="none" points="533.25,-232.12 533.25,-250.38 719.5,-250.38 719.5,-232.12 533.25,-232.12"/>
<text xml:space="preserve" text-anchor="start" x="569" y="-238.93" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">facet&#45;macros&#45;impl</text>
<text xml:space="preserve" text-anchor="start" x="535.25" y="-220.68" font-family="Monaco" font-size="11.00">::facet::</text>
<text xml:space="preserve" text-anchor="start" x="596" y="-220.68" font-family="Monaco" font-size="11.00" fill="#8250df">__make_parse_attr!</text>
<text xml:space="preserve" text-anchor="start" x="565.62" y="-201.43" font-family="Monaco, Consolas, Courier" font-size="11.00">(grammar compiler)</text>
</g>
<g id="edge1" class="edge">
<title>grammar&#45;&gt;make_parse</title>
<path fill="none" stroke="#4169e1" stroke-width="2" d="M384.99,-223C428.36,-223 473.06,-223 511.97,-223"/>
<polygon fill="#4169e1" stroke="#4169e1" stroke-width="2" points="511.9,-226.5 521.9,-223 511.9,-219.5 511.9,-226.5"/>
<text xml:space="preserve" text-anchor="middle" x="454.88" y="-224.75" font-family="Helvetica,sans-Serif" font-size="10.00">compiles via</text>
</g>
<g id="node3" class="node">
<title>generated</title>
<polygon fill="#f0fff0" stroke="black" points="1342,-446 856.25,-446 856.25,0 1342,0 1342,-446"/>
<polygon fill="#d4edda" stroke="none" points="864.25,-423.75 864.25,-442 1334,-442 1334,-423.75 864.25,-423.75"/>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-430.55" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Generated in facet&#45;kdl</text>
<polygon fill="#e8f5e9" stroke="none" points="864.25,-405.5 864.25,-423.75 1334,-423.75 1334,-405.5 864.25,-405.5"/>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-412.3" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">1. Runtime types (in submodule)</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-394.05" font-family="Monaco" font-size="11.00" fill="#cf222e">pub mod</text>
<text xml:space="preserve" text-anchor="start" x="913.5" y="-394.05" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="920.25" y="-394.05" font-family="Monaco" font-size="11.00" fill="#0550ae">attrs</text>
<text xml:space="preserve" text-anchor="start" x="954" y="-394.05" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-375.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="893.25" y="-375.8" font-family="Monaco" font-size="11.00" fill="#cf222e">pub enum</text>
<text xml:space="preserve" text-anchor="start" x="947.25" y="-375.8" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="954" y="-375.8" font-family="Monaco" font-size="11.00" fill="#0550ae">Attribute</text>
<text xml:space="preserve" text-anchor="start" x="1014.75" y="-375.8" font-family="Monaco" font-size="11.00"> { Child, Rename(</text>
<text xml:space="preserve" text-anchor="start" x="1129.5" y="-375.8" font-family="Monaco" font-size="11.00" fill="#0550ae">...</text>
<text xml:space="preserve" text-anchor="start" x="1149.75" y="-375.8" font-family="Monaco" font-size="11.00">), Column(</text>
<text xml:space="preserve" text-anchor="start" x="1217.25" y="-375.8" font-family="Monaco" font-size="11.00" fill="#0550ae">...</text>
<text xml:space="preserve" text-anchor="start" x="1237.5" y="-375.8" font-family="Monaco" font-size="11.00">) }</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-357.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="893.25" y="-357.55" font-family="Monaco" font-size="11.00" fill="#cf222e">pub struct</text>
<text xml:space="preserve" text-anchor="start" x="960.75" y="-357.55" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="967.5" y="-357.55" font-family="Monaco" font-size="11.00" fill="#0550ae">Column</text>
<text xml:space="preserve" text-anchor="start" x="1008" y="-357.55" font-family="Monaco" font-size="11.00"> { primary_key: </text>
<text xml:space="preserve" text-anchor="start" x="1116" y="-357.55" font-family="Monaco" font-size="11.00" fill="#0550ae">bool</text>
<text xml:space="preserve" text-anchor="start" x="1143" y="-357.55" font-family="Monaco" font-size="11.00">, ... }</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-338.3" font-family="Monaco" font-size="11.00">}</text>
<polygon fill="#fff3cd" stroke="none" points="864.25,-314.25 864.25,-332.5 1334,-332.5 1334,-314.25 864.25,-314.25"/>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-321.05" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">2. THE COMPILED GRAMMAR (declarative macro)</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-302.8" font-family="Monaco" font-size="11.00" fill="#cf222e">macro_rules!</text>
<text xml:space="preserve" text-anchor="start" x="947.25" y="-302.8" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="954" y="-302.8" font-family="Monaco" font-size="11.00" fill="#8250df">__parse_attr</text>
<text xml:space="preserve" text-anchor="start" x="1035" y="-302.8" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-284.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;(</text>
<text xml:space="preserve" text-anchor="start" x="900" y="-284.55" font-family="Monaco" font-size="11.00" fill="#8250df">@context</text>
<text xml:space="preserve" text-anchor="start" x="954" y="-284.55" font-family="Monaco" font-size="11.00">{</text>
<text xml:space="preserve" text-anchor="start" x="960.75" y="-284.55" font-family="Monaco" font-size="11.00" fill="#953800">$ctx</text>
<text xml:space="preserve" text-anchor="start" x="987.75" y="-284.55" font-family="Monaco" font-size="11.00">:ident} </text>
<text xml:space="preserve" text-anchor="start" x="1041.75" y="-284.55" font-family="Monaco" font-size="11.00" fill="#953800">$name</text>
<text xml:space="preserve" text-anchor="start" x="1075.5" y="-284.55" font-family="Monaco" font-size="11.00">:ident $(</text>
<text xml:space="preserve" text-anchor="start" x="1136.25" y="-284.55" font-family="Monaco" font-size="11.00" fill="#953800">$rest</text>
<text xml:space="preserve" text-anchor="start" x="1170" y="-284.55" font-family="Monaco" font-size="11.00">:tt)*) =&gt; {</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-266.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;::facet::</text>
<text xml:space="preserve" text-anchor="start" x="981" y="-266.3" font-family="Monaco" font-size="11.00" fill="#8250df">__dispatch_attr!</text>
<text xml:space="preserve" text-anchor="start" x="1089" y="-266.3" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-248.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="947.25" y="-248.05" font-family="Monaco" font-size="11.00" fill="#8250df">@ns</text>
<text xml:space="preserve" text-anchor="start" x="967.5" y="-248.05" font-family="Monaco" font-size="11.00"> { </text>
<text xml:space="preserve" text-anchor="start" x="987.75" y="-248.05" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;kdl&quot;</text>
<text xml:space="preserve" text-anchor="start" x="1021.5" y="-248.05" font-family="Monaco" font-size="11.00"> }</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-229.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="947.25" y="-229.8" font-family="Monaco" font-size="11.00" fill="#8250df">@context</text>
<text xml:space="preserve" text-anchor="start" x="1001.25" y="-229.8" font-family="Monaco" font-size="11.00"> { </text>
<text xml:space="preserve" text-anchor="start" x="1021.5" y="-229.8" font-family="Monaco" font-size="11.00" fill="#953800">$ctx</text>
<text xml:space="preserve" text-anchor="start" x="1048.5" y="-229.8" font-family="Monaco" font-size="11.00"> } </text>
<text xml:space="preserve" text-anchor="start" x="1068.75" y="-229.8" font-family="Monaco" font-size="11.00" fill="#6e7781">// field | container</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-211.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="947.25" y="-211.55" font-family="Monaco" font-size="11.00" fill="#8250df">@variants</text>
<text xml:space="preserve" text-anchor="start" x="1008" y="-211.55" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-193.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;child: unit </text>
<text xml:space="preserve" text-anchor="start" x="1055.25" y="-193.3" font-family="Monaco" font-size="11.00" fill="#8250df">@target</text>
<text xml:space="preserve" text-anchor="start" x="1102.5" y="-193.3" font-family="Monaco" font-size="11.00">(both),</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-175.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;rename: newtype </text>
<text xml:space="preserve" text-anchor="start" x="1082.25" y="-175.05" font-family="Monaco" font-size="11.00" fill="#8250df">@target</text>
<text xml:space="preserve" text-anchor="start" x="1129.5" y="-175.05" font-family="Monaco" font-size="11.00">(field),</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-156.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;column: rec { pk:</text>
<text xml:space="preserve" text-anchor="start" x="1089" y="-156.8" font-family="Monaco" font-size="11.00" fill="#0550ae">bool</text>
<text xml:space="preserve" text-anchor="start" x="1116" y="-156.8" font-family="Monaco" font-size="11.00">, name:</text>
<text xml:space="preserve" text-anchor="start" x="1163.25" y="-156.8" font-family="Monaco" font-size="11.00" fill="#0550ae">opt_str</text>
<text xml:space="preserve" text-anchor="start" x="1210.5" y="-156.8" font-family="Monaco" font-size="11.00"> } </text>
<text xml:space="preserve" text-anchor="start" x="1230.75" y="-156.8" font-family="Monaco" font-size="11.00" fill="#8250df">@target</text>
<text xml:space="preserve" text-anchor="start" x="1278" y="-156.8" font-family="Monaco" font-size="11.00">(field),</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-138.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;transparent: unit </text>
<text xml:space="preserve" text-anchor="start" x="1095.75" y="-138.55" font-family="Monaco" font-size="11.00" fill="#8250df">@target</text>
<text xml:space="preserve" text-anchor="start" x="1143" y="-138.55" font-family="Monaco" font-size="11.00">(container),</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-119.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-102.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="947.25" y="-102.05" font-family="Monaco" font-size="11.00" fill="#8250df">@name</text>
<text xml:space="preserve" text-anchor="start" x="981" y="-102.05" font-family="Monaco" font-size="11.00"> { </text>
<text xml:space="preserve" text-anchor="start" x="1001.25" y="-102.05" font-family="Monaco" font-size="11.00" fill="#953800">$name</text>
<text xml:space="preserve" text-anchor="start" x="1035" y="-102.05" font-family="Monaco" font-size="11.00"> } </text>
<text xml:space="preserve" text-anchor="start" x="1055.25" y="-102.05" font-family="Monaco" font-size="11.00" fill="#8250df">@rest</text>
<text xml:space="preserve" text-anchor="start" x="1089" y="-102.05" font-family="Monaco" font-size="11.00"> { $(</text>
<text xml:space="preserve" text-anchor="start" x="1122.75" y="-102.05" font-family="Monaco" font-size="11.00" fill="#953800">$rest</text>
<text xml:space="preserve" text-anchor="start" x="1156.5" y="-102.05" font-family="Monaco" font-size="11.00">)* }</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-82.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-64.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;};</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-46.3" font-family="Monaco" font-size="11.00">}</text>
<polygon fill="#e8f5e9" stroke="none" points="864.25,-22.25 864.25,-40.5 1334,-40.5 1334,-22.25 864.25,-22.25"/>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-29.05" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">3. Re&#45;exports (macro hygiene)</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-10.8" font-family="Monaco" font-size="11.00" fill="#cf222e">pub use</text>
<text xml:space="preserve" text-anchor="start" x="913.5" y="-10.8" font-family="Monaco" font-size="11.00"> ::facet::{</text>
<text xml:space="preserve" text-anchor="start" x="987.75" y="-10.8" font-family="Monaco" font-size="11.00" fill="#8250df">__dispatch_attr</text>
<text xml:space="preserve" text-anchor="start" x="1089" y="-10.8" font-family="Monaco" font-size="11.00">, </text>
<text xml:space="preserve" text-anchor="start" x="1102.5" y="-10.8" font-family="Monaco" font-size="11.00" fill="#8250df">__attr_error</text>
<text xml:space="preserve" text-anchor="start" x="1183.5" y="-10.8" font-family="Monaco" font-size="11.00">, ...};</text>
</g>
<g id="edge2" class="edge">
<title>make_parse&#45;&gt;generated</title>
<path fill="none" stroke="#228b22" stroke-width="2" d="M727.79,-223C762.09,-223 802.18,-223 843.06,-223"/>
<polygon fill="#228b22" stroke="#228b22" stroke-width="2" points="843.04,-226.5 853.04,-223 843.04,-219.5 843.04,-226.5"/>
<text xml:space="preserve" text-anchor="middle" x="791.88" y="-224.75" font-family="Helvetica,sans-Serif" font-size="10.00">generates</text>
</g>
</g>
</svg>
      <p class="diagram-caption">Built-in attributes have no namespace prefix</p>
    </div>

    <h3>1c. Grammar Definition Time (Complex Nested Types)</h3>
    <p>What happens when your attribute grammar includes user-defined structs and enums nested inside variants:</p>
    <div class="diagram">
      <svg width="1800pt" height="885pt"
 viewBox="0.00 0.00 1800.00 885.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 880.5)">
<title>grammar_definition_complex</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-880.5 1796.25,-880.5 1796.25,4 -4,4"/>
<text xml:space="preserve" text-anchor="middle" x="896.12" y="-853.5" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="20.00">Grammar Definition Time (Complex Nested Types)</text>
<g id="node1" class="node">
<title>grammar</title>
<polygon fill="#fff0f8" stroke="black" points="290,-765.38 0,-765.38 0,-82.12 290,-82.12 290,-765.38"/>
<polygon fill="#ffe4f0" stroke="none" points="8,-743.12 8,-761.38 282,-761.38 282,-743.12 8,-743.12"/>
<text xml:space="preserve" text-anchor="start" x="10" y="-749.92" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Input: facet&#45;orm/src/lib.rs</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-731.67" font-family="Monaco" font-size="11.00">::facet::</text>
<text xml:space="preserve" text-anchor="start" x="70.75" y="-731.67" font-family="Monaco" font-size="11.00" fill="#8250df">define_attributes!</text>
<text xml:space="preserve" text-anchor="start" x="192.25" y="-731.67" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-713.42" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-713.42" font-family="Monaco" font-size="11.00" fill="#cf222e">mod</text>
<text xml:space="preserve" text-anchor="start" x="57.25" y="-713.42" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="64" y="-713.42" font-family="Monaco" font-size="11.00" fill="#0550ae">attrs</text>
<text xml:space="preserve" text-anchor="start" x="97.75" y="-713.42" font-family="Monaco" font-size="11.00">;</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-695.17" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-695.17" font-family="Monaco" font-size="11.00" fill="#cf222e">ns</text>
<text xml:space="preserve" text-anchor="start" x="50.5" y="-695.17" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="57.25" y="-695.17" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;orm&quot;</text>
<text xml:space="preserve" text-anchor="start" x="91" y="-695.17" font-family="Monaco" font-size="11.00">;</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-676.92" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-676.92" font-family="Monaco" font-size="11.00" fill="#cf222e">pub enum</text>
<text xml:space="preserve" text-anchor="start" x="91" y="-676.92" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="97.75" y="-676.92" font-family="Monaco" font-size="11.00" fill="#0550ae">ContainerAttribute</text>
<text xml:space="preserve" text-anchor="start" x="219.25" y="-676.92" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-658.67" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Table(</text>
<text xml:space="preserve" text-anchor="start" x="104.5" y="-658.67" font-family="Monaco" font-size="11.00" fill="#0550ae">Table</text>
<text xml:space="preserve" text-anchor="start" x="138.25" y="-658.67" font-family="Monaco" font-size="11.00">),</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-639.42" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-622.17" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-622.17" font-family="Monaco" font-size="11.00" fill="#cf222e">pub enum</text>
<text xml:space="preserve" text-anchor="start" x="91" y="-622.17" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="97.75" y="-622.17" font-family="Monaco" font-size="11.00" fill="#0550ae">FieldAttribute</text>
<text xml:space="preserve" text-anchor="start" x="192.25" y="-622.17" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-603.92" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Column(</text>
<text xml:space="preserve" text-anchor="start" x="111.25" y="-603.92" font-family="Monaco" font-size="11.00" fill="#0550ae">Column</text>
<text xml:space="preserve" text-anchor="start" x="151.75" y="-603.92" font-family="Monaco" font-size="11.00">),</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-585.67" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Index(</text>
<text xml:space="preserve" text-anchor="start" x="104.5" y="-585.67" font-family="Monaco" font-size="11.00" fill="#0550ae">Index</text>
<text xml:space="preserve" text-anchor="start" x="138.25" y="-585.67" font-family="Monaco" font-size="11.00">),</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-567.42" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;ForeignKey(</text>
<text xml:space="preserve" text-anchor="start" x="138.25" y="-567.42" font-family="Monaco" font-size="11.00" fill="#0550ae">ForeignKey</text>
<text xml:space="preserve" text-anchor="start" x="205.75" y="-567.42" font-family="Monaco" font-size="11.00">),</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-548.17" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;}</text>
<polygon fill="#fff3cd" stroke="none" points="8,-524.12 8,-542.38 282,-542.38 282,-524.12 8,-524.12"/>
<text xml:space="preserve" text-anchor="start" x="10" y="-530.92" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-530.92" font-family="Monaco" font-size="11.00" fill="#6e7781">// User&#45;defined structs inside macro</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-512.67" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-512.67" font-family="Monaco" font-size="11.00" fill="#cf222e">pub struct</text>
<text xml:space="preserve" text-anchor="start" x="104.5" y="-512.67" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="111.25" y="-512.67" font-family="Monaco" font-size="11.00" fill="#0550ae">Table</text>
<text xml:space="preserve" text-anchor="start" x="145" y="-512.67" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-494.43" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-494.43" font-family="Monaco" font-size="11.00" fill="#cf222e">pub</text>
<text xml:space="preserve" text-anchor="start" x="84.25" y="-494.43" font-family="Monaco" font-size="11.00"> name: </text>
<text xml:space="preserve" text-anchor="start" x="131.5" y="-494.43" font-family="Monaco" font-size="11.00" fill="#0550ae">Option&lt;&amp;&#39;static str&gt;</text>
<text xml:space="preserve" text-anchor="start" x="266.5" y="-494.43" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-475.18" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-457.93" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-457.93" font-family="Monaco" font-size="11.00" fill="#cf222e">pub struct</text>
<text xml:space="preserve" text-anchor="start" x="104.5" y="-457.93" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="111.25" y="-457.93" font-family="Monaco" font-size="11.00" fill="#0550ae">Column</text>
<text xml:space="preserve" text-anchor="start" x="151.75" y="-457.93" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-439.68" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-439.68" font-family="Monaco" font-size="11.00" fill="#cf222e">pub</text>
<text xml:space="preserve" text-anchor="start" x="84.25" y="-439.68" font-family="Monaco" font-size="11.00"> name: </text>
<text xml:space="preserve" text-anchor="start" x="131.5" y="-439.68" font-family="Monaco" font-size="11.00" fill="#0550ae">Option&lt;&amp;&#39;static str&gt;</text>
<text xml:space="preserve" text-anchor="start" x="266.5" y="-439.68" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-421.43" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-421.43" font-family="Monaco" font-size="11.00" fill="#cf222e">pub</text>
<text xml:space="preserve" text-anchor="start" x="84.25" y="-421.43" font-family="Monaco" font-size="11.00"> primary_key: </text>
<text xml:space="preserve" text-anchor="start" x="178.75" y="-421.43" font-family="Monaco" font-size="11.00" fill="#0550ae">bool</text>
<text xml:space="preserve" text-anchor="start" x="205.75" y="-421.43" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-403.18" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-403.18" font-family="Monaco" font-size="11.00" fill="#cf222e">pub</text>
<text xml:space="preserve" text-anchor="start" x="84.25" y="-403.18" font-family="Monaco" font-size="11.00"> auto_increment: </text>
<text xml:space="preserve" text-anchor="start" x="199" y="-403.18" font-family="Monaco" font-size="11.00" fill="#0550ae">bool</text>
<text xml:space="preserve" text-anchor="start" x="226" y="-403.18" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-384.93" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-384.93" font-family="Monaco" font-size="11.00" fill="#cf222e">pub</text>
<text xml:space="preserve" text-anchor="start" x="84.25" y="-384.93" font-family="Monaco" font-size="11.00"> nullable: </text>
<text xml:space="preserve" text-anchor="start" x="158.5" y="-384.93" font-family="Monaco" font-size="11.00" fill="#0550ae">bool</text>
<text xml:space="preserve" text-anchor="start" x="185.5" y="-384.93" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-365.68" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-348.43" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-348.43" font-family="Monaco" font-size="11.00" fill="#cf222e">pub struct</text>
<text xml:space="preserve" text-anchor="start" x="104.5" y="-348.43" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="111.25" y="-348.43" font-family="Monaco" font-size="11.00" fill="#0550ae">Index</text>
<text xml:space="preserve" text-anchor="start" x="145" y="-348.43" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-330.18" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-330.18" font-family="Monaco" font-size="11.00" fill="#cf222e">pub</text>
<text xml:space="preserve" text-anchor="start" x="84.25" y="-330.18" font-family="Monaco" font-size="11.00"> name: </text>
<text xml:space="preserve" text-anchor="start" x="131.5" y="-330.18" font-family="Monaco" font-size="11.00" fill="#0550ae">Option&lt;&amp;&#39;static str&gt;</text>
<text xml:space="preserve" text-anchor="start" x="266.5" y="-330.18" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-311.93" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-311.93" font-family="Monaco" font-size="11.00" fill="#cf222e">pub</text>
<text xml:space="preserve" text-anchor="start" x="84.25" y="-311.93" font-family="Monaco" font-size="11.00"> unique: </text>
<text xml:space="preserve" text-anchor="start" x="145" y="-311.93" font-family="Monaco" font-size="11.00" fill="#0550ae">bool</text>
<text xml:space="preserve" text-anchor="start" x="172" y="-311.93" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-292.68" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-275.43" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-275.43" font-family="Monaco" font-size="11.00" fill="#cf222e">pub struct</text>
<text xml:space="preserve" text-anchor="start" x="104.5" y="-275.43" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="111.25" y="-275.43" font-family="Monaco" font-size="11.00" fill="#0550ae">ForeignKey</text>
<text xml:space="preserve" text-anchor="start" x="178.75" y="-275.43" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-257.18" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-257.18" font-family="Monaco" font-size="11.00" fill="#cf222e">pub</text>
<text xml:space="preserve" text-anchor="start" x="84.25" y="-257.18" font-family="Monaco" font-size="11.00"> table: </text>
<text xml:space="preserve" text-anchor="start" x="138.25" y="-257.18" font-family="Monaco" font-size="11.00" fill="#0550ae">&amp;&#39;static str</text>
<text xml:space="preserve" text-anchor="start" x="219.25" y="-257.18" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-238.93" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-238.93" font-family="Monaco" font-size="11.00" fill="#cf222e">pub</text>
<text xml:space="preserve" text-anchor="start" x="84.25" y="-238.93" font-family="Monaco" font-size="11.00"> column: </text>
<text xml:space="preserve" text-anchor="start" x="145" y="-238.93" font-family="Monaco" font-size="11.00" fill="#0550ae">&amp;&#39;static str</text>
<text xml:space="preserve" text-anchor="start" x="226" y="-238.93" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-220.68" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-220.68" font-family="Monaco" font-size="11.00" fill="#cf222e">pub</text>
<text xml:space="preserve" text-anchor="start" x="84.25" y="-220.68" font-family="Monaco" font-size="11.00"> on_delete: </text>
<text xml:space="preserve" text-anchor="start" x="165.25" y="-220.68" font-family="Monaco" font-size="11.00" fill="#0550ae">Option&lt;OnDelete&gt;</text>
<text xml:space="preserve" text-anchor="start" x="273.25" y="-220.68" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-201.43" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-184.18" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-184.18" font-family="Monaco" font-size="11.00" fill="#cf222e">pub enum</text>
<text xml:space="preserve" text-anchor="start" x="91" y="-184.18" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="97.75" y="-184.18" font-family="Monaco" font-size="11.00" fill="#0550ae">OnDelete</text>
<text xml:space="preserve" text-anchor="start" x="151.75" y="-184.18" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-164.93" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Cascade,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-146.68" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;SetNull,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-128.43" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;Restrict,</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-110.17" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-91.92" font-family="Monaco" font-size="11.00">}</text>
</g>
<g id="node2" class="node">
<title>make_parse</title>
<polygon fill="#e8e8f4" stroke="black" points="633,-455.12 430.75,-455.12 430.75,-392.38 633,-392.38 633,-455.12"/>
<polygon fill="#e8e8f4" stroke="none" points="438.75,-432.88 438.75,-451.12 625,-451.12 625,-432.88 438.75,-432.88"/>
<text xml:space="preserve" text-anchor="start" x="474.5" y="-439.68" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">facet&#45;macros&#45;impl</text>
<text xml:space="preserve" text-anchor="start" x="440.75" y="-421.43" font-family="Monaco" font-size="11.00">::facet::</text>
<text xml:space="preserve" text-anchor="start" x="501.5" y="-421.43" font-family="Monaco" font-size="11.00" fill="#8250df">__make_parse_attr!</text>
<text xml:space="preserve" text-anchor="start" x="471.12" y="-402.18" font-family="Monaco, Consolas, Courier" font-size="11.00">(grammar compiler)</text>
</g>
<g id="edge1" class="edge">
<title>grammar&#45;&gt;make_parse</title>
<path fill="none" stroke="#4169e1" stroke-width="2" d="M290.41,-423.75C332.37,-423.75 377.59,-423.75 417.37,-423.75"/>
<polygon fill="#4169e1" stroke="#4169e1" stroke-width="2" points="417.33,-427.25 427.33,-423.75 417.33,-420.25 417.33,-427.25"/>
<text xml:space="preserve" text-anchor="middle" x="360.38" y="-425.5" font-family="Helvetica,sans-Serif" font-size="10.00">compiles via</text>
</g>
<g id="node3" class="node">
<title>generated</title>
<polygon fill="#f0fff0" stroke="black" points="1288,-847.5 761.75,-847.5 761.75,0 1288,0 1288,-847.5"/>
<polygon fill="#d4edda" stroke="none" points="769.75,-825.25 769.75,-843.5 1280,-843.5 1280,-825.25 769.75,-825.25"/>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-832.05" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Generated in facet&#45;orm</text>
<polygon fill="#e8f5e9" stroke="none" points="769.75,-807 769.75,-825.25 1280,-825.25 1280,-807 769.75,-807"/>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-813.8" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">1. Runtime types (in submodule)</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-795.55" font-family="Monaco" font-size="11.00" fill="#cf222e">pub mod</text>
<text xml:space="preserve" text-anchor="start" x="819" y="-795.55" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="825.75" y="-795.55" font-family="Monaco" font-size="11.00" fill="#0550ae">attrs</text>
<text xml:space="preserve" text-anchor="start" x="859.5" y="-795.55" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-777.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="798.75" y="-777.3" font-family="Monaco" font-size="11.00" fill="#cf222e">pub enum</text>
<text xml:space="preserve" text-anchor="start" x="852.75" y="-777.3" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="859.5" y="-777.3" font-family="Monaco" font-size="11.00" fill="#0550ae">ContainerAttribute</text>
<text xml:space="preserve" text-anchor="start" x="981" y="-777.3" font-family="Monaco" font-size="11.00"> { Table(Table) }</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-759.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="798.75" y="-759.05" font-family="Monaco" font-size="11.00" fill="#cf222e">pub enum</text>
<text xml:space="preserve" text-anchor="start" x="852.75" y="-759.05" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="859.5" y="-759.05" font-family="Monaco" font-size="11.00" fill="#0550ae">FieldAttribute</text>
<text xml:space="preserve" text-anchor="start" x="954" y="-759.05" font-family="Monaco" font-size="11.00"> { Column(...), ... }</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-740.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="798.75" y="-740.8" font-family="Monaco" font-size="11.00" fill="#cf222e">pub struct</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-740.8" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="873" y="-740.8" font-family="Monaco" font-size="11.00" fill="#0550ae">Table</text>
<text xml:space="preserve" text-anchor="start" x="906.75" y="-740.8" font-family="Monaco" font-size="11.00"> { </text>
<text xml:space="preserve" text-anchor="start" x="927" y="-740.8" font-family="Monaco" font-size="11.00" fill="#cf222e">pub</text>
<text xml:space="preserve" text-anchor="start" x="947.25" y="-740.8" font-family="Monaco" font-size="11.00"> name: ... }</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-722.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="798.75" y="-722.55" font-family="Monaco" font-size="11.00" fill="#cf222e">pub struct</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-722.55" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="873" y="-722.55" font-family="Monaco" font-size="11.00" fill="#0550ae">Column</text>
<text xml:space="preserve" text-anchor="start" x="913.5" y="-722.55" font-family="Monaco" font-size="11.00"> { </text>
<text xml:space="preserve" text-anchor="start" x="933.75" y="-722.55" font-family="Monaco" font-size="11.00" fill="#cf222e">pub</text>
<text xml:space="preserve" text-anchor="start" x="954" y="-722.55" font-family="Monaco" font-size="11.00"> name, primary_key, ... }</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-704.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="798.75" y="-704.3" font-family="Monaco" font-size="11.00" fill="#cf222e">pub struct</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-704.3" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="873" y="-704.3" font-family="Monaco" font-size="11.00" fill="#0550ae">Index</text>
<text xml:space="preserve" text-anchor="start" x="906.75" y="-704.3" font-family="Monaco" font-size="11.00"> { </text>
<text xml:space="preserve" text-anchor="start" x="927" y="-704.3" font-family="Monaco" font-size="11.00" fill="#cf222e">pub</text>
<text xml:space="preserve" text-anchor="start" x="947.25" y="-704.3" font-family="Monaco" font-size="11.00"> name, unique }</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-686.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="798.75" y="-686.05" font-family="Monaco" font-size="11.00" fill="#cf222e">pub struct</text>
<text xml:space="preserve" text-anchor="start" x="866.25" y="-686.05" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="873" y="-686.05" font-family="Monaco" font-size="11.00" fill="#0550ae">ForeignKey</text>
<text xml:space="preserve" text-anchor="start" x="940.5" y="-686.05" font-family="Monaco" font-size="11.00"> { ... }</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-667.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="798.75" y="-667.8" font-family="Monaco" font-size="11.00" fill="#cf222e">pub enum</text>
<text xml:space="preserve" text-anchor="start" x="852.75" y="-667.8" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="859.5" y="-667.8" font-family="Monaco" font-size="11.00" fill="#0550ae">OnDelete</text>
<text xml:space="preserve" text-anchor="start" x="913.5" y="-667.8" font-family="Monaco" font-size="11.00"> { Cascade, SetNull, Restrict }</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-648.55" font-family="Monaco" font-size="11.00">}</text>
<polygon fill="#fff3cd" stroke="none" points="769.75,-624.5 769.75,-642.75 1280,-642.75 1280,-624.5 769.75,-624.5"/>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-631.3" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">2. TWO COMPILED GRAMMARS (with nested struct support)</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-613.05" font-family="Monaco" font-size="11.00" fill="#cf222e">macro_rules!</text>
<text xml:space="preserve" text-anchor="start" x="852.75" y="-613.05" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="859.5" y="-613.05" font-family="Monaco" font-size="11.00" fill="#8250df">__parse_container_attr</text>
<text xml:space="preserve" text-anchor="start" x="1008" y="-613.05" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-594.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;(</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-594.8" font-family="Monaco" font-size="11.00" fill="#953800">$name</text>
<text xml:space="preserve" text-anchor="start" x="839.25" y="-594.8" font-family="Monaco" font-size="11.00">:ident $(</text>
<text xml:space="preserve" text-anchor="start" x="900" y="-594.8" font-family="Monaco" font-size="11.00" fill="#953800">$rest</text>
<text xml:space="preserve" text-anchor="start" x="933.75" y="-594.8" font-family="Monaco" font-size="11.00">:tt)*) =&gt; {</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-576.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;::facet::</text>
<text xml:space="preserve" text-anchor="start" x="886.5" y="-576.55" font-family="Monaco" font-size="11.00" fill="#8250df">__dispatch_attr!</text>
<text xml:space="preserve" text-anchor="start" x="994.5" y="-576.55" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-558.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="852.75" y="-558.3" font-family="Monaco" font-size="11.00" fill="#8250df">@ns</text>
<text xml:space="preserve" text-anchor="start" x="873" y="-558.3" font-family="Monaco" font-size="11.00"> { </text>
<text xml:space="preserve" text-anchor="start" x="893.25" y="-558.3" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;orm&quot;</text>
<text xml:space="preserve" text-anchor="start" x="927" y="-558.3" font-family="Monaco" font-size="11.00"> }</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-540.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="852.75" y="-540.05" font-family="Monaco" font-size="11.00" fill="#8250df">@variants</text>
<text xml:space="preserve" text-anchor="start" x="913.5" y="-540.05" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-520.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;table: struct { name: option_str },</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-502.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-484.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;...</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-466.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-447.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;};</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-429.55" font-family="Monaco" font-size="11.00">}</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-412.3" font-family="Monaco" font-size="11.00" fill="#cf222e">macro_rules!</text>
<text xml:space="preserve" text-anchor="start" x="852.75" y="-412.3" font-family="Monaco" font-size="11.00"> </text>
<text xml:space="preserve" text-anchor="start" x="859.5" y="-412.3" font-family="Monaco" font-size="11.00" fill="#8250df">__parse_field_attr</text>
<text xml:space="preserve" text-anchor="start" x="981" y="-412.3" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-394.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;(</text>
<text xml:space="preserve" text-anchor="start" x="805.5" y="-394.05" font-family="Monaco" font-size="11.00" fill="#953800">$name</text>
<text xml:space="preserve" text-anchor="start" x="839.25" y="-394.05" font-family="Monaco" font-size="11.00">:ident $(</text>
<text xml:space="preserve" text-anchor="start" x="900" y="-394.05" font-family="Monaco" font-size="11.00" fill="#953800">$rest</text>
<text xml:space="preserve" text-anchor="start" x="933.75" y="-394.05" font-family="Monaco" font-size="11.00">:tt)*) =&gt; {</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-375.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;::facet::</text>
<text xml:space="preserve" text-anchor="start" x="886.5" y="-375.8" font-family="Monaco" font-size="11.00" fill="#8250df">__dispatch_attr!</text>
<text xml:space="preserve" text-anchor="start" x="994.5" y="-375.8" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-357.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="852.75" y="-357.55" font-family="Monaco" font-size="11.00" fill="#8250df">@ns</text>
<text xml:space="preserve" text-anchor="start" x="873" y="-357.55" font-family="Monaco" font-size="11.00"> { </text>
<text xml:space="preserve" text-anchor="start" x="893.25" y="-357.55" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;orm&quot;</text>
<text xml:space="preserve" text-anchor="start" x="927" y="-357.55" font-family="Monaco" font-size="11.00"> }</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-339.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="852.75" y="-339.3" font-family="Monaco" font-size="11.00" fill="#8250df">@variants</text>
<text xml:space="preserve" text-anchor="start" x="913.5" y="-339.3" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-320.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;column: struct {</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-301.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;name: option_str,</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-283.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;primary_key: flag,</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-265.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;auto_increment: flag,</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-247.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nullable: flag,</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-228.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;},</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-210.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;index: struct { name: option_str, unique: flag },</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-192.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;foreign_key: struct {</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-174.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;table: str, column: str,</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-155.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;on_delete: option_enum { cascade, set_null, restrict },</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-137.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;},</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-119.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-101.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;...</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-82.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-64.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;};</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-46.3" font-family="Monaco" font-size="11.00">}</text>
<polygon fill="#e8f5e9" stroke="none" points="769.75,-22.25 769.75,-40.5 1280,-40.5 1280,-22.25 769.75,-22.25"/>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-29.05" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">3. Re&#45;exports (macro hygiene)</text>
<text xml:space="preserve" text-anchor="start" x="771.75" y="-10.8" font-family="Monaco" font-size="11.00" fill="#cf222e">pub use</text>
<text xml:space="preserve" text-anchor="start" x="819" y="-10.8" font-family="Monaco" font-size="11.00"> ::facet::{</text>
<text xml:space="preserve" text-anchor="start" x="893.25" y="-10.8" font-family="Monaco" font-size="11.00" fill="#8250df">__dispatch_attr</text>
<text xml:space="preserve" text-anchor="start" x="994.5" y="-10.8" font-family="Monaco" font-size="11.00">, ...};</text>
</g>
<g id="edge2" class="edge">
<title>make_parse&#45;&gt;generated</title>
<path fill="none" stroke="#228b22" stroke-width="2" d="M633.42,-423.75C667.56,-423.75 707.51,-423.75 748.6,-423.75"/>
<polygon fill="#228b22" stroke="#228b22" stroke-width="2" points="748.36,-427.25 758.36,-423.75 748.36,-420.25 748.36,-427.25"/>
<text xml:space="preserve" text-anchor="middle" x="697.38" y="-425.5" font-family="Helvetica,sans-Serif" font-size="10.00">generates</text>
</g>
<g id="node4" class="node">
<title>usage</title>
<polygon fill="#f0f8ff" stroke="black" points="1792.25,-573.75 1407.75,-573.75 1407.75,-273.75 1792.25,-273.75 1792.25,-573.75"/>
<polygon fill="#e6f3ff" stroke="none" points="1415.75,-551.5 1415.75,-569.75 1784.25,-569.75 1784.25,-551.5 1415.75,-551.5"/>
<text xml:space="preserve" text-anchor="start" x="1417.75" y="-558.3" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Usage Example</text>
<text xml:space="preserve" text-anchor="start" x="1417.75" y="-540.05" font-family="Monaco" font-size="11.00">#[</text>
<text xml:space="preserve" text-anchor="start" x="1431.25" y="-540.05" font-family="Monaco" font-size="11.00" fill="#8250df">derive</text>
<text xml:space="preserve" text-anchor="start" x="1471.75" y="-540.05" font-family="Monaco" font-size="11.00">(Facet)]</text>
<text xml:space="preserve" text-anchor="start" x="1417.75" y="-521.8" font-family="Monaco" font-size="11.00">#[facet(</text>
<text xml:space="preserve" text-anchor="start" x="1471.75" y="-521.8" font-family="Monaco" font-size="11.00" fill="#0a3069">orm::table</text>
<text xml:space="preserve" text-anchor="start" x="1539.25" y="-521.8" font-family="Monaco" font-size="11.00">(name = </text>
<text xml:space="preserve" text-anchor="start" x="1593.25" y="-521.8" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;users&quot;</text>
<text xml:space="preserve" text-anchor="start" x="1640.5" y="-521.8" font-family="Monaco" font-size="11.00">))]</text>
<text xml:space="preserve" text-anchor="start" x="1417.75" y="-503.55" font-family="Monaco" font-size="11.00" fill="#cf222e">struct</text>
<text xml:space="preserve" text-anchor="start" x="1458.25" y="-503.55" font-family="Monaco" font-size="11.00"> User {</text>
<text xml:space="preserve" text-anchor="start" x="1417.75" y="-485.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;#[facet(</text>
<text xml:space="preserve" text-anchor="start" x="1498.75" y="-485.3" font-family="Monaco" font-size="11.00" fill="#0a3069">orm::column</text>
<text xml:space="preserve" text-anchor="start" x="1573" y="-485.3" font-family="Monaco" font-size="11.00">(primary_key, auto_increment))]</text>
<text xml:space="preserve" text-anchor="start" x="1417.75" y="-466.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;id: i64,</text>
<text xml:space="preserve" text-anchor="start" x="1417.75" y="-448.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;#[facet(</text>
<text xml:space="preserve" text-anchor="start" x="1498.75" y="-448.8" font-family="Monaco" font-size="11.00" fill="#0a3069">orm::column</text>
<text xml:space="preserve" text-anchor="start" x="1573" y="-448.8" font-family="Monaco" font-size="11.00">(name = </text>
<text xml:space="preserve" text-anchor="start" x="1627" y="-448.8" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;user_name&quot;</text>
<text xml:space="preserve" text-anchor="start" x="1701.25" y="-448.8" font-family="Monaco" font-size="11.00">))]</text>
<text xml:space="preserve" text-anchor="start" x="1417.75" y="-430.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;#[facet(</text>
<text xml:space="preserve" text-anchor="start" x="1498.75" y="-430.55" font-family="Monaco" font-size="11.00" fill="#0a3069">orm::index</text>
<text xml:space="preserve" text-anchor="start" x="1566.25" y="-430.55" font-family="Monaco" font-size="11.00">(unique))]</text>
<text xml:space="preserve" text-anchor="start" x="1417.75" y="-411.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;username: String,</text>
<text xml:space="preserve" text-anchor="start" x="1417.75" y="-394.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;#[facet(</text>
<text xml:space="preserve" text-anchor="start" x="1498.75" y="-394.05" font-family="Monaco" font-size="11.00" fill="#0a3069">orm::foreign_key</text>
<text xml:space="preserve" text-anchor="start" x="1606.75" y="-394.05" font-family="Monaco" font-size="11.00">(</text>
<text xml:space="preserve" text-anchor="start" x="1417.75" y="-375.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;table = </text>
<text xml:space="preserve" text-anchor="start" x="1525.75" y="-375.8" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;roles&quot;</text>
<text xml:space="preserve" text-anchor="start" x="1573" y="-375.8" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="1417.75" y="-357.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;column = </text>
<text xml:space="preserve" text-anchor="start" x="1532.5" y="-357.55" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;id&quot;</text>
<text xml:space="preserve" text-anchor="start" x="1559.5" y="-357.55" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="1417.75" y="-338.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;on_delete = cascade</text>
<text xml:space="preserve" text-anchor="start" x="1417.75" y="-320.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;))]</text>
<text xml:space="preserve" text-anchor="start" x="1417.75" y="-301.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;role_id: i64,</text>
<text xml:space="preserve" text-anchor="start" x="1417.75" y="-283.55" font-family="Monaco" font-size="11.00">}</text>
</g>
<g id="edge3" class="edge">
<title>generated&#45;&gt;usage</title>
<path fill="none" stroke="#666666" stroke-width="1.5" stroke-dasharray="5,2" d="M1288.12,-423.75C1324.11,-423.75 1360.61,-423.75 1395.34,-423.75"/>
<polygon fill="#666666" stroke="#666666" stroke-width="1.5" points="1395.28,-427.25 1405.28,-423.75 1395.27,-420.25 1395.28,-427.25"/>
<text xml:space="preserve" text-anchor="middle" x="1347.88" y="-425.5" font-family="Helvetica,sans-Serif" font-size="10.00">enables</text>
</g>
</g>
</svg>
      <p class="diagram-caption">Complex attributes with nested structs, enums, and multiple fields</p>
    </div>

    <h3>2. Attribute Usage Flow (Detailed)</h3>
    <p>What happens when user writes <code>#[facet(orm::column(...))]</code>:</p>
    <div class="diagram">
      <svg width="340pt" height="1369pt"
 viewBox="0.00 0.00 340.00 1369.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1365)">
<title>attribute_usage</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-1365 336,-1365 336,4 -4,4"/>
<text xml:space="preserve" text-anchor="middle" x="166" y="-1338" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="20.00">Attribute Usage Flow (Detailed)</text>
<g id="node1" class="node">
<title>user_code</title>
<polygon fill="#fff8f0" stroke="black" points="290,-1332 42,-1332 42,-1219 290,-1219 290,-1332"/>
<polygon fill="#fff8f0" stroke="none" points="50,-1310.5 50,-1328 282,-1328 282,-1310.5 50,-1310.5"/>
<text xml:space="preserve" text-anchor="start" x="52" y="-1317.5" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="10.00">1. User code</text>
<text xml:space="preserve" text-anchor="start" x="52" y="-1300" font-family="Monaco" font-size="10.00">#[</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-1300" font-family="Monaco" font-size="10.00" fill="#8250df">derive</text>
<text xml:space="preserve" text-anchor="start" x="100" y="-1300" font-family="Monaco" font-size="10.00">(::</text>
<text xml:space="preserve" text-anchor="start" x="118" y="-1300" font-family="Monaco" font-size="10.00" fill="#0550ae">facet</text>
<text xml:space="preserve" text-anchor="start" x="148" y="-1300" font-family="Monaco" font-size="10.00">::</text>
<text xml:space="preserve" text-anchor="start" x="160" y="-1300" font-family="Monaco" font-size="10.00" fill="#0550ae">Facet</text>
<text xml:space="preserve" text-anchor="start" x="190" y="-1300" font-family="Monaco" font-size="10.00">)]</text>
<text xml:space="preserve" text-anchor="start" x="52" y="-1282.5" font-family="Monaco" font-size="10.00" fill="#cf222e">struct</text>
<text xml:space="preserve" text-anchor="start" x="88" y="-1282.5" font-family="Monaco" font-size="10.00"> </text>
<text xml:space="preserve" text-anchor="start" x="94" y="-1282.5" font-family="Monaco" font-size="10.00" fill="#0550ae">User</text>
<text xml:space="preserve" text-anchor="start" x="118" y="-1282.5" font-family="Monaco" font-size="10.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="52" y="-1265" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;#[</text>
<text xml:space="preserve" text-anchor="start" x="88" y="-1265" font-family="Monaco" font-size="10.00" fill="#8250df">facet</text>
<text xml:space="preserve" text-anchor="start" x="118" y="-1265" font-family="Monaco" font-size="10.00">(orm::column(primary_key))]</text>
<text xml:space="preserve" text-anchor="start" x="52" y="-1247.5" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;id: </text>
<text xml:space="preserve" text-anchor="start" x="100" y="-1247.5" font-family="Monaco" font-size="10.00" fill="#0550ae">i64</text>
<text xml:space="preserve" text-anchor="start" x="118" y="-1247.5" font-family="Monaco" font-size="10.00">,</text>
<text xml:space="preserve" text-anchor="start" x="52" y="-1229" font-family="Monaco" font-size="10.00">}</text>
</g>
<g id="node2" class="node">
<title>derive_parse</title>
<polygon fill="#e8e8f4" stroke="black" points="332,-1163.5 0,-1163.5 0,-1085.5 332,-1085.5 332,-1163.5"/>
<polygon fill="#e8e8f4" stroke="none" points="8,-1142 8,-1159.5 324,-1159.5 324,-1142 8,-1142"/>
<text xml:space="preserve" text-anchor="start" x="10" y="-1149" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="10.00">2. facet&#45;macros parses attribute</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-1130.5" font-family="Monaco" font-size="10.00" fill="#6e7781">// Extracts from #[facet(orm::column(primary_key))]:</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-1114" font-family="Monaco" font-size="10.00">namespace = </text>
<text xml:space="preserve" text-anchor="start" x="82" y="-1114" font-family="Monaco" font-size="10.00" fill="#0a3069">&quot;orm&quot;</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-1096.5" font-family="Monaco" font-size="10.00">rest = </text>
<text xml:space="preserve" text-anchor="start" x="52" y="-1096.5" font-family="Monaco" font-size="10.00" fill="#0a3069">column(primary_key)</text>
</g>
<g id="edge1" class="edge">
<title>user_code&#45;&gt;derive_parse</title>
<path fill="none" stroke="#666666" d="M166,-1218.59C166,-1204.27 166,-1188.97 166,-1175"/>
<polygon fill="#666666" stroke="#666666" points="169.5,-1175.14 166,-1165.14 162.5,-1175.14 169.5,-1175.14"/>
<text xml:space="preserve" text-anchor="middle" x="189.25" y="-1192.45" font-family="Helvetica,sans-Serif" font-size="9.00">proc&#45;macro</text>
<text xml:space="preserve" text-anchor="middle" x="189.25" y="-1182.7" font-family="Helvetica,sans-Serif" font-size="9.00">parses</text>
</g>
<g id="node3" class="node">
<title>gen_call</title>
<polygon fill="#fff9e6" stroke="black" points="284,-1039.75 48,-1039.75 48,-944.25 284,-944.25 284,-1039.75"/>
<polygon fill="#fff3cd" stroke="none" points="56,-1018.25 56,-1035.75 276,-1035.75 276,-1018.25 56,-1018.25"/>
<text xml:space="preserve" text-anchor="start" x="58" y="-1025.25" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="10.00">3. Generates call to namespace macro</text>
<text xml:space="preserve" text-anchor="start" x="58" y="-1007.75" font-family="Monaco" font-size="10.00">::orm::</text>
<text xml:space="preserve" text-anchor="start" x="100" y="-1007.75" font-family="Monaco" font-size="10.00" fill="#8250df">__parse_attr!</text>
<text xml:space="preserve" text-anchor="start" x="178" y="-1007.75" font-family="Monaco" font-size="10.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="58" y="-990.25" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="82" y="-990.25" font-family="Monaco" font-size="10.00" fill="#8250df">@input</text>
<text xml:space="preserve" text-anchor="start" x="118" y="-990.25" font-family="Monaco" font-size="10.00"> { column(primary_key) }</text>
<text xml:space="preserve" text-anchor="start" x="58" y="-972.75" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="82" y="-972.75" font-family="Monaco" font-size="10.00" fill="#8250df">@ns</text>
<text xml:space="preserve" text-anchor="start" x="100" y="-972.75" font-family="Monaco" font-size="10.00"> { </text>
<text xml:space="preserve" text-anchor="start" x="118" y="-972.75" font-family="Monaco" font-size="10.00" fill="#0a3069">&quot;orm&quot;</text>
<text xml:space="preserve" text-anchor="start" x="148" y="-972.75" font-family="Monaco" font-size="10.00"> }</text>
<text xml:space="preserve" text-anchor="start" x="58" y="-954.25" font-family="Monaco" font-size="10.00">}</text>
</g>
<g id="edge2" class="edge">
<title>derive_parse&#45;&gt;gen_call</title>
<path fill="none" stroke="#228b22" stroke-width="2" d="M166,-1085.05C166,-1074.89 166,-1063.68 166,-1052.69"/>
<polygon fill="#228b22" stroke="#228b22" stroke-width="2" points="169.5,-1052.98 166,-1042.98 162.5,-1052.98 169.5,-1052.98"/>
<text xml:space="preserve" text-anchor="middle" x="176.88" y="-1058.95" font-family="Helvetica,sans-Serif" font-size="9.00">emits</text>
</g>
<g id="node4" class="node">
<title>parse_attr_def</title>
<polygon fill="#f4e8e8" stroke="black" points="317,-888.75 15,-888.75 15,-618.25 317,-618.25 317,-888.75"/>
<polygon fill="#f4e8e8" stroke="none" points="23,-867.25 23,-884.75 309,-884.75 309,-867.25 23,-867.25"/>
<text xml:space="preserve" text-anchor="start" x="25" y="-874.25" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="10.00">4. orm::__parse_attr! (from define_attributes!)</text>
<text xml:space="preserve" text-anchor="start" x="25" y="-855.75" font-family="Monaco" font-size="10.00" fill="#6e7781">// Generated macro contains variant list:</text>
<text xml:space="preserve" text-anchor="start" x="25" y="-839.25" font-family="Monaco" font-size="10.00" fill="#8250df">macro_rules!</text>
<text xml:space="preserve" text-anchor="start" x="97" y="-839.25" font-family="Monaco" font-size="10.00"> __parse_attr {</text>
<text xml:space="preserve" text-anchor="start" x="25" y="-821.75" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;($(</text>
<text xml:space="preserve" text-anchor="start" x="67" y="-821.75" font-family="Monaco" font-size="10.00" fill="#cf222e">$</text>
<text xml:space="preserve" text-anchor="start" x="73" y="-821.75" font-family="Monaco" font-size="10.00">input:tt)*) =&gt; {</text>
<text xml:space="preserve" text-anchor="start" x="25" y="-804.25" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;::</text>
<text xml:space="preserve" text-anchor="start" x="85" y="-804.25" font-family="Monaco" font-size="10.00" fill="#0550ae">facet</text>
<text xml:space="preserve" text-anchor="start" x="115" y="-804.25" font-family="Monaco" font-size="10.00">::</text>
<text xml:space="preserve" text-anchor="start" x="127" y="-804.25" font-family="Monaco" font-size="10.00" fill="#8250df">__dispatch_attr!</text>
<text xml:space="preserve" text-anchor="start" x="223" y="-804.25" font-family="Monaco" font-size="10.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="25" y="-786.75" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="97" y="-786.75" font-family="Monaco" font-size="10.00" fill="#8250df">@variants</text>
<text xml:space="preserve" text-anchor="start" x="151" y="-786.75" font-family="Monaco" font-size="10.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="25" y="-769.25" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;skip =&gt; </text>
<text xml:space="preserve" text-anchor="start" x="169" y="-769.25" font-family="Monaco" font-size="10.00" fill="#0550ae">unit</text>
<text xml:space="preserve" text-anchor="start" x="193" y="-769.25" font-family="Monaco" font-size="10.00">,</text>
<text xml:space="preserve" text-anchor="start" x="25" y="-751.75" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;rename =&gt; </text>
<text xml:space="preserve" text-anchor="start" x="181" y="-751.75" font-family="Monaco" font-size="10.00" fill="#0550ae">newtype</text>
<text xml:space="preserve" text-anchor="start" x="223" y="-751.75" font-family="Monaco" font-size="10.00">(</text>
<text xml:space="preserve" text-anchor="start" x="229" y="-751.75" font-family="Monaco" font-size="10.00" fill="#0550ae">String</text>
<text xml:space="preserve" text-anchor="start" x="265" y="-751.75" font-family="Monaco" font-size="10.00">),</text>
<text xml:space="preserve" text-anchor="start" x="25" y="-734.25" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;column =&gt; </text>
<text xml:space="preserve" text-anchor="start" x="181" y="-734.25" font-family="Monaco" font-size="10.00" fill="#0550ae">struct</text>
<text xml:space="preserve" text-anchor="start" x="217" y="-734.25" font-family="Monaco" font-size="10.00"> { ... },</text>
<text xml:space="preserve" text-anchor="start" x="25" y="-715.75" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="25" y="-699.25" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="97" y="-699.25" font-family="Monaco" font-size="10.00" fill="#8250df">@input</text>
<text xml:space="preserve" text-anchor="start" x="133" y="-699.25" font-family="Monaco" font-size="10.00"> { $($input)* }</text>
<text xml:space="preserve" text-anchor="start" x="25" y="-680.75" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;...</text>
<text xml:space="preserve" text-anchor="start" x="25" y="-663.25" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="25" y="-645.75" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="25" y="-628.25" font-family="Monaco" font-size="10.00">}</text>
</g>
<g id="edge3" class="edge">
<title>gen_call&#45;&gt;parse_attr_def</title>
<path fill="none" stroke="#666666" d="M166,-943.99C166,-930.98 166,-916.14 166,-900.62"/>
<polygon fill="#666666" stroke="#666666" points="169.5,-900.73 166,-890.73 162.5,-900.73 169.5,-900.73"/>
<text xml:space="preserve" text-anchor="middle" x="187.38" y="-917.7" font-family="Helvetica,sans-Serif" font-size="9.00">macro</text>
<text xml:space="preserve" text-anchor="middle" x="187.38" y="-907.95" font-family="Helvetica,sans-Serif" font-size="9.00">expansion</text>
</g>
<g id="node5" class="node">
<title>dispatch_match</title>
<polygon fill="#e8e8f4" stroke="black" points="311,-562.75 21,-562.75 21,-414.75 311,-414.75 311,-562.75"/>
<polygon fill="#e8e8f4" stroke="none" points="29,-541.25 29,-558.75 303,-558.75 303,-541.25 29,-541.25"/>
<text xml:space="preserve" text-anchor="start" x="31" y="-548.25" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="10.00">5. __dispatch_attr! matches &quot;column&quot;</text>
<text xml:space="preserve" text-anchor="start" x="31" y="-529.75" font-family="Monaco" font-size="10.00" fill="#6e7781">// Input: column(primary_key)</text>
<text xml:space="preserve" text-anchor="start" x="31" y="-512.25" font-family="Monaco" font-size="10.00" fill="#6e7781">// Scans @variants, finds:</text>
<text xml:space="preserve" text-anchor="start" x="31" y="-495.75" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;column =&gt; </text>
<text xml:space="preserve" text-anchor="start" x="115" y="-495.75" font-family="Monaco" font-size="10.00" fill="#0550ae">struct</text>
<text xml:space="preserve" text-anchor="start" x="151" y="-495.75" font-family="Monaco" font-size="10.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="31" y="-478.25" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;primary_key: </text>
<text xml:space="preserve" text-anchor="start" x="157" y="-478.25" font-family="Monaco" font-size="10.00" fill="#0550ae">bool</text>
<text xml:space="preserve" text-anchor="start" x="181" y="-478.25" font-family="Monaco" font-size="10.00">,</text>
<text xml:space="preserve" text-anchor="start" x="31" y="-460.75" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;name: </text>
<text xml:space="preserve" text-anchor="start" x="115" y="-460.75" font-family="Monaco" font-size="10.00" fill="#0550ae">Option</text>
<text xml:space="preserve" text-anchor="start" x="151" y="-460.75" font-family="Monaco" font-size="10.00">&lt;</text>
<text xml:space="preserve" text-anchor="start" x="157" y="-460.75" font-family="Monaco" font-size="10.00" fill="#0550ae">String</text>
<text xml:space="preserve" text-anchor="start" x="193" y="-460.75" font-family="Monaco" font-size="10.00">&gt;,</text>
<text xml:space="preserve" text-anchor="start" x="31" y="-442.25" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="31" y="-424.75" font-family="Monaco" font-size="10.00" fill="#6e7781">// Variant type = struct, forwards to builder</text>
</g>
<g id="edge4" class="edge">
<title>parse_attr_def&#45;&gt;dispatch_match</title>
<path fill="none" stroke="#666666" d="M166,-618.05C166,-603.25 166,-588.51 166,-574.57"/>
<polygon fill="#666666" stroke="#666666" points="169.5,-574.57 166,-564.57 162.5,-574.57 169.5,-574.57"/>
<text xml:space="preserve" text-anchor="middle" x="191.5" y="-591.7" font-family="Helvetica,sans-Serif" font-size="9.00">forwards</text>
<text xml:space="preserve" text-anchor="middle" x="191.5" y="-581.95" font-family="Helvetica,sans-Serif" font-size="9.00">with variants</text>
</g>
<g id="node6" class="node">
<title>build_struct</title>
<polygon fill="#e8f0e8" stroke="black" points="293,-359.25 39,-359.25 39,-228.75 293,-228.75 293,-359.25"/>
<polygon fill="#e8f0e8" stroke="none" points="47,-337.75 47,-355.25 285,-355.25 285,-337.75 47,-337.75"/>
<text xml:space="preserve" text-anchor="start" x="49" y="-344.75" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="10.00">6. __build_struct_fields! parses tokens</text>
<text xml:space="preserve" text-anchor="start" x="49" y="-326.25" font-family="Monaco" font-size="10.00" fill="#6e7781">// Input tokens: (primary_key)</text>
<text xml:space="preserve" text-anchor="start" x="49" y="-308.75" font-family="Monaco" font-size="10.00" fill="#6e7781">// For each field in struct def:</text>
<text xml:space="preserve" text-anchor="start" x="49" y="-292.25" font-family="Monaco" font-size="10.00" fill="#cf222e">let</text>
<text xml:space="preserve" text-anchor="start" x="67" y="-292.25" font-family="Monaco" font-size="10.00"> primary_key = </text>
<text xml:space="preserve" text-anchor="start" x="157" y="-292.25" font-family="Monaco" font-size="10.00" fill="#0550ae">false</text>
<text xml:space="preserve" text-anchor="start" x="187" y="-292.25" font-family="Monaco" font-size="10.00">; </text>
<text xml:space="preserve" text-anchor="start" x="199" y="-292.25" font-family="Monaco" font-size="10.00" fill="#6e7781">// default</text>
<text xml:space="preserve" text-anchor="start" x="49" y="-274.75" font-family="Monaco" font-size="10.00" fill="#cf222e">let</text>
<text xml:space="preserve" text-anchor="start" x="67" y="-274.75" font-family="Monaco" font-size="10.00"> name = </text>
<text xml:space="preserve" text-anchor="start" x="115" y="-274.75" font-family="Monaco" font-size="10.00" fill="#0550ae">None</text>
<text xml:space="preserve" text-anchor="start" x="139" y="-274.75" font-family="Monaco" font-size="10.00">; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="199" y="-274.75" font-family="Monaco" font-size="10.00" fill="#6e7781">// default</text>
<text xml:space="preserve" text-anchor="start" x="49" y="-256.25" font-family="Monaco" font-size="10.00" fill="#6e7781">// Parse &quot;primary_key&quot; token:</text>
<text xml:space="preserve" text-anchor="start" x="49" y="-239.75" font-family="Monaco" font-size="10.00">primary_key = </text>
<text xml:space="preserve" text-anchor="start" x="133" y="-239.75" font-family="Monaco" font-size="10.00" fill="#0550ae">true</text>
<text xml:space="preserve" text-anchor="start" x="157" y="-239.75" font-family="Monaco" font-size="10.00">; &#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="199" y="-239.75" font-family="Monaco" font-size="10.00" fill="#6e7781">// matched!</text>
</g>
<g id="edge5" class="edge">
<title>dispatch_match&#45;&gt;build_struct</title>
<path fill="none" stroke="#228b22" stroke-width="2" d="M166,-414.33C166,-400.7 166,-386.43 166,-372.68"/>
<polygon fill="#228b22" stroke="#228b22" stroke-width="2" points="169.5,-372.73 166,-362.73 162.5,-372.73 169.5,-372.73"/>
<text xml:space="preserve" text-anchor="middle" x="191.88" y="-388.2" font-family="Helvetica,sans-Serif" font-size="9.00">struct variant</text>
<text xml:space="preserve" text-anchor="middle" x="191.88" y="-378.45" font-family="Helvetica,sans-Serif" font-size="9.00">matched</text>
</g>
<g id="node7" class="node">
<title>final_value</title>
<polygon fill="#e8f5e9" stroke="black" points="278,-183 54,-183 54,0 278,0 278,-183"/>
<polygon fill="#d4edda" stroke="none" points="62,-161.5 62,-179 270,-179 270,-161.5 62,-161.5"/>
<text xml:space="preserve" text-anchor="start" x="64" y="-168.5" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="10.00">7. Final Attribute value</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-151" font-family="Monaco" font-size="10.00">::facet_core::</text>
<text xml:space="preserve" text-anchor="start" x="148" y="-151" font-family="Monaco" font-size="10.00" fill="#0550ae">Attribute</text>
<text xml:space="preserve" text-anchor="start" x="202" y="-151" font-family="Monaco" font-size="10.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-133.5" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;ns: </text>
<text xml:space="preserve" text-anchor="start" x="112" y="-133.5" font-family="Monaco" font-size="10.00" fill="#0550ae">Some</text>
<text xml:space="preserve" text-anchor="start" x="136" y="-133.5" font-family="Monaco" font-size="10.00">(</text>
<text xml:space="preserve" text-anchor="start" x="142" y="-133.5" font-family="Monaco" font-size="10.00" fill="#0a3069">&quot;orm&quot;</text>
<text xml:space="preserve" text-anchor="start" x="172" y="-133.5" font-family="Monaco" font-size="10.00">),</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-116" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;key: </text>
<text xml:space="preserve" text-anchor="start" x="118" y="-116" font-family="Monaco" font-size="10.00" fill="#0a3069">&quot;column&quot;</text>
<text xml:space="preserve" text-anchor="start" x="166" y="-116" font-family="Monaco" font-size="10.00">,</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-98.5" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;data: </text>
<text xml:space="preserve" text-anchor="start" x="124" y="-98.5" font-family="Monaco" font-size="10.00" fill="#cf222e">&amp;</text>
<text xml:space="preserve" text-anchor="start" x="130" y="-98.5" font-family="Monaco" font-size="10.00">::orm::</text>
<text xml:space="preserve" text-anchor="start" x="172" y="-98.5" font-family="Monaco" font-size="10.00" fill="#0550ae">Column</text>
<text xml:space="preserve" text-anchor="start" x="208" y="-98.5" font-family="Monaco" font-size="10.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-81" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;primary_key: </text>
<text xml:space="preserve" text-anchor="start" x="190" y="-81" font-family="Monaco" font-size="10.00" fill="#0550ae">true</text>
<text xml:space="preserve" text-anchor="start" x="214" y="-81" font-family="Monaco" font-size="10.00">,</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-63.5" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;name: </text>
<text xml:space="preserve" text-anchor="start" x="148" y="-63.5" font-family="Monaco" font-size="10.00" fill="#0550ae">None</text>
<text xml:space="preserve" text-anchor="start" x="172" y="-63.5" font-family="Monaco" font-size="10.00">,</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-45" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;},</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-28.5" font-family="Monaco" font-size="10.00"> &#160;&#160;&#160;shape: &lt;::orm::</text>
<text xml:space="preserve" text-anchor="start" x="178" y="-28.5" font-family="Monaco" font-size="10.00" fill="#0550ae">Column</text>
<text xml:space="preserve" text-anchor="start" x="214" y="-28.5" font-family="Monaco" font-size="10.00">&gt;::SHAPE,</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-10" font-family="Monaco" font-size="10.00">}</text>
</g>
<g id="edge6" class="edge">
<title>build_struct&#45;&gt;final_value</title>
<path fill="none" stroke="#228b22" stroke-width="2" d="M166,-228.46C166,-218.09 166,-207.14 166,-196.13"/>
<polygon fill="#228b22" stroke="#228b22" stroke-width="2" points="169.5,-196.24 166,-186.24 162.5,-196.24 169.5,-196.24"/>
<text xml:space="preserve" text-anchor="middle" x="186.62" y="-202.2" font-family="Helvetica,sans-Serif" font-size="9.00">constructs</text>
</g>
</g>
</svg>
      <p class="diagram-caption">Derive macro delegates to namespace's parser, which produces Attribute</p>
    </div>

    <h3>2b. __dispatch_attr! Expansion Detail</h3>
    <p>How <code>::facet::__dispatch_attr!</code> routes to the correct handler:</p>
    <div class="diagram">
      <svg width="525pt" height="1055pt"
 viewBox="0.00 0.00 525.00 1055.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1050.75)">
<title>dispatch_detail</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-1050.75 521.12,-1050.75 521.12,4 -4,4"/>
<text xml:space="preserve" text-anchor="middle" x="258.56" y="-1023.75" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="20.00">__dispatch_attr! Expansion Detail</text>
<g id="node1" class="node">
<title>input</title>
<polygon fill="#fff9e6" stroke="black" points="483.5,-1017.75 38.25,-1017.75 38.25,-790.75 483.5,-790.75 483.5,-1017.75"/>
<polygon fill="#fff3cd" stroke="none" points="46.25,-995.5 46.25,-1013.75 475.5,-1013.75 475.5,-995.5 46.25,-995.5"/>
<text xml:space="preserve" text-anchor="start" x="48.25" y="-1002.3" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Input from __parse_attr!</text>
<text xml:space="preserve" text-anchor="start" x="48.25" y="-984.05" font-family="Monaco" font-size="11.00">::facet::</text>
<text xml:space="preserve" text-anchor="start" x="109" y="-984.05" font-family="Monaco" font-size="11.00" fill="#8250df">__dispatch_attr!</text>
<text xml:space="preserve" text-anchor="start" x="217" y="-984.05" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="48.25" y="-965.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="75.25" y="-965.8" font-family="Monaco" font-size="11.00" fill="#8250df">@namespace</text>
<text xml:space="preserve" text-anchor="start" x="142.75" y="-965.8" font-family="Monaco" font-size="11.00"> { </text>
<text xml:space="preserve" text-anchor="start" x="163" y="-965.8" font-family="Monaco" font-size="11.00" fill="#953800">$crate</text>
<text xml:space="preserve" text-anchor="start" x="203.5" y="-965.8" font-family="Monaco" font-size="11.00"> } &#160;</text>
<text xml:space="preserve" text-anchor="start" x="230.5" y="-965.8" font-family="Monaco" font-size="11.00" fill="#6e7781">// = ::orm</text>
<text xml:space="preserve" text-anchor="start" x="48.25" y="-947.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="75.25" y="-947.55" font-family="Monaco" font-size="11.00" fill="#8250df">@enum_name</text>
<text xml:space="preserve" text-anchor="start" x="142.75" y="-947.55" font-family="Monaco" font-size="11.00"> { </text>
<text xml:space="preserve" text-anchor="start" x="163" y="-947.55" font-family="Monaco" font-size="11.00" fill="#0550ae">Attr</text>
<text xml:space="preserve" text-anchor="start" x="190" y="-947.55" font-family="Monaco" font-size="11.00"> }</text>
<text xml:space="preserve" text-anchor="start" x="48.25" y="-929.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="75.25" y="-929.3" font-family="Monaco" font-size="11.00" fill="#8250df">@variants</text>
<text xml:space="preserve" text-anchor="start" x="136" y="-929.3" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="48.25" y="-910.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;skip: unit,</text>
<text xml:space="preserve" text-anchor="start" x="48.25" y="-892.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;rename: newtype </text>
<text xml:space="preserve" text-anchor="start" x="210.25" y="-892.8" font-family="Monaco" font-size="11.00" fill="#0550ae">&amp;&#39;static str</text>
<text xml:space="preserve" text-anchor="start" x="291.25" y="-892.8" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="48.25" y="-874.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;column: rec </text>
<text xml:space="preserve" text-anchor="start" x="183.25" y="-874.55" font-family="Monaco" font-size="11.00" fill="#0550ae">Column</text>
<text xml:space="preserve" text-anchor="start" x="223.75" y="-874.55" font-family="Monaco" font-size="11.00"> { primary_key: </text>
<text xml:space="preserve" text-anchor="start" x="331.75" y="-874.55" font-family="Monaco" font-size="11.00" fill="#0550ae">bool</text>
<text xml:space="preserve" text-anchor="start" x="358.75" y="-874.55" font-family="Monaco" font-size="11.00">, name: opt_str }</text>
<text xml:space="preserve" text-anchor="start" x="48.25" y="-855.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="48.25" y="-838.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="75.25" y="-838.05" font-family="Monaco" font-size="11.00" fill="#8250df">@name</text>
<text xml:space="preserve" text-anchor="start" x="109" y="-838.05" font-family="Monaco" font-size="11.00"> { column } &#160;</text>
<text xml:space="preserve" text-anchor="start" x="196.75" y="-838.05" font-family="Monaco" font-size="11.00" fill="#6e7781">// from user&#39;s attr</text>
<text xml:space="preserve" text-anchor="start" x="48.25" y="-819.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="75.25" y="-819.8" font-family="Monaco" font-size="11.00" fill="#8250df">@rest</text>
<text xml:space="preserve" text-anchor="start" x="109" y="-819.8" font-family="Monaco" font-size="11.00"> { (primary_key) } &#160;</text>
<text xml:space="preserve" text-anchor="start" x="244" y="-819.8" font-family="Monaco" font-size="11.00" fill="#6e7781">// remaining tokens</text>
<text xml:space="preserve" text-anchor="start" x="48.25" y="-800.55" font-family="Monaco" font-size="11.00">}</text>
</g>
<g id="node2" class="node">
<title>lookup</title>
<polygon fill="#e8e8f4" stroke="black" points="260.88,-753.75 4.63,-709.25 260.87,-664.75 517.12,-709.25 260.88,-753.75"/>
<text xml:space="preserve" text-anchor="start" x="213.62" y="-716.05" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Variant Lookup</text>
<text xml:space="preserve" text-anchor="start" x="142.75" y="-697.8" font-family="Monaco, Consolas, Courier" font-size="11.00">Match </text>
<text xml:space="preserve" text-anchor="start" x="183.25" y="-697.8" font-family="Monaco" font-size="11.00">column</text>
<text xml:space="preserve" text-anchor="start" x="223.75" y="-697.8" font-family="Monaco, Consolas, Courier" font-size="11.00"> against known variants</text>
</g>
<g id="edge1" class="edge">
<title>input&#45;&gt;lookup</title>
<path fill="none" stroke="black" d="M260.88,-790.42C260.88,-781.78 260.88,-773.31 260.88,-765.31"/>
<polygon fill="black" stroke="black" points="264.38,-765.48 260.88,-755.48 257.38,-765.48 264.38,-765.48"/>
</g>
<g id="node3" class="node">
<title>found_struct</title>
<polygon fill="#e8f5e9" stroke="black" points="256.25,-617.5 13.5,-617.5 13.5,-573 256.25,-573 256.25,-617.5"/>
<polygon fill="#d4edda" stroke="none" points="21.5,-595.25 21.5,-613.5 248.25,-613.5 248.25,-595.25 21.5,-595.25"/>
<text xml:space="preserve" text-anchor="start" x="23.5" y="-602.05" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Found: struct variant (column) ✓</text>
<text xml:space="preserve" text-anchor="start" x="23.5" y="-583.8" font-family="Monaco, Consolas, Courier" font-size="11.00">Forward to </text>
<text xml:space="preserve" text-anchor="start" x="97.75" y="-583.8" font-family="Monaco" font-size="11.00" fill="#8250df">__build_struct_fields!</text>
</g>
<g id="edge2" class="edge">
<title>lookup&#45;&gt;found_struct</title>
<path fill="none" stroke="#228b22" stroke-width="2" d="M219.62,-671.58C203.09,-656.89 184.3,-640.18 168.61,-626.24"/>
<polygon fill="#228b22" stroke="#228b22" stroke-width="2" points="171.36,-624 161.56,-619.97 166.71,-629.23 171.36,-624"/>
<text xml:space="preserve" text-anchor="middle" x="218.83" y="-637.25" font-family="Helvetica,sans-Serif" font-size="10.00">struct variant</text>
</g>
<g id="node7" class="node">
<title>not_found</title>
<polygon fill="#f8d7da" stroke="black" points="497.12,-617.5 274.62,-617.5 274.62,-573 497.12,-573 497.12,-617.5"/>
<polygon fill="#f8d7da" stroke="none" points="282.62,-595.25 282.62,-613.5 489.12,-613.5 489.12,-595.25 282.62,-595.25"/>
<text xml:space="preserve" text-anchor="start" x="352.12" y="-602.05" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Not found?</text>
<text xml:space="preserve" text-anchor="start" x="284.62" y="-583.8" font-family="Monaco" font-size="11.00" fill="#8250df">__attr_error!</text>
<text xml:space="preserve" text-anchor="start" x="372.38" y="-583.8" font-family="Monaco, Consolas, Courier" font-size="11.00"> with suggestions</text>
</g>
<g id="edge3" class="edge">
<title>lookup&#45;&gt;not_found</title>
<path fill="none" stroke="#dc3545" stroke-dasharray="5,2" d="M301.8,-671.58C318.51,-656.61 337.55,-639.55 353.28,-625.45"/>
<polygon fill="#dc3545" stroke="#dc3545" points="355.41,-628.25 360.52,-618.97 350.74,-623.03 355.41,-628.25"/>
<text xml:space="preserve" text-anchor="middle" x="361.38" y="-637.25" font-family="Helvetica,sans-Serif" font-size="10.00">unknown</text>
</g>
<g id="node4" class="node">
<title>build_fields</title>
<polygon fill="#fff9e6" stroke="black" points="259.62,-536 10.13,-536 10.13,-345.5 259.62,-345.5 259.62,-536"/>
<polygon fill="#fff3cd" stroke="none" points="18.12,-513.75 18.12,-532 251.62,-532 251.62,-513.75 18.12,-513.75"/>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-520.55" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">::facet::__build_struct_fields!</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-502.3" font-family="Monaco" font-size="11.00">::facet::</text>
<text xml:space="preserve" text-anchor="start" x="80.88" y="-502.3" font-family="Monaco" font-size="11.00" fill="#8250df">__build_struct_fields!</text>
<text xml:space="preserve" text-anchor="start" x="229.38" y="-502.3" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-484.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="47.12" y="-484.05" font-family="Monaco" font-size="11.00" fill="#8250df">@namespace</text>
<text xml:space="preserve" text-anchor="start" x="114.62" y="-484.05" font-family="Monaco" font-size="11.00"> { ::orm }</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-465.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="47.12" y="-465.8" font-family="Monaco" font-size="11.00" fill="#8250df">@struct_name</text>
<text xml:space="preserve" text-anchor="start" x="128.12" y="-465.8" font-family="Monaco" font-size="11.00"> { </text>
<text xml:space="preserve" text-anchor="start" x="148.38" y="-465.8" font-family="Monaco" font-size="11.00" fill="#0550ae">Column</text>
<text xml:space="preserve" text-anchor="start" x="188.88" y="-465.8" font-family="Monaco" font-size="11.00"> }</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-447.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="47.12" y="-447.55" font-family="Monaco" font-size="11.00" fill="#8250df">@fields</text>
<text xml:space="preserve" text-anchor="start" x="94.38" y="-447.55" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-429.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;primary_key: </text>
<text xml:space="preserve" text-anchor="start" x="161.88" y="-429.3" font-family="Monaco" font-size="11.00" fill="#0550ae">bool</text>
<text xml:space="preserve" text-anchor="start" x="188.88" y="-429.3" font-family="Monaco" font-size="11.00"> = </text>
<text xml:space="preserve" text-anchor="start" x="209.12" y="-429.3" font-family="Monaco" font-size="11.00" fill="#0550ae">false</text>
<text xml:space="preserve" text-anchor="start" x="242.88" y="-429.3" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-411.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;name: opt_str = </text>
<text xml:space="preserve" text-anchor="start" x="182.12" y="-411.05" font-family="Monaco" font-size="11.00" fill="#0550ae">None</text>
<text xml:space="preserve" text-anchor="start" x="209.12" y="-411.05" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-391.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;}</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-374.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="47.12" y="-374.55" font-family="Monaco" font-size="11.00" fill="#8250df">@input</text>
<text xml:space="preserve" text-anchor="start" x="87.62" y="-374.55" font-family="Monaco" font-size="11.00"> { (primary_key) }</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-355.3" font-family="Monaco" font-size="11.00">}</text>
</g>
<g id="edge4" class="edge">
<title>found_struct&#45;&gt;build_fields</title>
<path fill="none" stroke="black" d="M134.88,-572.72C134.88,-565.47 134.88,-556.81 134.88,-547.45"/>
<polygon fill="black" stroke="black" points="138.38,-547.7 134.88,-537.7 131.38,-547.7 138.38,-547.7"/>
</g>
<g id="node5" class="node">
<title>field_parse</title>
<polygon fill="#e8e8f4" stroke="black" points="269.75,-308.5 0,-308.5 0,-227.5 269.75,-227.5 269.75,-308.5"/>
<polygon fill="#e8e8f4" stroke="none" points="8,-286.25 8,-304.5 261.75,-304.5 261.75,-286.25 8,-286.25"/>
<text xml:space="preserve" text-anchor="start" x="91" y="-293.05" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Field Parsing</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-273.8" font-family="Monaco, Consolas, Courier" font-size="11.00">For each token in input:</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-256.55" font-family="Monaco" font-size="11.00">primary_key</text>
<text xml:space="preserve" text-anchor="start" x="84.25" y="-256.55" font-family="Monaco, Consolas, Courier" font-size="11.00"> → set </text>
<text xml:space="preserve" text-anchor="start" x="131.5" y="-256.55" font-family="Monaco" font-size="11.00">primary_key = </text>
<text xml:space="preserve" text-anchor="start" x="226" y="-256.55" font-family="Monaco" font-size="11.00" fill="#0550ae">true</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-238.3" font-family="Monaco" font-size="11.00">name = </text>
<text xml:space="preserve" text-anchor="start" x="57.25" y="-238.3" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;foo&quot;</text>
<text xml:space="preserve" text-anchor="start" x="91" y="-238.3" font-family="Monaco, Consolas, Courier" font-size="11.00"> → set </text>
<text xml:space="preserve" text-anchor="start" x="138.25" y="-238.3" font-family="Monaco" font-size="11.00">name = </text>
<text xml:space="preserve" text-anchor="start" x="185.5" y="-238.3" font-family="Monaco" font-size="11.00" fill="#0550ae">Some</text>
<text xml:space="preserve" text-anchor="start" x="212.5" y="-238.3" font-family="Monaco" font-size="11.00">(</text>
<text xml:space="preserve" text-anchor="start" x="219.25" y="-238.3" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;foo&quot;</text>
<text xml:space="preserve" text-anchor="start" x="253" y="-238.3" font-family="Monaco" font-size="11.00">)</text>
</g>
<g id="edge5" class="edge">
<title>build_fields&#45;&gt;field_parse</title>
<path fill="none" stroke="black" d="M134.88,-345.39C134.88,-336.78 134.88,-328.3 134.88,-320.3"/>
<polygon fill="black" stroke="black" points="138.38,-320.48 134.88,-310.48 131.38,-320.48 138.38,-320.48"/>
</g>
<g id="node6" class="node">
<title>output</title>
<polygon fill="#e8f5e9" stroke="black" points="259.62,-190.5 10.13,-190.5 10.13,0 259.62,0 259.62,-190.5"/>
<polygon fill="#d4edda" stroke="none" points="18.12,-168.25 18.12,-186.5 251.62,-186.5 251.62,-168.25 18.12,-168.25"/>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-175.05" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Final Output</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-156.8" font-family="Monaco" font-size="11.00">::facet_core::</text>
<text xml:space="preserve" text-anchor="start" x="114.62" y="-156.8" font-family="Monaco" font-size="11.00" fill="#0550ae">Attribute</text>
<text xml:space="preserve" text-anchor="start" x="175.38" y="-156.8" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-138.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;ns: </text>
<text xml:space="preserve" text-anchor="start" x="74.12" y="-138.55" font-family="Monaco" font-size="11.00" fill="#0550ae">Some</text>
<text xml:space="preserve" text-anchor="start" x="101.12" y="-138.55" font-family="Monaco" font-size="11.00">(</text>
<text xml:space="preserve" text-anchor="start" x="107.88" y="-138.55" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;orm&quot;</text>
<text xml:space="preserve" text-anchor="start" x="141.62" y="-138.55" font-family="Monaco" font-size="11.00">),</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-120.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;key: </text>
<text xml:space="preserve" text-anchor="start" x="80.88" y="-120.3" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;column&quot;</text>
<text xml:space="preserve" text-anchor="start" x="134.88" y="-120.3" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-102.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;data: </text>
<text xml:space="preserve" text-anchor="start" x="87.62" y="-102.05" font-family="Monaco" font-size="11.00" fill="#cf222e">&amp;</text>
<text xml:space="preserve" text-anchor="start" x="94.38" y="-102.05" font-family="Monaco" font-size="11.00">::orm::</text>
<text xml:space="preserve" text-anchor="start" x="141.62" y="-102.05" font-family="Monaco" font-size="11.00" fill="#0550ae">Column</text>
<text xml:space="preserve" text-anchor="start" x="182.12" y="-102.05" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-83.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;primary_key: </text>
<text xml:space="preserve" text-anchor="start" x="161.88" y="-83.8" font-family="Monaco" font-size="11.00" fill="#0550ae">true</text>
<text xml:space="preserve" text-anchor="start" x="188.88" y="-83.8" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-65.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;name: </text>
<text xml:space="preserve" text-anchor="start" x="114.62" y="-65.55" font-family="Monaco" font-size="11.00" fill="#0550ae">None</text>
<text xml:space="preserve" text-anchor="start" x="141.62" y="-65.55" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-46.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;},</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-29.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;shape: &lt;::orm::</text>
<text xml:space="preserve" text-anchor="start" x="148.38" y="-29.05" font-family="Monaco" font-size="11.00" fill="#0550ae">Column</text>
<text xml:space="preserve" text-anchor="start" x="188.88" y="-29.05" font-family="Monaco" font-size="11.00">&gt;::SHAPE,</text>
<text xml:space="preserve" text-anchor="start" x="20.12" y="-9.8" font-family="Monaco" font-size="11.00">}</text>
</g>
<g id="edge6" class="edge">
<title>field_parse&#45;&gt;output</title>
<path fill="none" stroke="#228b22" stroke-width="2" d="M134.88,-227.4C134.88,-220 134.88,-211.96 134.88,-203.62"/>
<polygon fill="#228b22" stroke="#228b22" stroke-width="2" points="138.38,-203.8 134.88,-193.8 131.38,-203.8 138.38,-203.8"/>
</g>
</g>
</svg>
      <p class="diagram-caption">Dispatches to unit/newtype/struct handlers, or __attr_error! if not found</p>
    </div>

    <h3>3. Error Flow</h3>
    <p>How typos get helpful suggestions:</p>
    <div class="diagram">
      <svg width="305pt" height="715pt"
 viewBox="0.00 0.00 305.00 715.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 711.25)">
<title>error_flow</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-711.25 300.75,-711.25 300.75,4 -4,4"/>
<text xml:space="preserve" text-anchor="middle" x="148.38" y="-684.25" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="20.00">Error Flow (typo handling)</text>
<g id="node1" class="node">
<title>typo</title>
<polygon fill="#fff8f0" stroke="black" points="269.75,-678.25 27,-678.25 27,-615.5 269.75,-615.5 269.75,-678.25"/>
<polygon fill="#fff8f0" stroke="none" points="35,-656 35,-674.25 261.75,-674.25 261.75,-656 35,-656"/>
<text xml:space="preserve" text-anchor="start" x="37" y="-662.8" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">User code with typo</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-644.55" font-family="Monaco" font-size="11.00">#[</text>
<text xml:space="preserve" text-anchor="start" x="50.5" y="-644.55" font-family="Monaco" font-size="11.00" fill="#8250df">facet</text>
<text xml:space="preserve" text-anchor="start" x="84.25" y="-644.55" font-family="Monaco" font-size="11.00">(orm::</text>
<text xml:space="preserve" text-anchor="start" x="124.75" y="-644.55" font-family="Monaco" font-size="11.00" fill="#dc3545">colum</text>
<text xml:space="preserve" text-anchor="start" x="158.5" y="-644.55" font-family="Monaco" font-size="11.00">(primary_key))]</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-625.3" font-family="Monaco, Consolas, Courier" font-size="11.00" fill="#dc3545"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;^^^^^ typo!</text>
</g>
<g id="node2" class="node">
<title>dispatch</title>
<polygon fill="#e8e8f4" stroke="black" points="256.25,-568.25 40.5,-568.25 40.5,-487.25 256.25,-487.25 256.25,-568.25"/>
<polygon fill="#e8e8f4" stroke="none" points="48.5,-546 48.5,-564.25 248.25,-564.25 248.25,-546 48.5,-546"/>
<text xml:space="preserve" text-anchor="start" x="91" y="-552.8" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">facet&#45;macros&#45;impl</text>
<text xml:space="preserve" text-anchor="start" x="64" y="-534.55" font-family="Monaco" font-size="11.00">::facet::</text>
<text xml:space="preserve" text-anchor="start" x="124.75" y="-534.55" font-family="Monaco" font-size="11.00" fill="#8250df">__dispatch_attr!</text>
<text xml:space="preserve" text-anchor="start" x="50.5" y="-516.3" font-family="Monaco, Consolas, Courier" font-size="11.00">Looks up </text>
<text xml:space="preserve" text-anchor="start" x="111.25" y="-516.3" font-family="Monaco" font-size="11.00" fill="#dc3545">&#39;colum&#39;</text>
<text xml:space="preserve" text-anchor="start" x="158.5" y="-516.3" font-family="Monaco, Consolas, Courier" font-size="11.00"> in @variants</text>
<text xml:space="preserve" text-anchor="start" x="114.62" y="-498.05" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Not found!</text>
</g>
<g id="edge1" class="edge">
<title>typo&#45;&gt;dispatch</title>
<path fill="none" stroke="#666666" d="M148.38,-615.1C148.38,-604.32 148.38,-591.89 148.38,-579.89"/>
<polygon fill="#666666" stroke="#666666" points="151.88,-580.1 148.38,-570.1 144.88,-580.1 151.88,-580.1"/>
<text xml:space="preserve" text-anchor="middle" x="177.62" y="-588" font-family="Helvetica,sans-Serif" font-size="10.00">processed by</text>
</g>
<g id="node3" class="node">
<title>attr_error</title>
<polygon fill="#fff9e6" stroke="black" points="296.75,-440 0,-440 0,-322.5 296.75,-322.5 296.75,-440"/>
<polygon fill="#fff3cd" stroke="none" points="8,-417.75 8,-436 288.75,-436 288.75,-417.75 8,-417.75"/>
<text xml:space="preserve" text-anchor="start" x="10" y="-424.55" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">facet&#45;macros&#45;impl</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-406.3" font-family="Monaco" font-size="11.00">::facet::</text>
<text xml:space="preserve" text-anchor="start" x="70.75" y="-406.3" font-family="Monaco" font-size="11.00" fill="#8250df">__attr_error!</text>
<text xml:space="preserve" text-anchor="start" x="158.5" y="-406.3" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-388.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-388.05" font-family="Monaco" font-size="11.00" fill="#8250df">@known_attrs</text>
<text xml:space="preserve" text-anchor="start" x="118" y="-388.05" font-family="Monaco" font-size="11.00"> { skip, column, rename }</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-369.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-369.8" font-family="Monaco" font-size="11.00" fill="#8250df">@got_name</text>
<text xml:space="preserve" text-anchor="start" x="97.75" y="-369.8" font-family="Monaco" font-size="11.00"> { </text>
<text xml:space="preserve" text-anchor="start" x="118" y="-369.8" font-family="Monaco" font-size="11.00" fill="#dc3545">colum</text>
<text xml:space="preserve" text-anchor="start" x="151.75" y="-369.8" font-family="Monaco" font-size="11.00"> }</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-351.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="37" y="-351.55" font-family="Monaco" font-size="11.00" fill="#8250df">@got_span</text>
<text xml:space="preserve" text-anchor="start" x="97.75" y="-351.55" font-family="Monaco" font-size="11.00"> { ... }</text>
<text xml:space="preserve" text-anchor="start" x="10" y="-332.3" font-family="Monaco" font-size="11.00">}</text>
</g>
<g id="edge2" class="edge">
<title>dispatch&#45;&gt;attr_error</title>
<path fill="none" stroke="#dc3545" stroke-width="2" d="M148.38,-486.88C148.38,-476.44 148.38,-464.87 148.38,-453.33"/>
<polygon fill="#dc3545" stroke="#dc3545" stroke-width="2" points="151.88,-453.41 148.38,-443.41 144.88,-453.41 151.88,-453.41"/>
<text xml:space="preserve" text-anchor="middle" x="184.75" y="-459.75" font-family="Helvetica,sans-Serif" font-size="10.00">variant not found</text>
</g>
<g id="node4" class="node">
<title>strsim</title>
<polygon fill="#e8f5e9" stroke="black" points="290,-275.25 6.75,-275.25 6.75,-194.25 290,-194.25 290,-275.25"/>
<polygon fill="#e8f5e9" stroke="none" points="14.75,-253 14.75,-271.25 282,-271.25 282,-253 14.75,-253"/>
<text xml:space="preserve" text-anchor="start" x="107.88" y="-259.8" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">strsim crate</text>
<text xml:space="preserve" text-anchor="start" x="16.75" y="-241.55" font-family="Monaco" font-size="11.00">strsim::jaro_winkler(</text>
<text xml:space="preserve" text-anchor="start" x="158.5" y="-241.55" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;colum&quot;</text>
<text xml:space="preserve" text-anchor="start" x="205.75" y="-241.55" font-family="Monaco" font-size="11.00">, </text>
<text xml:space="preserve" text-anchor="start" x="219.25" y="-241.55" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;column&quot;</text>
<text xml:space="preserve" text-anchor="start" x="273.25" y="-241.55" font-family="Monaco" font-size="11.00">)</text>
<text xml:space="preserve" text-anchor="start" x="47.12" y="-223.3" font-family="Monaco, Consolas, Courier" font-size="11.00">Returns </text>
<text xml:space="preserve" text-anchor="start" x="101.12" y="-223.3" font-family="Monaco" font-size="11.00">0.96</text>
<text xml:space="preserve" text-anchor="start" x="128.12" y="-223.3" font-family="Monaco, Consolas, Courier" font-size="11.00"> (high similarity)</text>
<text xml:space="preserve" text-anchor="start" x="80.88" y="-205.05" font-family="Monaco, Consolas, Courier" font-size="11.00">Best match: </text>
<text xml:space="preserve" text-anchor="start" x="161.88" y="-205.05" font-family="Monaco" font-size="11.00" fill="#228b22">&quot;column&quot;</text>
</g>
<g id="edge3" class="edge">
<title>attr_error&#45;&gt;strsim</title>
<path fill="none" stroke="#666666" d="M148.38,-322.31C148.38,-310.53 148.38,-298.23 148.38,-286.71"/>
<polygon fill="#666666" stroke="#666666" points="151.88,-287.02 148.38,-277.02 144.88,-287.02 151.88,-287.02"/>
<text xml:space="preserve" text-anchor="middle" x="172" y="-295" font-family="Helvetica,sans-Serif" font-size="10.00">find similar</text>
</g>
<g id="node5" class="node">
<title>error_output</title>
<polygon fill="#f8d7da" stroke="black" points="273.12,-135.75 23.63,-135.75 23.63,0 273.12,0 273.12,-135.75"/>
<polygon fill="#f8d7da" stroke="none" points="31.62,-113.5 31.62,-131.75 265.12,-131.75 265.12,-113.5 31.62,-113.5"/>
<text xml:space="preserve" text-anchor="start" x="33.62" y="-120.3" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Compiler output</text>
<text xml:space="preserve" text-anchor="start" x="33.62" y="-101.05" font-family="Monaco" font-size="11.00" fill="#dc3545">error: unknown attribute `colum`</text>
<text xml:space="preserve" text-anchor="start" x="33.62" y="-82.8" font-family="Monaco" font-size="11.00" fill="#dc3545"> &#160;&#160;&#160;&#160;&#160;&#160;did you mean `column`?</text>
<text xml:space="preserve" text-anchor="start" x="33.62" y="-64.55" font-family="Monaco" font-size="11.00"> &#160;&#45;&#45;&gt; src/lib.rs:3:13</text>
<text xml:space="preserve" text-anchor="start" x="33.62" y="-46.3" font-family="Monaco" font-size="11.00"> &#160;&#160;|</text>
<text xml:space="preserve" text-anchor="start" x="33.62" y="-28.05" font-family="Monaco" font-size="11.00">3 &#160;| &#160;&#160;&#160;&#160;#[facet(orm::colum(...))]</text>
<text xml:space="preserve" text-anchor="start" x="33.62" y="-10.8" font-family="Monaco" font-size="11.00"> &#160;&#160;| &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="182.12" y="-10.8" font-family="Monaco" font-size="11.00" fill="#dc3545">^^^^^</text>
</g>
<g id="edge4" class="edge">
<title>strsim&#45;&gt;error_output</title>
<path fill="none" stroke="#dc3545" stroke-width="2" d="M148.38,-193.84C148.38,-180.29 148.38,-164.63 148.38,-149.07"/>
<polygon fill="#dc3545" stroke="#dc3545" stroke-width="2" points="151.88,-149.1 148.38,-139.1 144.88,-149.1 151.88,-149.1"/>
<text xml:space="preserve" text-anchor="middle" x="186.25" y="-166.75" font-family="Helvetica,sans-Serif" font-size="10.00">compile_error!</text>
<text xml:space="preserve" text-anchor="middle" x="186.25" y="-155.5" font-family="Helvetica,sans-Serif" font-size="10.00">with original span</text>
</g>
</g>
</svg>
      <p class="diagram-caption">strsim finds similar attribute names for "did you mean?" suggestions</p>
    </div>

    <h3>4. Storage Model</h3>
    <p>How everything becomes <code>::facet_core::Attribute</code>:</p>
    <div class="diagram">
      <svg width="877pt" height="352pt"
 viewBox="0.00 0.00 877.00 352.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 348)">
<title>storage_model</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-348 872.5,-348 872.5,4 -4,4"/>
<text xml:space="preserve" text-anchor="middle" x="434.25" y="-321" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="20.00">Storage Model: Unified Attr type</text>
<g id="clust1" class="cluster">
<title>cluster_input</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="8,-63 8,-251 239.75,-251 239.75,-63 8,-63"/>
<text xml:space="preserve" text-anchor="middle" x="123.88" y="-228" font-family="Helvetica,sans-Serif" font-size="20.00">User writes</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_output</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="259.75,-8 259.75,-307 568.25,-307 568.25,-8 259.75,-8"/>
<text xml:space="preserve" text-anchor="middle" x="414" y="-284" font-family="Helvetica,sans-Serif" font-size="20.00">All become ::facet_core::Attribute</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_storage</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="588.25,-8 588.25,-307 860.5,-307 860.5,-8 588.25,-8"/>
<text xml:space="preserve" text-anchor="middle" x="724.38" y="-284" font-family="Helvetica,sans-Serif" font-size="20.00">Stored in Shape metadata</text>
</g>
<g id="node1" class="node">
<title>builtin</title>
<polygon fill="#fff8f0" stroke="black" points="231.75,-133.38 16,-133.38 16,-70.62 231.75,-70.62 231.75,-133.38"/>
<polygon fill="#fff8f0" stroke="none" points="24,-111.12 24,-129.38 223.75,-129.38 223.75,-111.12 24,-111.12"/>
<text xml:space="preserve" text-anchor="start" x="26" y="-117.92" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Built&#45;in attrs (no namespace)</text>
<text xml:space="preserve" text-anchor="start" x="26" y="-99.67" font-family="Monaco" font-size="11.00">#[</text>
<text xml:space="preserve" text-anchor="start" x="39.5" y="-99.67" font-family="Monaco" font-size="11.00" fill="#8250df">facet</text>
<text xml:space="preserve" text-anchor="start" x="73.25" y="-99.67" font-family="Monaco" font-size="11.00">(skip)]</text>
<text xml:space="preserve" text-anchor="start" x="26" y="-81.42" font-family="Monaco" font-size="11.00">#[</text>
<text xml:space="preserve" text-anchor="start" x="39.5" y="-81.42" font-family="Monaco" font-size="11.00" fill="#8250df">facet</text>
<text xml:space="preserve" text-anchor="start" x="73.25" y="-81.42" font-family="Monaco" font-size="11.00">(rename = </text>
<text xml:space="preserve" text-anchor="start" x="140.75" y="-81.42" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;foo&quot;</text>
<text xml:space="preserve" text-anchor="start" x="174.5" y="-81.42" font-family="Monaco" font-size="11.00">)]</text>
</g>
<g id="node3" class="node">
<title>ext1</title>
<polygon fill="#e8f5e9" stroke="black" points="534.88,-133.75 292.12,-133.75 292.12,-16.25 534.88,-16.25 534.88,-133.75"/>
<text xml:space="preserve" text-anchor="start" x="302.12" y="-118.3" font-family="Monaco" font-size="11.00">::facet_core::</text>
<text xml:space="preserve" text-anchor="start" x="396.62" y="-118.3" font-family="Monaco" font-size="11.00" fill="#0550ae">Attribute</text>
<text xml:space="preserve" text-anchor="start" x="457.38" y="-118.3" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="302.12" y="-100.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;ns: </text>
<text xml:space="preserve" text-anchor="start" x="356.12" y="-100.05" font-family="Monaco" font-size="11.00" fill="#0550ae">None</text>
<text xml:space="preserve" text-anchor="start" x="383.12" y="-100.05" font-family="Monaco" font-size="11.00">, &#160;</text>
<text xml:space="preserve" text-anchor="start" x="403.38" y="-100.05" font-family="Monaco" font-size="11.00" fill="#6e7781">// None = built&#45;in</text>
<text xml:space="preserve" text-anchor="start" x="302.12" y="-81.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;key: </text>
<text xml:space="preserve" text-anchor="start" x="362.88" y="-81.8" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;skip&quot;</text>
<text xml:space="preserve" text-anchor="start" x="403.38" y="-81.8" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="302.12" y="-63.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;data: </text>
<text xml:space="preserve" text-anchor="start" x="369.62" y="-63.55" font-family="Monaco" font-size="11.00" fill="#cf222e">&amp;</text>
<text xml:space="preserve" text-anchor="start" x="376.38" y="-63.55" font-family="Monaco" font-size="11.00">() </text>
<text xml:space="preserve" text-anchor="start" x="396.62" y="-63.55" font-family="Monaco" font-size="11.00" fill="#cf222e">as</text>
<text xml:space="preserve" text-anchor="start" x="410.12" y="-63.55" font-family="Monaco" font-size="11.00"> *</text>
<text xml:space="preserve" text-anchor="start" x="423.62" y="-63.55" font-family="Monaco" font-size="11.00" fill="#cf222e">const</text>
<text xml:space="preserve" text-anchor="start" x="457.38" y="-63.55" font-family="Monaco" font-size="11.00"> (),</text>
<text xml:space="preserve" text-anchor="start" x="302.12" y="-44.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;shape: &lt;()&gt;::SHAPE,</text>
<text xml:space="preserve" text-anchor="start" x="302.12" y="-26.05" font-family="Monaco" font-size="11.00">}</text>
</g>
<g id="edge1" class="edge">
<title>builtin&#45;&gt;ext1</title>
<path fill="none" stroke="#228b22" stroke-width="2" d="M231.98,-91.95C247.35,-90.5 263.33,-89 279.13,-87.52"/>
<polygon fill="#228b22" stroke="#228b22" stroke-width="2" points="279.12,-91.04 288.74,-86.62 278.46,-84.07 279.12,-91.04"/>
</g>
<g id="node2" class="node">
<title>extension</title>
<polygon fill="#f4e8e8" stroke="black" points="218.25,-214.38 29.5,-214.38 29.5,-151.62 218.25,-151.62 218.25,-214.38"/>
<polygon fill="#f4e8e8" stroke="none" points="37.5,-192.12 37.5,-210.38 210.25,-210.38 210.25,-192.12 37.5,-192.12"/>
<text xml:space="preserve" text-anchor="start" x="39.5" y="-198.93" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">Namespaced attrs</text>
<text xml:space="preserve" text-anchor="start" x="39.5" y="-180.68" font-family="Monaco" font-size="11.00">#[</text>
<text xml:space="preserve" text-anchor="start" x="53" y="-180.68" font-family="Monaco" font-size="11.00" fill="#8250df">facet</text>
<text xml:space="preserve" text-anchor="start" x="86.75" y="-180.68" font-family="Monaco" font-size="11.00">(kdl::child)]</text>
<text xml:space="preserve" text-anchor="start" x="39.5" y="-162.43" font-family="Monaco" font-size="11.00">#[</text>
<text xml:space="preserve" text-anchor="start" x="53" y="-162.43" font-family="Monaco" font-size="11.00" fill="#8250df">facet</text>
<text xml:space="preserve" text-anchor="start" x="86.75" y="-162.43" font-family="Monaco" font-size="11.00">(orm::column(pk))]</text>
</g>
<g id="node4" class="node">
<title>ext2</title>
<polygon fill="#e8f5e9" stroke="black" points="514.62,-269.75 312.38,-269.75 312.38,-152.25 514.62,-152.25 514.62,-269.75"/>
<text xml:space="preserve" text-anchor="start" x="322.38" y="-254.3" font-family="Monaco" font-size="11.00">::facet_core::</text>
<text xml:space="preserve" text-anchor="start" x="416.88" y="-254.3" font-family="Monaco" font-size="11.00" fill="#0550ae">Attribute</text>
<text xml:space="preserve" text-anchor="start" x="477.62" y="-254.3" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="322.38" y="-236.05" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;ns: </text>
<text xml:space="preserve" text-anchor="start" x="376.38" y="-236.05" font-family="Monaco" font-size="11.00" fill="#0550ae">Some</text>
<text xml:space="preserve" text-anchor="start" x="403.38" y="-236.05" font-family="Monaco" font-size="11.00">(</text>
<text xml:space="preserve" text-anchor="start" x="410.12" y="-236.05" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;kdl&quot;</text>
<text xml:space="preserve" text-anchor="start" x="443.88" y="-236.05" font-family="Monaco" font-size="11.00">),</text>
<text xml:space="preserve" text-anchor="start" x="322.38" y="-217.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;key: </text>
<text xml:space="preserve" text-anchor="start" x="383.12" y="-217.8" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;child&quot;</text>
<text xml:space="preserve" text-anchor="start" x="430.38" y="-217.8" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="322.38" y="-199.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;data: </text>
<text xml:space="preserve" text-anchor="start" x="389.88" y="-199.55" font-family="Monaco" font-size="11.00" fill="#cf222e">&amp;</text>
<text xml:space="preserve" text-anchor="start" x="396.62" y="-199.55" font-family="Monaco" font-size="11.00">() </text>
<text xml:space="preserve" text-anchor="start" x="416.88" y="-199.55" font-family="Monaco" font-size="11.00" fill="#cf222e">as</text>
<text xml:space="preserve" text-anchor="start" x="430.38" y="-199.55" font-family="Monaco" font-size="11.00"> *</text>
<text xml:space="preserve" text-anchor="start" x="443.88" y="-199.55" font-family="Monaco" font-size="11.00" fill="#cf222e">const</text>
<text xml:space="preserve" text-anchor="start" x="477.62" y="-199.55" font-family="Monaco" font-size="11.00"> (),</text>
<text xml:space="preserve" text-anchor="start" x="322.38" y="-180.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;shape: &lt;()&gt;::SHAPE,</text>
<text xml:space="preserve" text-anchor="start" x="322.38" y="-162.05" font-family="Monaco" font-size="11.00">}</text>
</g>
<g id="edge2" class="edge">
<title>extension&#45;&gt;ext2</title>
<path fill="none" stroke="#228b22" stroke-width="2" d="M218.66,-192.13C244.3,-194.63 272.36,-197.36 298.98,-199.95"/>
<polygon fill="#228b22" stroke="#228b22" stroke-width="2" points="298.6,-203.43 308.89,-200.91 299.28,-196.46 298.6,-203.43"/>
</g>
<g id="node5" class="node">
<title>field</title>
<polygon fill="#e8f5e9" stroke="black" points="852.5,-133.75 596.25,-133.75 596.25,-16.25 852.5,-16.25 852.5,-133.75"/>
<polygon fill="#d4edda" stroke="none" points="604.25,-111.5 604.25,-129.75 844.5,-129.75 844.5,-111.5 604.25,-111.5"/>
<text xml:space="preserve" text-anchor="start" x="606.25" y="-118.3" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">::facet_core::Field</text>
<text xml:space="preserve" text-anchor="start" x="606.25" y="-100.05" font-family="Monaco" font-size="11.00">::facet_core::</text>
<text xml:space="preserve" text-anchor="start" x="700.75" y="-100.05" font-family="Monaco" font-size="11.00" fill="#0550ae">Field</text>
<text xml:space="preserve" text-anchor="start" x="734.5" y="-100.05" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="606.25" y="-81.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;name: </text>
<text xml:space="preserve" text-anchor="start" x="673.75" y="-81.8" font-family="Monaco" font-size="11.00" fill="#0a3069">&quot;id&quot;</text>
<text xml:space="preserve" text-anchor="start" x="700.75" y="-81.8" font-family="Monaco" font-size="11.00">,</text>
<text xml:space="preserve" text-anchor="start" x="606.25" y="-63.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;attributes: </text>
<text xml:space="preserve" text-anchor="start" x="714.25" y="-63.55" font-family="Monaco" font-size="11.00" fill="#cf222e">&amp;</text>
<text xml:space="preserve" text-anchor="start" x="721" y="-63.55" font-family="Monaco" font-size="11.00">[</text>
<text xml:space="preserve" text-anchor="start" x="727.75" y="-63.55" font-family="Monaco" font-size="11.00" fill="#0550ae">Attribute</text>
<text xml:space="preserve" text-anchor="start" x="788.5" y="-63.55" font-family="Monaco" font-size="11.00"> {...}],</text>
<text xml:space="preserve" text-anchor="start" x="606.25" y="-44.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;...</text>
<text xml:space="preserve" text-anchor="start" x="606.25" y="-26.05" font-family="Monaco" font-size="11.00">}</text>
</g>
<g id="edge3" class="edge">
<title>ext1&#45;&gt;field</title>
<path fill="none" stroke="#228b22" stroke-width="2" d="M535.25,-75C550.93,-75 567.11,-75 583.08,-75"/>
<polygon fill="#228b22" stroke="#228b22" stroke-width="2" points="582.8,-78.5 592.8,-75 582.8,-71.5 582.8,-78.5"/>
</g>
<g id="node6" class="node">
<title>container</title>
<polygon fill="#e8f5e9" stroke="black" points="852.5,-269.75 596.25,-269.75 596.25,-152.25 852.5,-152.25 852.5,-269.75"/>
<polygon fill="#d4edda" stroke="none" points="604.25,-247.5 604.25,-265.75 844.5,-265.75 844.5,-247.5 604.25,-247.5"/>
<text xml:space="preserve" text-anchor="start" x="606.25" y="-254.3" font-family="Monaco, Consolas, Courier" font-weight="bold" font-size="11.00">::facet_core::StructType (etc)</text>
<text xml:space="preserve" text-anchor="start" x="606.25" y="-236.05" font-family="Monaco" font-size="11.00">::facet_core::</text>
<text xml:space="preserve" text-anchor="start" x="700.75" y="-236.05" font-family="Monaco" font-size="11.00" fill="#0550ae">StructType</text>
<text xml:space="preserve" text-anchor="start" x="768.25" y="-236.05" font-family="Monaco" font-size="11.00"> {</text>
<text xml:space="preserve" text-anchor="start" x="606.25" y="-217.8" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;attributes: </text>
<text xml:space="preserve" text-anchor="start" x="714.25" y="-217.8" font-family="Monaco" font-size="11.00" fill="#cf222e">&amp;</text>
<text xml:space="preserve" text-anchor="start" x="721" y="-217.8" font-family="Monaco" font-size="11.00">[</text>
<text xml:space="preserve" text-anchor="start" x="727.75" y="-217.8" font-family="Monaco" font-size="11.00" fill="#0550ae">Attribute</text>
<text xml:space="preserve" text-anchor="start" x="788.5" y="-217.8" font-family="Monaco" font-size="11.00"> {...}],</text>
<text xml:space="preserve" text-anchor="start" x="606.25" y="-199.55" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;fields: </text>
<text xml:space="preserve" text-anchor="start" x="687.25" y="-199.55" font-family="Monaco" font-size="11.00" fill="#cf222e">&amp;</text>
<text xml:space="preserve" text-anchor="start" x="694" y="-199.55" font-family="Monaco" font-size="11.00">[</text>
<text xml:space="preserve" text-anchor="start" x="700.75" y="-199.55" font-family="Monaco" font-size="11.00" fill="#0550ae">Field</text>
<text xml:space="preserve" text-anchor="start" x="734.5" y="-199.55" font-family="Monaco" font-size="11.00"> {...}],</text>
<text xml:space="preserve" text-anchor="start" x="606.25" y="-180.3" font-family="Monaco" font-size="11.00"> &#160;&#160;&#160;...</text>
<text xml:space="preserve" text-anchor="start" x="606.25" y="-162.05" font-family="Monaco" font-size="11.00">}</text>
</g>
<g id="edge4" class="edge">
<title>ext1&#45;&gt;container</title>
<path fill="none" stroke="#228b22" stroke-width="2" stroke-dasharray="5,2" d="M535.25,-128.17C551.24,-135.21 567.75,-142.48 584.03,-149.64"/>
<polygon fill="#228b22" stroke="#228b22" stroke-width="2" points="582.5,-152.8 593.06,-153.62 585.32,-146.39 582.5,-152.8"/>
</g>
<g id="edge5" class="edge">
<title>ext2&#45;&gt;field</title>
<path fill="none" stroke="#228b22" stroke-width="2" d="M514.78,-166.84C536.93,-157.09 560.79,-146.59 584.17,-136.29"/>
<polygon fill="#228b22" stroke="#228b22" stroke-width="2" points="585.46,-139.55 593.2,-132.32 582.64,-133.14 585.46,-139.55"/>
</g>
<g id="edge6" class="edge">
<title>ext2&#45;&gt;container</title>
<path fill="none" stroke="#228b22" stroke-width="2" stroke-dasharray="5,2" d="M514.78,-211C536.63,-211 560.14,-211 583.21,-211"/>
<polygon fill="#228b22" stroke="#228b22" stroke-width="2" points="582.95,-214.5 592.95,-211 582.95,-207.5 582.95,-214.5"/>
</g>
</g>
</svg>
      <p class="diagram-caption">Built-in attrs have no namespace prefix, extension attrs use their crate name as namespace</p>
    </div>

    <hr>

    <h2>The Grammar DSL</h2>

    <h3>Supported Variant Types</h3>
    <table>
      <thead>
        <tr><th>Type</th><th>Syntax</th><th>Example</th></tr>
      </thead>
      <tbody>
        <tr><td><strong>Unit</strong></td><td>Just the name</td><td><code>Skip</code> → <code>#[facet(ns::skip)]</code></td></tr>
        <tr><td><strong>Newtype</strong></td><td>Name with payload type</td><td><code>Rename(&amp;'static str)</code> → <code>#[facet(ns::rename = "foo")]</code></td></tr>
        <tr><td><strong>Struct</strong></td><td>Name with struct reference</td><td><code>Column(Column)</code> → <code>#[facet(ns::column(name = "id", primary_key))]</code></td></tr>
      </tbody>
    </table>

    <h3>Supported Field Types (in structs)</h3>
    <table>
      <thead>
        <tr><th>Grammar Type</th><th>Rust Type</th><th>Attribute Syntax</th></tr>
      </thead>
      <tbody>
        <tr><td><code>bool</code></td><td><code>bool</code></td><td><code>flag</code> or <code>flag = true</code></td></tr>
        <tr><td><code>&amp;'static str</code></td><td><code>&amp;'static str</code></td><td><code>name = "value"</code></td></tr>
        <tr><td><code>Option&lt;&amp;'static str&gt;</code></td><td><code>Option&lt;&amp;'static str&gt;</code></td><td><code>name = "value"</code> (optional)</td></tr>
        <tr><td><code>Option&lt;bool&gt;</code></td><td><code>Option&lt;bool&gt;</code></td><td><code>flag = true</code> (optional)</td></tr>
        <tr><td><code>i64</code></td><td><code>i64</code></td><td><code>min = 42</code> or <code>min = -100</code></td></tr>
        <tr><td><code>&amp;'static [&amp;'static str]</code></td><td><code>&amp;'static [&amp;'static str]</code></td><td><code>cols = ["a", "b"]</code></td></tr>
        <tr><td><code>ident</code></td><td><code>&amp;'static str</code></td><td><code>action = cascade</code> (bare ident → string)</td></tr>
      </tbody>
    </table>

    <h3>Example Grammar</h3>
<pre><code class="language-rust">facet::define_attributes! {
    /// ORM attributes for database mapping
    pub enum Attr {
        /// Skip this field during serialization
        Skip,

        /// Rename the field
        Rename(&amp;'static str),

        /// Column configuration
        Column(Column),

        /// Index configuration
        Index(Index),
    }

    /// Database column configuration
    pub struct Column {
        /// Override column name
        pub name: Option&lt;&amp;'static str&gt;,
        /// SQL type override
        pub sql_type: Option&lt;&amp;'static str&gt;,
        /// Mark as primary key
        pub primary_key: bool,
        /// Enable auto-increment
        pub auto_increment: bool,
    }

    /// Index configuration
    pub struct Index {
        /// Custom index name
        pub name: Option&lt;&amp;'static str&gt;,
        /// Columns to index
        pub columns: &amp;'static [&amp;'static str],
        /// Unique constraint
        pub unique: bool,
    }
}</code></pre>

    <hr>

    <h2>Error Handling</h2>

    <h3>Unknown Attribute</h3>
<pre><code class="language-rust">#[facet(orm::colum(primary_key))]  // typo: "colum" instead of "column"</code></pre>
<pre><code class="language-rust">error: unknown attribute `colum`, did you mean `column`?
       available attributes: skip, rename, column, index
  --&gt; src/lib.rs:5:13
   |
5  |     #[facet(orm::colum(primary_key))]
   |                  ^^^^^</code></pre>

    <h3>Unknown Field</h3>
<pre><code class="language-rust">#[facet(orm::column(primay_key))]  // typo in field name</code></pre>
<pre><code class="language-rust">error: unknown field `primay_key` in `Column`
       available fields: name, sql_type, primary_key, auto_increment
       did you mean `primary_key`?
  --&gt; src/lib.rs:5:25
   |
5  |     #[facet(orm::column(primay_key))]
   |                         ^^^^^^^^^^</code></pre>

    <hr>

    <h2>What Gets Generated</h2>
    <p>When you call <code>define_attributes!</code>, it generates:</p>

    <h3>1. Type Definitions</h3>
<pre><code class="language-rust">#[derive(Debug, Clone, PartialEq)]
pub enum Attr {
    Skip,
    Rename(&amp;'static str),
    Column(Column),
    Index(Index),
}

#[derive(Debug, Clone, PartialEq, Default)]
pub struct Column {
    pub name: Option&lt;&amp;'static str&gt;,
    pub sql_type: Option&lt;&amp;'static str&gt;,
    pub primary_key: bool,
    pub auto_increment: bool,
}</code></pre>

    <h3>2. Proc-Macro Re-exports</h3>
<pre><code class="language-rust">#[doc(hidden)]
pub use ::facet::__dispatch_attr;
#[doc(hidden)]
pub use ::facet::__build_struct_fields;
#[doc(hidden)]
pub use ::facet::__attr_error as __attr_error_proc_macro;
#[doc(hidden)]
pub use ::facet::__field_error as __field_error_proc_macro;</code></pre>

    <h3>3. The <code>__parse_attr!</code> Macro</h3>
    <p>A declarative macro containing the "compiled grammar":</p>
<pre><code class="language-rust">#[macro_export]
macro_rules! __parse_attr {
    ($name:ident $($rest:tt)*) =&gt; {
        $crate::__dispatch_attr!{
            @namespace { $crate }
            @enum_name { Attr }
            @variants {
                skip: unit,
                rename: newtype,
                column: rec Column { name: opt_string, primary_key: bool, ... },
                index: rec Index { name: opt_string, columns: list_string, unique: bool }
            }
            @name { $name }
            @rest { $($rest)* }
        }
    };

    () =&gt; {
        compile_error!("expected an attribute name")
    };
}</code></pre>

    <hr>

    <h2>The Derive Macro's Role</h2>
    <p>The <code>#[derive(Facet)]</code> macro is intentionally simple. When it sees <code>#[facet(orm::column(...))]</code>:</p>
    <ol>
      <li><strong>Parse</strong> the attribute to extract namespace (<code>orm</code>) and rest (<code>column(...)</code>)</li>
      <li><strong>Generate</strong> a call to <code>orm::__parse_attr!(column(...))</code></li>
      <li><strong>Done</strong> — all parsing logic lives in the extension crate</li>
    </ol>

<pre><code class="language-rust">// User writes:
#[facet(orm::column(primary_key))]
id: i64,

// Derive macro generates (simplified):
.attributes(&amp;[
    FieldAttribute::Extension(orm::__parse_attr!(column(primary_key)))
])</code></pre>

    <p>The derive macro doesn't need to understand ORM attributes. It just forwards to the namespace's parser.</p>

    <hr>

    <h2>Implementation Status</h2>

    <h3>Already Ported (from proto-attr to facet-macros-impl)</h3>
    <table>
      <thead>
        <tr><th>Component</th><th>File</th><th>Status</th></tr>
      </thead>
      <tbody>
        <tr><td>Grammar compiler</td><td><code>attr_grammar/make_parse_attr.rs</code></td><td class="status-done">✅ Done</td></tr>
        <tr><td>Dispatcher</td><td><code>attr_grammar/dispatch_attr.rs</code></td><td class="status-done">✅ Done</td></tr>
        <tr><td>Struct field builder</td><td><code>attr_grammar/build_struct_fields.rs</code></td><td class="status-done">✅ Done</td></tr>
        <tr><td>Attribute error</td><td><code>attr_grammar/attr_error.rs</code></td><td class="status-done">✅ Done</td></tr>
        <tr><td>Field error</td><td><code>attr_grammar/field_error.rs</code></td><td class="status-done">✅ Done</td></tr>
        <tr><td>Spanned error</td><td><code>attr_grammar/spanned_error.rs</code></td><td class="status-done">✅ Done</td></tr>
        <tr><td>Public API macro</td><td><code>facet/src/lib.rs</code></td><td class="status-done">✅ Done</td></tr>
      </tbody>
    </table>

    <h3>Not Yet Connected</h3>
    <table>
      <thead>
        <tr><th>Task</th><th>Status</th></tr>
      </thead>
      <tbody>
        <tr><td>Derive macro generates <code>ns::__parse_attr!</code> calls</td><td class="status-pending">❌ Not done</td></tr>
        <tr><td>Extension crates use <code>define_attributes!</code></td><td class="status-pending">❌ Not done</td></tr>
        <tr><td>Built-in attrs use the grammar system</td><td class="status-pending">❌ Not done</td></tr>
      </tbody>
    </table>

    <hr>

    <h2>Migration Plan</h2>

    <h3>Phase 1: Connect the Derive Macro</h3>
    <p>Update <code>facet-macros-impl</code> to generate <code>namespace::__parse_attr!(...)</code> calls instead of the current <code>__attr!</code> dispatch.</p>

    <h3>Phase 2: Migrate Extension Crates</h3>
    <p>Convert <code>facet-kdl</code>, <code>facet-args</code>, <code>facet-yaml</code> to use <code>define_attributes!</code>:</p>

<pre><code class="language-rust">// Before (hand-written in each crate):
#[macro_export]
macro_rules! __attr {
    (child { $($tt:tt)* }) =&gt; { $crate::__child!{ $($tt)* } };
    (property { $($tt:tt)* }) =&gt; { $crate::__property!{ $($tt)* } };
    // ... etc, ~100 lines per crate
}

// After (one grammar definition):
facet::define_attributes! {
    pub enum Attr {
        Child,
        Children,
        Property,
        Argument,
        Arguments,
        NodeName,
    }
}</code></pre>

    <h3>Phase 3: Built-in Attributes</h3>
    <p>Use the grammar system for facet's built-in attributes too. This would replace the hand-written <code>FacetInner</code> enum (~200 lines of unsynn grammar).</p>

    <hr>

    <h2>Storage Model</h2>
    <p><strong>Everything becomes <code>Attribute</code>.</strong> This is the key insight. Both built-in and namespaced attributes use the same unified type.</p>

    <h3>Current (to be eliminated)</h3>
<pre><code class="language-rust">pub enum ShapeAttribute {
    DenyUnknownFields,           // ← specific variant, dies
    Default,                      // ← specific variant, dies
    Transparent,                  // ← specific variant, dies
    RenameAll(&amp;'static str),      // ← specific variant, dies
    Untagged,                     // ← specific variant, dies
    Tag(&amp;'static str),            // ← specific variant, dies
    Content(&amp;'static str),        // ← specific variant, dies
    Extension(Attribute),         // ← ONLY this remains, then enum goes away
}</code></pre>

    <h3>Future</h3>
<pre><code class="language-rust">// ShapeAttribute and FieldAttribute both become just Attribute
pub type ShapeAttribute = Attribute;
pub type FieldAttribute = Attribute;</code></pre>

    <h3>Built-in Attrs use None Namespace</h3>
    <p>Built-in facet attributes use <code>None</code> namespace to distinguish from namespaced ones:</p>
<pre><code class="language-rust">// #[facet(rename_all = "camelCase")]
Attribute {
    ns: None,  // None = built-in facet attribute
    key: "rename_all",
    data: &amp;"camelCase" as *const (),
    shape: &lt;&amp;'static str&gt;::SHAPE,
}

// #[facet(kdl::child)]
Attribute {
    ns: Some("kdl"),
    key: "child",
    data: &amp;() as *const (),
    shape: &lt;()&gt;::SHAPE,
}</code></pre>

    <h3>The Grammar Enum is for Parsing, Not Storage</h3>
    <p>The enum generated by <code>define_attributes!</code> is used:</p>
    <ol>
      <li><strong>At parse time</strong> — to validate syntax and produce good error messages</li>
      <li><strong>To generate Attribute</strong> — each variant knows its <code>key</code> and <code>data</code> type</li>
      <li><strong>For convenience</strong> — extension crates can match on typed enum in their code</li>
    </ol>
    <p>But the <strong>final storage</strong> is always <code>Attribute</code> in <code>Shape.attributes</code> / <code>Field.attributes</code>.</p>

    <hr>

    <h2>Summary</h2>
    <table>
      <thead>
        <tr><th>Aspect</th><th>Old (current)</th><th>New (with grammar)</th></tr>
      </thead>
      <tbody>
        <tr><td>Parsing logic</td><td>Hand-written per crate</td><td>Generated from grammar</td></tr>
        <tr><td>Error messages</td><td>Basic <code>compile_error!</code></td><td>Typo suggestions via strsim</td></tr>
        <tr><td>Type safety</td><td>Stringly-typed</td><td>Enum + struct types</td></tr>
        <tr><td>Boilerplate</td><td>~100 lines per crate</td><td>~10 lines grammar</td></tr>
        <tr><td>Maintenance</td><td>Fix bugs in N places</td><td>Fix once in generator</td></tr>
      </tbody>
    </table>

  </main>
  <script>hljs.highlightAll();</script>
</body>
</html>
