// Grammar Definition Time (Third-Party)
// Render: dot -Tsvg 01a-grammar-definition-3rdparty.dot -o 01a-grammar-definition-3rdparty.svg

digraph grammar_definition_3rdparty {
    label="Grammar Definition Time (Third-Party Crate)";
    labelloc="t";
    fontsize=20;
    fontname="Helvetica-Bold";

    node [shape=box, fontname="Monaco, Consolas, Courier", fontsize=11];
    edge [fontname="Helvetica", fontsize=10];

    rankdir=LR;
    nodesep=0.8;
    ranksep=1.2;

    // Extension crate input
    grammar [label=<
<table border="0" cellspacing="0" cellpadding="2">
<tr><td align="left" bgcolor="#ffe4c4"><b>Input: facet-kdl/src/lib.rs</b></td></tr>
<tr><td align="left"><font face="Monaco">::facet::<font color="#8250df">define_attributes!</font> {</font></td></tr>
<tr><td align="left"><font face="Monaco">    <font color="#cf222e">mod</font> <font color="#0550ae">attrs</font>;</font></td></tr>
<tr><td align="left"><font face="Monaco">    <font color="#6e7781">// Two enums: one per target</font></font></td></tr>
<tr><td align="left"><font face="Monaco">    <font color="#cf222e">pub enum</font> <font color="#0550ae">ContainerAttribute</font> {</font></td></tr>
<tr><td align="left"><font face="Monaco">        NodeName(<font color="#0550ae">&amp;'static str</font>),</font></td></tr>
<tr><td align="left"><font face="Monaco">    }</font></td></tr>
<tr><td align="left"><font face="Monaco">    <font color="#cf222e">pub enum</font> <font color="#0550ae">FieldAttribute</font> {</font></td></tr>
<tr><td align="left"><font face="Monaco">        Child,</font></td></tr>
<tr><td align="left"><font face="Monaco">        Children,</font></td></tr>
<tr><td align="left"><font face="Monaco">        Property(<font color="#0550ae">&amp;'static str</font>),</font></td></tr>
<tr><td align="left"><font face="Monaco">        Argument,</font></td></tr>
<tr><td align="left"><font face="Monaco">        Arguments,</font></td></tr>
<tr><td align="left"><font face="Monaco">    }</font></td></tr>
<tr><td align="left"><font face="Monaco">}</font></td></tr>
</table>
    >, style=filled, fillcolor="#fff8f0"];

    // Proc-macro processing
    make_parse [label=<
<table border="0" cellspacing="0" cellpadding="2">
<tr><td bgcolor="#e8e8f4"><b>facet-macros-impl</b></td></tr>
<tr><td><font face="Monaco">::facet::<font color="#8250df">__make_parse_attr!</font></font></td></tr>
<tr><td>(grammar compiler)</td></tr>
</table>
    >, style=filled, fillcolor="#e8e8f4"];

    // Generated output
    generated [label=<
<table border="0" cellspacing="0" cellpadding="2">
<tr><td align="left" bgcolor="#d4edda"><b>Generated in facet-kdl</b></td></tr>
<tr><td align="left" bgcolor="#e8f5e9"><b>1. Runtime types (in submodule)</b></td></tr>
<tr><td align="left"><font face="Monaco"><font color="#cf222e">pub mod</font> <font color="#0550ae">attrs</font> {</font></td></tr>
<tr><td align="left"><font face="Monaco">    <font color="#cf222e">pub enum</font> <font color="#0550ae">ContainerAttribute</font> { NodeName(<font color="#0550ae">...</font>) }</font></td></tr>
<tr><td align="left"><font face="Monaco">    <font color="#cf222e">pub enum</font> <font color="#0550ae">FieldAttribute</font> { Child, Children, ... }</font></td></tr>
<tr><td align="left"><font face="Monaco">}</font></td></tr>
<tr><td align="left" bgcolor="#fff3cd"><b>2. TWO COMPILED GRAMMARS</b></td></tr>
<tr><td align="left"><font face="Monaco"><font color="#cf222e">macro_rules!</font> <font color="#8250df">__parse_container_attr</font> {</font></td></tr>
<tr><td align="left"><font face="Monaco">    (<font color="#953800">$name</font>:ident $(<font color="#953800">$rest</font>:tt)*) =&gt; {</font></td></tr>
<tr><td align="left"><font face="Monaco">        ::facet::<font color="#8250df">__dispatch_attr!</font> {</font></td></tr>
<tr><td align="left"><font face="Monaco">            <font color="#8250df">@ns</font> { <font color="#0a3069">"kdl"</font> }</font></td></tr>
<tr><td align="left"><font face="Monaco">            <font color="#8250df">@variants</font> { node_name: newtype, ... }</font></td></tr>
<tr><td align="left"><font face="Monaco">            ...</font></td></tr>
<tr><td align="left"><font face="Monaco">        }</font></td></tr>
<tr><td align="left"><font face="Monaco">    };</font></td></tr>
<tr><td align="left"><font face="Monaco">}</font></td></tr>
<tr><td align="left"><font face="Monaco"><font color="#cf222e">macro_rules!</font> <font color="#8250df">__parse_field_attr</font> {</font></td></tr>
<tr><td align="left"><font face="Monaco">    (<font color="#953800">$name</font>:ident $(<font color="#953800">$rest</font>:tt)*) =&gt; {</font></td></tr>
<tr><td align="left"><font face="Monaco">        ::facet::<font color="#8250df">__dispatch_attr!</font> {</font></td></tr>
<tr><td align="left"><font face="Monaco">            <font color="#8250df">@ns</font> { <font color="#0a3069">"kdl"</font> }</font></td></tr>
<tr><td align="left"><font face="Monaco">            <font color="#8250df">@variants</font> { child, children, property, ... }</font></td></tr>
<tr><td align="left"><font face="Monaco">            ...</font></td></tr>
<tr><td align="left"><font face="Monaco">        }</font></td></tr>
<tr><td align="left"><font face="Monaco">    };</font></td></tr>
<tr><td align="left"><font face="Monaco">}</font></td></tr>
<tr><td align="left" bgcolor="#e8f5e9"><b>3. Re-exports (macro hygiene)</b></td></tr>
<tr><td align="left"><font face="Monaco"><font color="#cf222e">pub use</font> ::facet::{<font color="#8250df">__dispatch_attr</font>, <font color="#8250df">__attr_error</font>, ...};</font></td></tr>
</table>
    >, style=filled, fillcolor="#f0fff0"];

    // Edges
    grammar -> make_parse [label="compiles via", color="#4169e1", penwidth=2];
    make_parse -> generated [label="generates", color="#228b22", penwidth=2];
}
