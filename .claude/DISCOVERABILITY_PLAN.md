# Discoverability Improvement Plan

## Problem
Claude (and others) spent time struggling to find benchmark information that was already documented in `.claude/skills/benchmarking.md`.

## Root Causes
1. **Didn't check skills first** - Should always check `.claude/skills/` for domain-specific guidance
2. **Generated file not obvious** - File header has generation marker but not prominent enough
3. **No cross-reference in CLAUDE.md** - Main guide doesn't point to benchmarking skill
4. **Benchmark run commands not in quickstart** - How to run specific benchmarks buried in skill doc

## Improvements to Implement

### 1. Update CLAUDE.md with Benchmark Quick Reference
**File:** `.claude/CLAUDE.md`

Add new section after "Testing":

```markdown
## Benchmarking - IMPORTANT

**Benchmarks are defined in `facet-json/benches/benchmarks.kdl`, NOT the generated `.rs` files.**

Quick commands:
```bash
# Run all benchmarks
cargo xtask bench

# Run specific benchmark (e.g., flatten_2enums)
cargo bench --bench unified_benchmarks_divan -- flatten_2enums

# With detailed output
FACET_TIER2_DIAG=1 cargo bench --bench unified_benchmarks_divan -- flatten_2enums 2>&1 | grep TIER
```

See `.claude/skills/benchmarking.md` for full documentation.
```

### 2. Improve Generated File Headers
**Files:** `tools/benchmark-generator/src/main.rs`

Update the generated file header template to be more prominent and helpful:

```rust
//! ⚠️  AUTO-GENERATED by benchmark-generator ⚠️
//!
//! ❌ DO NOT EDIT THIS FILE DIRECTLY
//! ✅ Instead, edit: facet-json/benches/benchmarks.kdl
//!
//! To regenerate: cargo xtask gen-benchmarks
//! To run benchmarks: cargo xtask bench
//! For help: see .claude/skills/benchmarking.md
//!
//! Quick run: cargo bench --bench unified_benchmarks_divan -- <benchmark_name>
```

### 3. Add Benchmark Running Examples to Skill Doc
**File:** `.claude/skills/benchmarking.md`

Add a new "Quick Reference" section at the very top (before "Quick Usage"):

```markdown
# Benchmarking with cargo xtask bench

## Quick Reference - Running Specific Benchmarks

```bash
# List all benchmarks
cargo bench --bench unified_benchmarks_divan -- --list | grep -v "    " | head -20

# Run specific benchmark by name
cargo bench --bench unified_benchmarks_divan -- flatten_2enums

# Run with Tier-2 diagnostics
FACET_TIER2_DIAG=1 cargo bench --bench unified_benchmarks_divan -- flatten_2enums 2>&1 | grep TIER_

# Run and check tier2 statistics
cargo bench --bench unified_benchmarks_divan -- flatten_2enums 2>&1 | grep TIER_STATS

# Run all benchmarks matching a pattern
cargo bench --bench unified_benchmarks_divan -- flatten

# Run Tier-2 JIT benchmarks only
cargo bench --bench unified_benchmarks_divan -- "tier2"
```

**Remember:** Benchmarks are GENERATED from `facet-json/benches/benchmarks.kdl`.
See "Adding New Benchmarks" section below.

## Quick Usage
...
```

### 4. Create a "Check Skills First" Reminder in CLAUDE.md
**File:** `.claude/CLAUDE.md`

Update the "Skills" section:

```markdown
## Skills - CHECK THESE FIRST

**.claude/skills/** contains specialized guidance for:
- **benchmarking.md** - Running and adding benchmarks, generated files
- **debug-with-valgrind.md** - Debugging crashes, SIGSEGV, memory errors
- **profiling.md** - Performance profiling workflows
- **use-facet-crates.md** - Using facet crates correctly

**ALWAYS check skills/ before:**
- Running/modifying benchmarks
- Debugging crashes
- Performance work
- Using unfamiliar subsystems

Don't reinvent solutions or waste time - check skills first.
```

### 5. Add README in .claude/ Directory
**File:** `.claude/README.md`

```markdown
# .claude/ Directory

This directory contains Claude Code project configuration and guidance.

## Structure

- **CLAUDE.md** - Main project guidelines (START HERE)
- **skills/** - Specialized how-to guides for specific tasks
- **commands/** - Custom slash commands
- **hooks/** - Event hooks for tool calls
- **settings.local.json** - Local configuration

## When to Check Each File

### CLAUDE.md (Read First)
- Git workflow rules
- File editing rules (no sed!)
- Architecture/migration info
- Testing commands
- Problem handling philosophy

### skills/ Directory (Check Before Starting Work)

| Skill | When to Read |
|-------|-------------|
| `benchmarking.md` | Before running/modifying benchmarks |
| `debug-with-valgrind.md` | When encountering crashes/SIGSEGV |
| `profiling.md` | For performance analysis |
| `use-facet-crates.md` | When using facet crates |

**Rule of thumb:** If you're about to search for "how to..." information, check skills/ first.

## For Claude Code Agents

1. Read CLAUDE.md at session start
2. Check skills/ before domain-specific work
3. Don't duplicate information - reference existing docs
4. When stuck, check if guidance exists before asking user
```

### 6. Add Skill Existence Check to Workflow
**Mental Model for Claude:**

Before starting work on:
- Benchmarks → Check `.claude/skills/benchmarking.md`
- Crashes/debugging → Check `.claude/skills/debug-with-valgrind.md`
- Performance → Check `.claude/skills/profiling.md`
- Facet crates → Check `.claude/skills/use-facet-crates.md`

## Success Criteria

After implementing these changes, Claude should:

1. ✅ Check `.claude/skills/` BEFORE searching for domain info
2. ✅ Immediately recognize generated files from prominent headers
3. ✅ Find "how to run specific benchmark" in < 30 seconds
4. ✅ Reference existing documentation instead of duplicating
5. ✅ Not waste time trying to read massive generated files

## Implementation Order

1. **Immediate (this session):**
   - Update generated file header template
   - Add benchmark quickstart to CLAUDE.md
   - Add Quick Reference section to benchmarking.md skill

2. **Before next session:**
   - Create .claude/README.md
   - Update CLAUDE.md Skills section with "CHECK THESE FIRST"

3. **Ongoing:**
   - When adding new skills, cross-reference from CLAUDE.md
   - When encountering common struggles, add to relevant skill doc

## Testing the Plan

Next time someone needs to:
- Run a specific benchmark → Should find it in < 30 seconds
- Add a new benchmark → Should know to edit benchmarks.kdl, not .rs
- Debug benchmark → Should know about generated tests + valgrind

## Notes

- The information WAS already there - just not discoverable enough
- Problem is discoverability, not content
- Solution: Prominent pointers, cross-references, consistent structure
